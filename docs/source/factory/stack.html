<!DOCTYPE html>

<html>
<head>
  <title>Stack factory</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <meta name="viewport" content="width=device-width, target-densitydpi=160dpi, initial-scale=1.0; maximum-scale=1.0; user-scalable=0;">
  <link rel="stylesheet" media="all" href="../../docco.css" />
</head>
<body>
  <div id="container">
    <div id="background"></div>
    
      <ul id="jump_to">
        <li>
          <a class="large" href="javascript:void(0);">Jump To &hellip;</a>
          <a class="small" href="javascript:void(0);">+</a>
          <div id="jump_wrapper">
          <div id="jump_page_wrapper">
            <div id="jump_page">
              
                
                <a class="source" href="../core/animationloop.html">
                  ./source/core/animationloop.js
                </a>
              
                
                <a class="source" href="../core/component.html">
                  ./source/core/component.js
                </a>
              
                
                <a class="source" href="../core/document.html">
                  ./source/core/document.js
                </a>
              
                
                <a class="source" href="../core/init.html">
                  ./source/core/init.js
                </a>
              
                
                <a class="source" href="../core/library.html">
                  ./source/core/library.js
                </a>
              
                
                <a class="source" href="../core/userInteraction.html">
                  ./source/core/userInteraction.js
                </a>
              
                
                <a class="source" href="../core/utilities.html">
                  ./source/core/utilities.js
                </a>
              
                
                <a class="source" href="action.html">
                  ./source/factory/action.js
                </a>
              
                
                <a class="source" href="anchor.html">
                  ./source/factory/anchor.js
                </a>
              
                
                <a class="source" href="animation.html">
                  ./source/factory/animation.js
                </a>
              
                
                <a class="source" href="block.html">
                  ./source/factory/block.js
                </a>
              
                
                <a class="source" href="canvas.html">
                  ./source/factory/canvas.js
                </a>
              
                
                <a class="source" href="cell.html">
                  ./source/factory/cell.js
                </a>
              
                
                <a class="source" href="color.html">
                  ./source/factory/color.js
                </a>
              
                
                <a class="source" href="coordinate.html">
                  ./source/factory/coordinate.js
                </a>
              
                
                <a class="source" href="element.html">
                  ./source/factory/element.js
                </a>
              
                
                <a class="source" href="filter.html">
                  ./source/factory/filter.js
                </a>
              
                
                <a class="source" href="fontAttributes.html">
                  ./source/factory/fontAttributes.js
                </a>
              
                
                <a class="source" href="gradient.html">
                  ./source/factory/gradient.js
                </a>
              
                
                <a class="source" href="grid.html">
                  ./source/factory/grid.js
                </a>
              
                
                <a class="source" href="group.html">
                  ./source/factory/group.js
                </a>
              
                
                <a class="source" href="imageAsset.html">
                  ./source/factory/imageAsset.js
                </a>
              
                
                <a class="source" href="loom.html">
                  ./source/factory/loom.js
                </a>
              
                
                <a class="source" href="palette.html">
                  ./source/factory/palette.js
                </a>
              
                
                <a class="source" href="pattern.html">
                  ./source/factory/pattern.js
                </a>
              
                
                <a class="source" href="phrase.html">
                  ./source/factory/phrase.js
                </a>
              
                
                <a class="source" href="picture.html">
                  ./source/factory/picture.js
                </a>
              
                
                <a class="source" href="quaternion.html">
                  ./source/factory/quaternion.js
                </a>
              
                
                <a class="source" href="radialGradient.html">
                  ./source/factory/radialGradient.js
                </a>
              
                
                <a class="source" href="renderAnimation.html">
                  ./source/factory/renderAnimation.js
                </a>
              
                
                <a class="source" href="shape.html">
                  ./source/factory/shape.js
                </a>
              
                
                <a class="source" href="spriteAsset.html">
                  ./source/factory/spriteAsset.js
                </a>
              
                
                <a class="source" href="stack.html">
                  ./source/factory/stack.js
                </a>
              
                
                <a class="source" href="state.html">
                  ./source/factory/state.js
                </a>
              
                
                <a class="source" href="ticker.html">
                  ./source/factory/ticker.js
                </a>
              
                
                <a class="source" href="tween.html">
                  ./source/factory/tween.js
                </a>
              
                
                <a class="source" href="unstackedElement.html">
                  ./source/factory/unstackedElement.js
                </a>
              
                
                <a class="source" href="vector.html">
                  ./source/factory/vector.js
                </a>
              
                
                <a class="source" href="videoAsset.html">
                  ./source/factory/videoAsset.js
                </a>
              
                
                <a class="source" href="wheel.html">
                  ./source/factory/wheel.js
                </a>
              
                
                <a class="source" href="../mixin/anchor.html">
                  ./source/mixin/anchor.js
                </a>
              
                
                <a class="source" href="../mixin/asset.html">
                  ./source/mixin/asset.js
                </a>
              
                
                <a class="source" href="../mixin/assetConsumer.html">
                  ./source/mixin/assetConsumer.js
                </a>
              
                
                <a class="source" href="../mixin/base.html">
                  ./source/mixin/base.js
                </a>
              
                
                <a class="source" href="../mixin/cascade.html">
                  ./source/mixin/cascade.js
                </a>
              
                
                <a class="source" href="../mixin/dom.html">
                  ./source/mixin/dom.js
                </a>
              
                
                <a class="source" href="../mixin/entity.html">
                  ./source/mixin/entity.js
                </a>
              
                
                <a class="source" href="../mixin/filter.html">
                  ./source/mixin/filter.js
                </a>
              
                
                <a class="source" href="../mixin/position.html">
                  ./source/mixin/position.js
                </a>
              
                
                <a class="source" href="../mixin/shapePathCalculation.html">
                  ./source/mixin/shapePathCalculation.js
                </a>
              
                
                <a class="source" href="../mixin/styles.html">
                  ./source/mixin/styles.js
                </a>
              
                
                <a class="source" href="../mixin/tween.html">
                  ./source/mixin/tween.js
                </a>
              
                
                <a class="source" href="../worker/filter.html">
                  ./source/worker/filter.js
                </a>
              
            </div>
          </div>
        </li>
      </ul>
    
    <ul class="sections">
        
        
        
        <li id="section-1">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-1">&#182;</a>
              </div>
              
            </div>
            
        </li>
        
        
        <li id="section-2">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-2">&#182;</a>
              </div>
              <h1 id="stack-factory">Stack factory</h1>

            </div>
            
        </li>
        
        
        <li id="section-3">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-3">&#182;</a>
              </div>
              <p>TODO - documentation</p>

            </div>
            
        </li>
        
        
        <li id="section-4">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-4">&#182;</a>
              </div>
              <h4 id="to-instantiate-objects-from-the-factory">To instantiate objects from the factory</h4>

            </div>
            
        </li>
        
        
        <li id="section-5">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-5">&#182;</a>
              </div>
              <h4 id="library-storage">Library storage</h4>

            </div>
            
        </li>
        
        
        <li id="section-6">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-6">&#182;</a>
              </div>
              <h4 id="clone-functionality">Clone functionality</h4>

            </div>
            
        </li>
        
        
        <li id="section-7">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-7">&#182;</a>
              </div>
              <h4 id="kill-functionality">Kill functionality</h4>

            </div>
            
        </li>
        
        
        <li id="section-8">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-8">&#182;</a>
              </div>
              <h2 id="imports">Imports</h2>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">import</span> { constructors, group, stack, stacknames, element, artefact, artefactnames, canvas } <span class="hljs-keyword">from</span> <span class="hljs-string">'../core/library.js'</span>;
<span class="hljs-keyword">import</span> { generateUuid, mergeOver, pushUnique, isa_dom, removeItem, xt, xto, addStrings, defaultThisReturnFunction } <span class="hljs-keyword">from</span> <span class="hljs-string">'../core/utilities.js'</span>;
<span class="hljs-keyword">import</span> { rootElements, setRootElementsSort, addDomShowElement, setDomShowRequired, domShow } <span class="hljs-keyword">from</span> <span class="hljs-string">'../core/document.js'</span>;
<span class="hljs-keyword">import</span> { uiSubscribedElements, currentCorePosition } <span class="hljs-keyword">from</span> <span class="hljs-string">'../core/userInteraction.js'</span>;

<span class="hljs-keyword">import</span> { makeGroup } <span class="hljs-keyword">from</span> <span class="hljs-string">'./group.js'</span>;
<span class="hljs-keyword">import</span> { makeElement } <span class="hljs-keyword">from</span> <span class="hljs-string">'./element.js'</span>;
<span class="hljs-keyword">import</span> { makeCoordinate } <span class="hljs-keyword">from</span> <span class="hljs-string">'./coordinate.js'</span>;

<span class="hljs-keyword">import</span> baseMix <span class="hljs-keyword">from</span> <span class="hljs-string">'../mixin/base.js'</span>;
<span class="hljs-keyword">import</span> positionMix <span class="hljs-keyword">from</span> <span class="hljs-string">'../mixin/position.js'</span>;
<span class="hljs-keyword">import</span> anchorMix <span class="hljs-keyword">from</span> <span class="hljs-string">'../mixin/anchor.js'</span>;
<span class="hljs-keyword">import</span> cascadeMix <span class="hljs-keyword">from</span> <span class="hljs-string">'../mixin/cascade.js'</span>;
<span class="hljs-keyword">import</span> domMix <span class="hljs-keyword">from</span> <span class="hljs-string">'../mixin/dom.js'</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-9">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-9">&#182;</a>
              </div>
              <h2 id="stack-constructor">Stack constructor</h2>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">const</span> Stack = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">items = {}</span>) </span>{

    <span class="hljs-keyword">let</span> g, el;

    <span class="hljs-keyword">this</span>.makeName(items.name);
    <span class="hljs-keyword">this</span>.register();
    <span class="hljs-keyword">this</span>.initializePositions();
    <span class="hljs-keyword">this</span>.initializeCascade();

    <span class="hljs-keyword">this</span>.dimensions[<span class="hljs-number">0</span>] = <span class="hljs-number">300</span>;
    <span class="hljs-keyword">this</span>.dimensions[<span class="hljs-number">1</span>] = <span class="hljs-number">150</span>;

    <span class="hljs-keyword">this</span>.pathCorners = [];
    <span class="hljs-keyword">this</span>.css = {};
    <span class="hljs-keyword">this</span>.here = {};
    <span class="hljs-keyword">this</span>.perspective = {

        <span class="hljs-attr">x</span>: <span class="hljs-string">'50%'</span>,
        <span class="hljs-attr">y</span>: <span class="hljs-string">'50%'</span>,
        <span class="hljs-attr">z</span>: <span class="hljs-number">0</span>
    };
    <span class="hljs-keyword">this</span>.dirtyPerspective = <span class="hljs-literal">true</span>;

    <span class="hljs-keyword">this</span>.initializeDomLayout(items);

    g = makeGroup({
        <span class="hljs-attr">name</span>: <span class="hljs-keyword">this</span>.name,
        <span class="hljs-attr">host</span>: <span class="hljs-keyword">this</span>.name
    });
    <span class="hljs-keyword">this</span>.addGroups(g.name);

    <span class="hljs-keyword">this</span>.set(<span class="hljs-keyword">this</span>.defs);
    <span class="hljs-keyword">this</span>.set(items);

    el = <span class="hljs-keyword">this</span>.domElement;

    <span class="hljs-keyword">if</span> (el) {

        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.trackHere) pushUnique(uiSubscribedElements, <span class="hljs-keyword">this</span>.name);

        <span class="hljs-keyword">if</span> (el.getAttribute(<span class="hljs-string">'data-group'</span>) === <span class="hljs-string">'root'</span>) {

            pushUnique(rootElements, <span class="hljs-keyword">this</span>.name);
            setRootElementsSort();
        }
    }

    <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>;
};</pre></div></div>
            
        </li>
        
        
        <li id="section-10">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-10">&#182;</a>
              </div>
              <h2 id="stack-object-prototype-setup">Stack object prototype setup</h2>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">let</span> P = Stack.prototype = <span class="hljs-built_in">Object</span>.create(<span class="hljs-built_in">Object</span>.prototype);
P.type = <span class="hljs-string">'Stack'</span>;
P.lib = <span class="hljs-string">'stack'</span>;
P.isArtefact = <span class="hljs-literal">true</span>;
P.isAsset = <span class="hljs-literal">false</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-11">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-11">&#182;</a>
              </div>
              <p>Apply mixins to prototype object</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>P = baseMix(P);
P = positionMix(P);
P = anchorMix(P);
P = cascadeMix(P);
P = domMix(P);</pre></div></div>
            
        </li>
        
        
        <li id="section-12">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-12">&#182;</a>
              </div>
              <h2 id="define-default-attributes">Define default attributes</h2>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">let</span> defaultAttributes = {</pre></div></div>
            
        </li>
        
        
        <li id="section-13">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-13">&#182;</a>
              </div>
              <p>TODO - documentation</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    position: <span class="hljs-string">'relative'</span>,</pre></div></div>
            
        </li>
        
        
        <li id="section-14">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-14">&#182;</a>
              </div>
              <p>TODO - documentation</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    perspective: <span class="hljs-literal">null</span>,</pre></div></div>
            
        </li>
        
        
        <li id="section-15">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-15">&#182;</a>
              </div>
              <p>TODO - documentation</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    trackHere: <span class="hljs-literal">true</span>,</pre></div></div>
            
        </li>
        
        
        <li id="section-16">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-16">&#182;</a>
              </div>
              <p>This is all about a mad idea I had for making stacks ‘responsive’ to viewport changes. It needs a lot more thinking through. Search on ‘isResponsive’ to find the relevant function below</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    isResponsive: <span class="hljs-literal">false</span>,
    <span class="hljs-attr">containElementsInHeight</span>: <span class="hljs-literal">false</span>,
};
P.defs = mergeOver(P.defs, defaultAttributes);</pre></div></div>
            
        </li>
        
        
        <li id="section-17">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-17">&#182;</a>
              </div>
              <h2 id="packet-management">Packet management</h2>

            </div>
            
        </li>
        
        
        <li id="section-18">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-18">&#182;</a>
              </div>
              <p>Clone functionality disabled</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>P.clone = defaultThisReturnFunction;</pre></div></div>
            
        </li>
        
        
        <li id="section-19">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-19">&#182;</a>
              </div>
              <h2 id="define-getter-setter-and-deltasetter-functions">Define getter, setter and deltaSetter functions</h2>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">let</span> G = P.getters,
    S = P.setters,
    D = P.deltaSetters;</pre></div></div>
            
        </li>
        
        
        <li id="section-20">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-20">&#182;</a>
              </div>
              <p>TODO - documentation</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>G.perspectiveX = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{

    <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.perspective.x;
};
G.perspectiveY = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{

    <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.perspective.y;
};
G.perspectiveZ = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{

    <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.perspective.z;
};</pre></div></div>
            
        </li>
        
        
        <li id="section-21">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-21">&#182;</a>
              </div>
              <p>TODO - documentation</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>S.perspectiveX = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">item</span>) </span>{

    <span class="hljs-keyword">this</span>.perspective.x = item;
    <span class="hljs-keyword">this</span>.dirtyPerspective = <span class="hljs-literal">true</span>;
};
S.perspectiveY = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">item</span>) </span>{

    <span class="hljs-keyword">this</span>.perspective.y = item;
    <span class="hljs-keyword">this</span>.dirtyPerspective = <span class="hljs-literal">true</span>;
};
S.perspectiveZ = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">item</span>) </span>{

    <span class="hljs-keyword">this</span>.perspective.z = item;
    <span class="hljs-keyword">this</span>.dirtyPerspective = <span class="hljs-literal">true</span>;
};
S.perspective = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">item = {}</span>) </span>{

    <span class="hljs-keyword">this</span>.perspective.x = (xt(item.x)) ? item.x : <span class="hljs-keyword">this</span>.perspective.x;
    <span class="hljs-keyword">this</span>.perspective.y = (xt(item.y)) ? item.y : <span class="hljs-keyword">this</span>.perspective.y;
    <span class="hljs-keyword">this</span>.perspective.z = (xt(item.z)) ? item.z : <span class="hljs-keyword">this</span>.perspective.z;
    <span class="hljs-keyword">this</span>.dirtyPerspective = <span class="hljs-literal">true</span>;
};
D.perspectiveX = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">item</span>) </span>{

    <span class="hljs-keyword">this</span>.perspective.x = addStrings(<span class="hljs-keyword">this</span>.perspective.x, item);
    <span class="hljs-keyword">this</span>.dirtyPerspective = <span class="hljs-literal">true</span>;
};
D.perspectiveY = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">item</span>) </span>{

    <span class="hljs-keyword">this</span>.perspective.y = addStrings(<span class="hljs-keyword">this</span>.perspective.y, item);
    <span class="hljs-keyword">this</span>.dirtyPerspective = <span class="hljs-literal">true</span>;
};</pre></div></div>
            
        </li>
        
        
        <li id="section-22">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-22">&#182;</a>
              </div>
              <h2 id="define-prototype-functions">Define prototype functions</h2>

            </div>
            
        </li>
        
        
        <li id="section-23">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-23">&#182;</a>
              </div>
              <p>TODO - documentation</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>P.updateArtefacts = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">items = {}</span>) </span>{

    <span class="hljs-keyword">this</span>.groupBuckets.forEach(<span class="hljs-function"><span class="hljs-params">grp</span> =&gt;</span> {

        grp.artefactBuckets.forEach(<span class="hljs-function"><span class="hljs-params">art</span> =&gt;</span> {

            <span class="hljs-keyword">if</span> (items.dirtyScale) art.dirtyScale = <span class="hljs-literal">true</span>;
            <span class="hljs-keyword">if</span> (items.dirtyDimensions) art.dirtyDimensions = <span class="hljs-literal">true</span>;
            <span class="hljs-keyword">if</span> (items.dirtyLock) art.dirtyLock = <span class="hljs-literal">true</span>;
            <span class="hljs-keyword">if</span> (items.dirtyStart) art.dirtyStart = <span class="hljs-literal">true</span>;
            <span class="hljs-keyword">if</span> (items.dirtyOffset) art.dirtyOffset = <span class="hljs-literal">true</span>;
            <span class="hljs-keyword">if</span> (items.dirtyHandle) art.dirtyHandle = <span class="hljs-literal">true</span>;
            <span class="hljs-keyword">if</span> (items.dirtyRotation) art.dirtyRotation = <span class="hljs-literal">true</span>;
            <span class="hljs-keyword">if</span> (items.dirtyPathObject) art.dirtyPathObject = <span class="hljs-literal">true</span>;
            <span class="hljs-keyword">if</span> (items.dirtyCollision) art.dirtyCollision = <span class="hljs-literal">true</span>;
        })
    });
};</pre></div></div>
            
        </li>
        
        
        <li id="section-24">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-24">&#182;</a>
              </div>
              <p>TODO - documentation</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>P.cleanDimensionsAdditionalActions = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{

    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.groupBuckets) {

        <span class="hljs-keyword">this</span>.updateArtefacts({
            <span class="hljs-attr">dirtyDimensions</span>: <span class="hljs-literal">true</span>,
            <span class="hljs-attr">dirtyPath</span>: <span class="hljs-literal">true</span>,
            <span class="hljs-attr">dirtyStart</span>: <span class="hljs-literal">true</span>,
            <span class="hljs-attr">dirtyHandle</span>: <span class="hljs-literal">true</span>,
            <span class="hljs-attr">dirtyCollision</span>: <span class="hljs-literal">true</span>,
        });
    }

    <span class="hljs-keyword">this</span>.dirtyDomDimensions = <span class="hljs-literal">true</span>;
    <span class="hljs-keyword">this</span>.dirtyPath = <span class="hljs-literal">true</span>;
    <span class="hljs-keyword">this</span>.dirtyStart = <span class="hljs-literal">true</span>;
    <span class="hljs-keyword">this</span>.dirtyHandle = <span class="hljs-literal">true</span>;
    <span class="hljs-keyword">this</span>.dirtyCollision = <span class="hljs-literal">true</span>;
};</pre></div></div>
            
        </li>
        
        
        <li id="section-25">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-25">&#182;</a>
              </div>
              <p>TODO - documentation</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>P.cleanPerspective = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{

    <span class="hljs-keyword">this</span>.dirtyPerspective = <span class="hljs-literal">false</span>;

    <span class="hljs-keyword">let</span> p = <span class="hljs-keyword">this</span>.perspective;

    <span class="hljs-keyword">this</span>.domPerspectiveString = <span class="hljs-string">`perspective-origin: <span class="hljs-subst">${p.x}</span> <span class="hljs-subst">${p.y}</span>; perspective: <span class="hljs-subst">${p.z}</span>px;`</span>;
    <span class="hljs-keyword">this</span>.domShowRequired = <span class="hljs-literal">true</span>;

    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.groupBuckets) {

        <span class="hljs-keyword">this</span>.updateArtefacts({
            <span class="hljs-attr">dirtyHandle</span>: <span class="hljs-literal">true</span>,
            <span class="hljs-attr">dirtyPathObject</span>: <span class="hljs-literal">true</span>,
            <span class="hljs-attr">dirtyCollision</span>: <span class="hljs-literal">true</span>,
        });
    }
};</pre></div></div>
            
        </li>
        
        
        <li id="section-26">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-26">&#182;</a>
              </div>
              <p>Scrawl-canvas Stack artefacts cannot have ‘String%’ dimensions, which means they have absolute dimensions -because everything that relies on ‘String%’ dimensions needs an absolute (number) value for their calculations at the root, which is the stack. </p>

            </div>
            
        </li>
        
        
        <li id="section-27">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-27">&#182;</a>
              </div>
              <p>But we still need to make Stacks responsive. We do this by checking if the viewport dimensions have changed (a resize action has taken place) and - if yes - update the stack’s absolute dimensions accordingly … if the <strong>isResponsive</strong> flag has been set to true for the Stack (default is ‘false’ - may change this in due course).</p>

            </div>
            
        </li>
        
        
        <li id="section-28">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-28">&#182;</a>
              </div>
              <p>We call this check in the <strong>clear</strong> function below, because it’s doing nothing else useful at the moment and it makes sense to get updates in place here before everything launches into the compile part of the display cycle</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>P.checkResponsive = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{

    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.isResponsive &amp;&amp; <span class="hljs-keyword">this</span>.trackHere) {</pre></div></div>
            
        </li>
        
        
        <li id="section-29">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-29">&#182;</a>
              </div>
              <p>Start keeping track of the viewport dimensions</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">if</span> (!<span class="hljs-keyword">this</span>.currentVportWidth) <span class="hljs-keyword">this</span>.currentVportWidth = currentCorePosition.w;
        <span class="hljs-keyword">if</span> (!<span class="hljs-keyword">this</span>.currentVportHeight) <span class="hljs-keyword">this</span>.currentVportHeight = currentCorePosition.h;</pre></div></div>
            
        </li>
        
        
        <li id="section-30">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-30">&#182;</a>
              </div>
              <p>If last display cycle responded to dimension changes, need to finalise height now</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.dirtyHeight &amp;&amp; <span class="hljs-keyword">this</span>.containElementsInHeight) {

            <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'stack height final fixes need to be done'</span>);
            <span class="hljs-keyword">this</span>.dirtyHeight = <span class="hljs-literal">false</span>;
        }

        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.currentVportWidth !== currentCorePosition.w) {

            <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'need to update for resized viewport width'</span>);
            <span class="hljs-keyword">this</span>.currentVportWidth = currentCorePosition.w;

            <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.containElementsInHeight) {</pre></div></div>
            
        </li>
        
        
        <li id="section-31">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-31">&#182;</a>
              </div>
              <p>Won’t be updated until the next display cycle, but flag it now for action</p>
<ul>
<li>needed because text in elements flow as part of normal DOM operations</li>
</ul>

            </div>
            
            <div class="content"><div class='highlight'><pre>                <span class="hljs-keyword">this</span>.dirtyHeight = <span class="hljs-literal">true</span>;
            }
        }

        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.currentVportHeight !== currentCorePosition.h) {

            <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'need to update for resized viewport height'</span>);
            <span class="hljs-keyword">this</span>.currentVportHeight = currentCorePosition.h;
        }
    }
};</pre></div></div>
            
        </li>
        
        
        <li id="section-32">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-32">&#182;</a>
              </div>
              <p>TODO - documentation</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>P.clear = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{

    <span class="hljs-keyword">this</span>.checkResponsive();

    <span class="hljs-keyword">return</span> <span class="hljs-built_in">Promise</span>.resolve(<span class="hljs-literal">true</span>);
};</pre></div></div>
            
        </li>
        
        
        <li id="section-33">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-33">&#182;</a>
              </div>
              <p>TODO - documentation</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>P.compile = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{

    <span class="hljs-keyword">let</span> self = <span class="hljs-keyword">this</span>;

    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Promise</span>(<span class="hljs-function">(<span class="hljs-params">resolve, reject</span>) =&gt;</span> {

        self.sortGroups();

        self.prepareStamp()

        self.stamp()
        .then(<span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> {

            <span class="hljs-keyword">let</span> promises = [];

            self.groupBuckets.forEach(<span class="hljs-function"><span class="hljs-params">mygroup</span> =&gt;</span> promises.push(mygroup.stamp()));

            <span class="hljs-keyword">return</span> <span class="hljs-built_in">Promise</span>.all(promises);
        })
        .then(<span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> resolve(<span class="hljs-literal">true</span>))
        .catch(<span class="hljs-function">(<span class="hljs-params">err</span>) =&gt;</span> reject(<span class="hljs-literal">false</span>));
    })
};</pre></div></div>
            
        </li>
        
        
        <li id="section-34">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-34">&#182;</a>
              </div>
              <p>TODO - documentation</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>P.show = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{

    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Promise</span>(<span class="hljs-function">(<span class="hljs-params">resolve</span>) =&gt;</span> {

        domShow();
        resolve(<span class="hljs-literal">true</span>);
    });
};</pre></div></div>
            
        </li>
        
        
        <li id="section-35">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-35">&#182;</a>
              </div>
              <p>TODO - documentation</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>P.render = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{

    <span class="hljs-keyword">let</span> self = <span class="hljs-keyword">this</span>;

    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Promise</span>(<span class="hljs-function">(<span class="hljs-params">resolve, reject</span>) =&gt;</span> {

        self.compile()
        .then(<span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> self.show())
        .then(<span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> resolve(<span class="hljs-literal">true</span>))
        .catch(<span class="hljs-function">(<span class="hljs-params">err</span>) =&gt;</span> reject(<span class="hljs-literal">false</span>));
    });
};</pre></div></div>
            
        </li>
        
        
        <li id="section-36">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-36">&#182;</a>
              </div>
              <p>TODO - documentation</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>P.addExistingDomElements = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">search</span>) </span>{

    <span class="hljs-keyword">let</span> elements, el, captured, i, iz;

    <span class="hljs-keyword">if</span> (xt(search)) {

        elements = (search.substring) ? <span class="hljs-built_in">document</span>.querySelectorAll(search) : [].concat(search);

        <span class="hljs-keyword">for</span> (i = <span class="hljs-number">0</span>, iz = elements.length; i &lt; iz; i++) {

            el = elements[i];
            
            <span class="hljs-keyword">if</span> (isa_dom(el)) {

                captured = makeElement({
                    <span class="hljs-attr">name</span>: el.id || el.name,
                    <span class="hljs-attr">domElement</span>: el,
                    <span class="hljs-attr">group</span>: <span class="hljs-keyword">this</span>.name,
                    <span class="hljs-attr">host</span>: <span class="hljs-keyword">this</span>.name,
                    <span class="hljs-attr">position</span>: <span class="hljs-string">'absolute'</span>,
                    <span class="hljs-attr">setInitialDimensions</span>: <span class="hljs-literal">true</span>,
                });

                <span class="hljs-keyword">if</span> (captured &amp;&amp; captured.domElement) <span class="hljs-keyword">this</span>.domElement.appendChild(captured.domElement);
            }
        }
    }
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>;
};</pre></div></div>
            
        </li>
        
        
        <li id="section-37">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-37">&#182;</a>
              </div>
              <p>Takes an ‘items’ object as an argument. The only required attribute of the argument is <strong>.tag</strong>, which determines the type of element that will be created (for example - setting tag to ‘div’ will create a new &lt;div&gt; element)</p>

            </div>
            
        </li>
        
        
        <li id="section-38">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-38">&#182;</a>
              </div>
              <p>Any other Element artefact attribute can also be included in the argument object, including <strong>.text</strong> and <strong>.content</strong> attributes to set the new DOM Element’s textContent and innerHTML attributes.</p>

            </div>
            
        </li>
        
        
        <li id="section-39">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-39">&#182;</a>
              </div>
              <p>If position and dimension values are not included in the argument, the element will be given default values of [0,0] for start, offset and handle; and dimensions of 100px width and height.</p>

            </div>
            
        </li>
        
        
        <li id="section-40">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-40">&#182;</a>
              </div>
              <p>The new element will also default to a CSS box-sizing style value of ‘border-box’, unless the argument’s <strong>.boxSizing</strong> attribute has been set to ‘content-box’ - this will override any ‘borderBox’ attribute value in the argument’s <strong>.css</strong> object (if one has been included)</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>P.addNewElement = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">items = {}</span>) </span>{

    <span class="hljs-keyword">if</span> (items.tag) {

        items.domElement = <span class="hljs-built_in">document</span>.createElement(items.tag);
        items.domElement.setAttribute(<span class="hljs-string">'data-group'</span>, <span class="hljs-keyword">this</span>.name);
        <span class="hljs-keyword">if</span> (!xt(items.group)) items.group = <span class="hljs-keyword">this</span>.name;
        items.host = <span class="hljs-keyword">this</span>.name;

        <span class="hljs-keyword">if</span> (!items.position) items.position = <span class="hljs-string">'absolute'</span>;
        <span class="hljs-keyword">if</span> (!xt(items.width)) items.width = <span class="hljs-number">100</span>;
        <span class="hljs-keyword">if</span> (!xt(items.height)) items.height = <span class="hljs-number">100</span>;

        <span class="hljs-keyword">let</span> myElement = makeElement(items);

        <span class="hljs-keyword">if</span> (myElement &amp;&amp; myElement.domElement) {

            <span class="hljs-keyword">if</span> (!xt(items.boxSizing)) myElement.domElement.style.boxSizing = <span class="hljs-string">'border-box'</span>;

            <span class="hljs-keyword">this</span>.domElement.appendChild(myElement.domElement);
        }

        <span class="hljs-keyword">return</span> myElement;
    }
    <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
};</pre></div></div>
            
        </li>
        
        
        <li id="section-41">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-41">&#182;</a>
              </div>
              <p>TODO - review and recode</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>P.demolish = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">removeFromDom = false</span>) </span>{

    <span class="hljs-keyword">let</span> el = <span class="hljs-keyword">this</span>.domElement,
        name = <span class="hljs-keyword">this</span>.name,
        grp = group[<span class="hljs-keyword">this</span>.group],
        i, iz, item;

    <span class="hljs-keyword">for</span> (i = <span class="hljs-number">0</span>, iz = <span class="hljs-keyword">this</span>.groups.length; i &lt; iz; i++) {

        item = group[<span class="hljs-keyword">this</span>.groups[i]];

        <span class="hljs-keyword">if</span> (item) item.demolishGroup(removeFromDom);
    }

    <span class="hljs-keyword">if</span> (grp) grp.removeArtefacts(name);

    <span class="hljs-keyword">if</span> (el &amp;&amp; removeFromDom) el.parentNode.removeChild(el);</pre></div></div>
            
        </li>
        
        
        <li id="section-42">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-42">&#182;</a>
              </div>
              <p>also needs to remove itself from subscribe arrays in pivot, mimic, path artefacts</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>
    removeItem(uiSubscribedElements, name);

    <span class="hljs-keyword">delete</span> stack[name];
    removeItem(stacknames, name);

    <span class="hljs-keyword">delete</span> artefact[name];
    removeItem(artefactnames, name);

    removeItem(rootElements, name);
    setRootElementsSort();

    <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
};</pre></div></div>
            
        </li>
        
        
        <li id="section-43">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-43">&#182;</a>
              </div>
              <h2 id="exported-factory-function">Exported factory function</h2>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">const</span> makeStack = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">items</span>) </span>{

    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> Stack(items);
};

constructors.Stack = Stack;

<span class="hljs-keyword">export</span> {
    makeStack,
};</pre></div></div>
            
        </li>
        
    </ul>
  </div>
</body>
</html>
