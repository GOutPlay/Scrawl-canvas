<!DOCTYPE html>

<html>
<head>
  <title>Canvas factory</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <meta name="viewport" content="width=device-width, target-densitydpi=160dpi, initial-scale=1.0; maximum-scale=1.0; user-scalable=0;">
  <link rel="stylesheet" media="all" href="../../docco.css" />
</head>
<body>
  <div id="container">
    <div id="background"></div>
    
      <ul id="jump_to">
        <li>
          <a class="large" href="javascript:void(0);">Jump To &hellip;</a>
          <a class="small" href="javascript:void(0);">+</a>
          <div id="jump_wrapper">
          <div id="jump_page_wrapper">
            <div id="jump_page">
              
                
                <a class="source" href="../core/animationloop.html">
                  ./source/core/animationloop.js
                </a>
              
                
                <a class="source" href="../core/component.html">
                  ./source/core/component.js
                </a>
              
                
                <a class="source" href="../core/document.html">
                  ./source/core/document.js
                </a>
              
                
                <a class="source" href="../core/init.html">
                  ./source/core/init.js
                </a>
              
                
                <a class="source" href="../core/library.html">
                  ./source/core/library.js
                </a>
              
                
                <a class="source" href="../core/userInteraction.html">
                  ./source/core/userInteraction.js
                </a>
              
                
                <a class="source" href="../core/utilities.html">
                  ./source/core/utilities.js
                </a>
              
                
                <a class="source" href="action.html">
                  ./source/factory/action.js
                </a>
              
                
                <a class="source" href="anchor.html">
                  ./source/factory/anchor.js
                </a>
              
                
                <a class="source" href="animation.html">
                  ./source/factory/animation.js
                </a>
              
                
                <a class="source" href="block.html">
                  ./source/factory/block.js
                </a>
              
                
                <a class="source" href="canvas.html">
                  ./source/factory/canvas.js
                </a>
              
                
                <a class="source" href="cell.html">
                  ./source/factory/cell.js
                </a>
              
                
                <a class="source" href="color.html">
                  ./source/factory/color.js
                </a>
              
                
                <a class="source" href="coordinate.html">
                  ./source/factory/coordinate.js
                </a>
              
                
                <a class="source" href="element.html">
                  ./source/factory/element.js
                </a>
              
                
                <a class="source" href="filter.html">
                  ./source/factory/filter.js
                </a>
              
                
                <a class="source" href="fontAttributes.html">
                  ./source/factory/fontAttributes.js
                </a>
              
                
                <a class="source" href="gradient.html">
                  ./source/factory/gradient.js
                </a>
              
                
                <a class="source" href="grid.html">
                  ./source/factory/grid.js
                </a>
              
                
                <a class="source" href="group.html">
                  ./source/factory/group.js
                </a>
              
                
                <a class="source" href="imageAsset.html">
                  ./source/factory/imageAsset.js
                </a>
              
                
                <a class="source" href="loom.html">
                  ./source/factory/loom.js
                </a>
              
                
                <a class="source" href="palette.html">
                  ./source/factory/palette.js
                </a>
              
                
                <a class="source" href="pattern.html">
                  ./source/factory/pattern.js
                </a>
              
                
                <a class="source" href="phrase.html">
                  ./source/factory/phrase.js
                </a>
              
                
                <a class="source" href="picture.html">
                  ./source/factory/picture.js
                </a>
              
                
                <a class="source" href="quaternion.html">
                  ./source/factory/quaternion.js
                </a>
              
                
                <a class="source" href="radialGradient.html">
                  ./source/factory/radialGradient.js
                </a>
              
                
                <a class="source" href="renderAnimation.html">
                  ./source/factory/renderAnimation.js
                </a>
              
                
                <a class="source" href="shape.html">
                  ./source/factory/shape.js
                </a>
              
                
                <a class="source" href="spriteAsset.html">
                  ./source/factory/spriteAsset.js
                </a>
              
                
                <a class="source" href="stack.html">
                  ./source/factory/stack.js
                </a>
              
                
                <a class="source" href="state.html">
                  ./source/factory/state.js
                </a>
              
                
                <a class="source" href="ticker.html">
                  ./source/factory/ticker.js
                </a>
              
                
                <a class="source" href="tween.html">
                  ./source/factory/tween.js
                </a>
              
                
                <a class="source" href="unstackedElement.html">
                  ./source/factory/unstackedElement.js
                </a>
              
                
                <a class="source" href="vector.html">
                  ./source/factory/vector.js
                </a>
              
                
                <a class="source" href="videoAsset.html">
                  ./source/factory/videoAsset.js
                </a>
              
                
                <a class="source" href="wheel.html">
                  ./source/factory/wheel.js
                </a>
              
                
                <a class="source" href="../mixin/anchor.html">
                  ./source/mixin/anchor.js
                </a>
              
                
                <a class="source" href="../mixin/asset.html">
                  ./source/mixin/asset.js
                </a>
              
                
                <a class="source" href="../mixin/assetConsumer.html">
                  ./source/mixin/assetConsumer.js
                </a>
              
                
                <a class="source" href="../mixin/base.html">
                  ./source/mixin/base.js
                </a>
              
                
                <a class="source" href="../mixin/cascade.html">
                  ./source/mixin/cascade.js
                </a>
              
                
                <a class="source" href="../mixin/dom.html">
                  ./source/mixin/dom.js
                </a>
              
                
                <a class="source" href="../mixin/entity.html">
                  ./source/mixin/entity.js
                </a>
              
                
                <a class="source" href="../mixin/filter.html">
                  ./source/mixin/filter.js
                </a>
              
                
                <a class="source" href="../mixin/position.html">
                  ./source/mixin/position.js
                </a>
              
                
                <a class="source" href="../mixin/shapePathCalculation.html">
                  ./source/mixin/shapePathCalculation.js
                </a>
              
                
                <a class="source" href="../mixin/styles.html">
                  ./source/mixin/styles.js
                </a>
              
                
                <a class="source" href="../mixin/tween.html">
                  ./source/mixin/tween.js
                </a>
              
                
                <a class="source" href="../worker/filter.html">
                  ./source/worker/filter.js
                </a>
              
            </div>
          </div>
        </li>
      </ul>
    
    <ul class="sections">
        
        
        
        <li id="section-1">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-1">&#182;</a>
              </div>
              
            </div>
            
        </li>
        
        
        <li id="section-2">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-2">&#182;</a>
              </div>
              <h1 id="canvas-factory">Canvas factory</h1>

            </div>
            
        </li>
        
        
        <li id="section-3">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-3">&#182;</a>
              </div>
              <p>TODO - documentation</p>

            </div>
            
        </li>
        
        
        <li id="section-4">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-4">&#182;</a>
              </div>
              <h4 id="to-instantiate-objects-from-the-factory">To instantiate objects from the factory</h4>

            </div>
            
        </li>
        
        
        <li id="section-5">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-5">&#182;</a>
              </div>
              <h4 id="library-storage">Library storage</h4>

            </div>
            
        </li>
        
        
        <li id="section-6">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-6">&#182;</a>
              </div>
              <h4 id="clone-functionality">Clone functionality</h4>

            </div>
            
        </li>
        
        
        <li id="section-7">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-7">&#182;</a>
              </div>
              <h4 id="kill-functionality">Kill functionality</h4>

            </div>
            
        </li>
        
        
        <li id="section-8">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-8">&#182;</a>
              </div>
              <h2 id="imports">Imports</h2>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">import</span> { cell, constructors, artefact } <span class="hljs-keyword">from</span> <span class="hljs-string">'../core/library.js'</span>;
<span class="hljs-keyword">import</span> { rootElements, setRootElementsSort, setCurrentCanvas, domShow, scrawlCanvasHold } <span class="hljs-keyword">from</span> <span class="hljs-string">'../core/document.js'</span>;
<span class="hljs-keyword">import</span> { generateUuid, mergeOver, pushUnique, removeItem, xt, defaultThisReturnFunction } <span class="hljs-keyword">from</span> <span class="hljs-string">'../core/utilities.js'</span>;
<span class="hljs-keyword">import</span> { uiSubscribedElements } <span class="hljs-keyword">from</span> <span class="hljs-string">'../core/userInteraction.js'</span>;

<span class="hljs-keyword">import</span> { makeState } <span class="hljs-keyword">from</span> <span class="hljs-string">'./state.js'</span>;
<span class="hljs-keyword">import</span> { makeCell } <span class="hljs-keyword">from</span> <span class="hljs-string">'./cell.js'</span>;
<span class="hljs-keyword">import</span> { makeCoordinate } <span class="hljs-keyword">from</span> <span class="hljs-string">'./coordinate.js'</span>;

<span class="hljs-keyword">import</span> baseMix <span class="hljs-keyword">from</span> <span class="hljs-string">'../mixin/base.js'</span>;
<span class="hljs-keyword">import</span> positionMix <span class="hljs-keyword">from</span> <span class="hljs-string">'../mixin/position.js'</span>;
<span class="hljs-keyword">import</span> anchorMix <span class="hljs-keyword">from</span> <span class="hljs-string">'../mixin/anchor.js'</span>;
<span class="hljs-keyword">import</span> domMix <span class="hljs-keyword">from</span> <span class="hljs-string">'../mixin/dom.js'</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-9">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-9">&#182;</a>
              </div>
              <h2 id="canvas-constructor">Canvas constructor</h2>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">const</span> Canvas = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">items = {}</span>) </span>{

    <span class="hljs-keyword">let</span> g, el;

    <span class="hljs-keyword">this</span>.makeName(items.name);
    <span class="hljs-keyword">this</span>.register();
    <span class="hljs-keyword">this</span>.initializePositions();

    <span class="hljs-keyword">this</span>.dimensions[<span class="hljs-number">0</span>] = <span class="hljs-number">300</span>;
    <span class="hljs-keyword">this</span>.dimensions[<span class="hljs-number">1</span>] = <span class="hljs-number">150</span>;

    <span class="hljs-keyword">this</span>.pathCorners = [];
    <span class="hljs-keyword">this</span>.css = {};
    <span class="hljs-keyword">this</span>.here = {};
    <span class="hljs-keyword">this</span>.perspective = {

        <span class="hljs-attr">x</span>: <span class="hljs-string">'50%'</span>,
        <span class="hljs-attr">y</span>: <span class="hljs-string">'50%'</span>,
        <span class="hljs-attr">z</span>: <span class="hljs-number">0</span>
    };
    <span class="hljs-keyword">this</span>.dirtyPerspective = <span class="hljs-literal">true</span>;

    <span class="hljs-keyword">this</span>.initializeDomLayout(items);

    <span class="hljs-keyword">this</span>.set(<span class="hljs-keyword">this</span>.defs);

    <span class="hljs-keyword">if</span> (!items.label) items.label = <span class="hljs-string">`<span class="hljs-subst">${<span class="hljs-keyword">this</span>.name}</span> canvas element`</span>;

    <span class="hljs-keyword">this</span>.set(items);

    <span class="hljs-keyword">this</span>.cleanDimensions();

    el = <span class="hljs-keyword">this</span>.domElement;

    <span class="hljs-keyword">if</span> (el) {

        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.trackHere) pushUnique(uiSubscribedElements, <span class="hljs-keyword">this</span>.name);

        <span class="hljs-keyword">this</span>.engine = <span class="hljs-keyword">this</span>.domElement.getContext(<span class="hljs-string">'2d'</span>);

        <span class="hljs-keyword">this</span>.state = makeState({
            <span class="hljs-attr">engine</span>: <span class="hljs-keyword">this</span>.engine
        });</pre></div></div>
            
        </li>
        
        
        <li id="section-10">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-10">&#182;</a>
              </div>
              <p>set up additional cells array</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">this</span>.cells = [];
        <span class="hljs-keyword">this</span>.cellBatchesClear = [];
        <span class="hljs-keyword">this</span>.cellBatchesCompile = [];
        <span class="hljs-keyword">this</span>.cellBatchesShow = [];</pre></div></div>
            
        </li>
        
        
        <li id="section-11">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-11">&#182;</a>
              </div>
              <p>setup base cell</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">let</span> cellArgs = {
            <span class="hljs-attr">name</span>: <span class="hljs-string">`<span class="hljs-subst">${<span class="hljs-keyword">this</span>.name}</span>_base`</span>,
            <span class="hljs-attr">element</span>: <span class="hljs-literal">false</span>,
            <span class="hljs-attr">width</span>: <span class="hljs-keyword">this</span>.currentDimensions[<span class="hljs-number">0</span>],
            <span class="hljs-attr">height</span>: <span class="hljs-keyword">this</span>.currentDimensions[<span class="hljs-number">1</span>],
            <span class="hljs-attr">cleared</span>: <span class="hljs-literal">true</span>,
            <span class="hljs-attr">compiled</span>: <span class="hljs-literal">true</span>,
            <span class="hljs-attr">shown</span>: <span class="hljs-literal">false</span>,
            <span class="hljs-attr">isBase</span>: <span class="hljs-literal">true</span>,
            <span class="hljs-attr">localizeHere</span>: <span class="hljs-literal">true</span>,
            <span class="hljs-attr">host</span>: <span class="hljs-keyword">this</span>.name,
            <span class="hljs-attr">controller</span>: <span class="hljs-keyword">this</span>,
            <span class="hljs-attr">order</span>: <span class="hljs-number">10</span>,
        };
        <span class="hljs-keyword">this</span>.base = <span class="hljs-keyword">this</span>.buildCell(cellArgs);</pre></div></div>
            
        </li>
        
        
        <li id="section-12">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-12">&#182;</a>
              </div>
              <p>even if it is a child of a stack element, it needs to be recorded as a ‘rootElement’</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        pushUnique(rootElements, <span class="hljs-keyword">this</span>.name);
        setRootElementsSort();</pre></div></div>
            
        </li>
        
        
        <li id="section-13">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-13">&#182;</a>
              </div>
              <p>Accessibility</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">if</span> (!el.getAttribute(<span class="hljs-string">'role'</span>)) el.setAttribute(<span class="hljs-string">'role'</span>, <span class="hljs-string">'img'</span>);

        <span class="hljs-keyword">let</span> navigation = <span class="hljs-built_in">document</span>.createElement(<span class="hljs-string">'nav'</span>);
        navigation.id = <span class="hljs-string">`<span class="hljs-subst">${<span class="hljs-keyword">this</span>.name}</span>-navigation`</span>;
        navigation.style.width = <span class="hljs-string">'0px'</span>;
        navigation.style.height = <span class="hljs-string">'0px'</span>;
        navigation.style.maxWidth = <span class="hljs-string">'0px'</span>;
        navigation.style.maxHeight = <span class="hljs-string">'0px'</span>;
        navigation.style.border = <span class="hljs-string">'0px'</span>;
        navigation.style.padding = <span class="hljs-string">'0px'</span>;
        navigation.style.margin = <span class="hljs-string">'0px'</span>;
        navigation.style.overflow = <span class="hljs-string">'hidden'</span>;
        <span class="hljs-keyword">this</span>.navigation = navigation;
        el.parentNode.insertBefore(navigation, el.nextSibling);

        <span class="hljs-keyword">let</span> textHold = <span class="hljs-built_in">document</span>.createElement(<span class="hljs-string">'div'</span>);
        textHold.id = <span class="hljs-string">`<span class="hljs-subst">${<span class="hljs-keyword">this</span>.name}</span>-text-hold`</span>;
        textHold.style.width = <span class="hljs-string">'0px'</span>;
        textHold.style.height = <span class="hljs-string">'0px'</span>;
        textHold.style.maxWidth = <span class="hljs-string">'0px'</span>;
        textHold.style.maxHeight = <span class="hljs-string">'0px'</span>;
        textHold.style.border = <span class="hljs-string">'0px'</span>;
        textHold.style.padding = <span class="hljs-string">'0px'</span>;
        textHold.style.margin = <span class="hljs-string">'0px'</span>;
        textHold.style.overflow = <span class="hljs-string">'hidden'</span>;
        <span class="hljs-keyword">this</span>.textHold = textHold;
        el.parentNode.insertBefore(textHold, el.nextSibling);

        <span class="hljs-keyword">let</span> ariaLabel = <span class="hljs-built_in">document</span>.createElement(<span class="hljs-string">'div'</span>);
        ariaLabel.id = <span class="hljs-string">`<span class="hljs-subst">${<span class="hljs-keyword">this</span>.name}</span>-ARIA-label`</span>;
        ariaLabel.textContent = <span class="hljs-keyword">this</span>.label;
        <span class="hljs-keyword">this</span>.ariaLabelElement = ariaLabel;
        scrawlCanvasHold.appendChild(ariaLabel);
        el.setAttribute(<span class="hljs-string">'aria-labelledby'</span>, ariaLabel.id);

        <span class="hljs-keyword">let</span> ariaDescription = <span class="hljs-built_in">document</span>.createElement(<span class="hljs-string">'div'</span>);
        ariaDescription.id = <span class="hljs-string">`<span class="hljs-subst">${<span class="hljs-keyword">this</span>.name}</span>-ARIA-description`</span>;
        ariaDescription.textContent = <span class="hljs-keyword">this</span>.description;
        <span class="hljs-keyword">this</span>.ariaDescriptionElement = ariaDescription;
        scrawlCanvasHold.appendChild(ariaDescription);
        el.setAttribute(<span class="hljs-string">'aria-describedby'</span>, ariaDescription.id);

        <span class="hljs-keyword">this</span>.cleanAria();
    }

    <span class="hljs-keyword">this</span>.apply();

    <span class="hljs-keyword">if</span> (items.setAsCurrentCanvas) <span class="hljs-keyword">this</span>.setAsCurrentCanvas();
    
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>;
};</pre></div></div>
            
        </li>
        
        
        <li id="section-14">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-14">&#182;</a>
              </div>
              <h2 id="canvas-object-prototype-setup">Canvas object prototype setup</h2>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">let</span> P = Canvas.prototype = <span class="hljs-built_in">Object</span>.create(<span class="hljs-built_in">Object</span>.prototype);
P.type = <span class="hljs-string">'Canvas'</span>;
P.lib = <span class="hljs-string">'canvas'</span>;
P.isArtefact = <span class="hljs-literal">true</span>;
P.isAsset = <span class="hljs-literal">false</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-15">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-15">&#182;</a>
              </div>
              <p>Apply mixins to prototype object</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>P = baseMix(P);
P = positionMix(P);
P = anchorMix(P);
P = domMix(P);</pre></div></div>
            
        </li>
        
        
        <li id="section-16">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-16">&#182;</a>
              </div>
              <h2 id="define-default-attributes">Define default attributes</h2>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">let</span> defaultAttributes = {</pre></div></div>
            
        </li>
        
        
        <li id="section-17">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-17">&#182;</a>
              </div>
              <p>TODO - documentation</p>

            </div>
            
        </li>
        
        
        <li id="section-18">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-18">&#182;</a>
              </div>
              <p>TO TEST - position needs to change to ‘absolute’ when Canvas element is an artefact associated with a stack. But canvas elements can also be created independently of any stack, in which case position:relative should suffice</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    position: <span class="hljs-string">'relative'</span>,</pre></div></div>
            
        </li>
        
        
        <li id="section-19">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-19">&#182;</a>
              </div>
              <p>TODO - documentation</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    trackHere: <span class="hljs-literal">true</span>,</pre></div></div>
            
        </li>
        
        
        <li id="section-20">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-20">&#182;</a>
              </div>
              <p>TODO - documentation</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    dirtyCells: <span class="hljs-literal">true</span>,</pre></div></div>
            
        </li>
        
        
        <li id="section-21">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-21">&#182;</a>
              </div>
              <p>TODO - documentation</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    fit: <span class="hljs-string">'none'</span>,</pre></div></div>
            
        </li>
        
        
        <li id="section-22">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-22">&#182;</a>
              </div>
              <h4 id="accessibility-attributes">Accessibility attributes</h4>

            </div>
            
        </li>
        
        
        <li id="section-23">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-23">&#182;</a>
              </div>
              <ul>
<li><strong>title</strong> attribute is applied to the &lt;canvas&gt; element’s ‘title’ attribute, and will appear as a tooltip when the user hovers over the canvas</li>
</ul>

            </div>
            
        </li>
        
        
        <li id="section-24">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-24">&#182;</a>
              </div>
              <ul>
<li><strong>label</strong> and <strong>description</strong> attributes are applied to (offscreen) div elements which are referenced by the &lt;canvas&gt; element using ‘aria-labelledby’ and ‘aria-describedby’ attributes</li>
</ul>

            </div>
            
        </li>
        
        
        <li id="section-25">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-25">&#182;</a>
              </div>
              <p>If no label value is supplied to the canvas factory (as part of the function’s argument object), then Scrawl-canvas will auto-generate a label based on the canvas’s name. All three attributes can be updated dynamically using the usual .set() functionality.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    title: <span class="hljs-string">''</span>,
    <span class="hljs-attr">label</span>: <span class="hljs-string">''</span>,
    <span class="hljs-attr">description</span>: <span class="hljs-string">''</span>,</pre></div></div>
            
        </li>
        
        
        <li id="section-26">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-26">&#182;</a>
              </div>
              <p>Set to true if canvas is being used as part of a Scrawl-canvas component</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    isComponent: <span class="hljs-literal">false</span>,
};
P.defs = mergeOver(P.defs, defaultAttributes);</pre></div></div>
            
        </li>
        
        
        <li id="section-27">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-27">&#182;</a>
              </div>
              <h2 id="packet-management">Packet management</h2>

            </div>
            
        </li>
        
        
        <li id="section-28">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-28">&#182;</a>
              </div>
              
            </div>
            
        </li>
        
        
        <li id="section-29">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-29">&#182;</a>
              </div>
              <p>Clone functionality disabled</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>P.clone = defaultThisReturnFunction;</pre></div></div>
            
        </li>
        
        
        <li id="section-30">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-30">&#182;</a>
              </div>
              <h2 id="define-attribute-getters-and-setters">Define attribute getters and setters</h2>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">let</span> G = P.getters,
    S = P.setters,
    D = P.deltaSetters;</pre></div></div>
            
        </li>
        
        
        <li id="section-31">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-31">&#182;</a>
              </div>
              <p>TODO - documentation</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>P.fitDefaults = [<span class="hljs-string">'fill'</span>, <span class="hljs-string">'contain'</span>, <span class="hljs-string">'cover'</span>];
S.fit = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">item</span>) </span>{

    <span class="hljs-keyword">this</span>.fit = (<span class="hljs-keyword">this</span>.fitDefaults.indexOf(item) &gt;= <span class="hljs-number">0</span>) ? item : <span class="hljs-string">'none'</span>;
};</pre></div></div>
            
        </li>
        
        
        <li id="section-32">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-32">&#182;</a>
              </div>
              <p>TODO - documentation</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>G.alpha = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{

    <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.base.alpha;
};

G.backgroundColor = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{

    <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.base.backgroundColor;
};

G.composite = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{

    <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.base.composite;
};

S.alpha = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">item</span>) </span>{

    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.base) {

        <span class="hljs-keyword">this</span>.base.set({
            <span class="hljs-attr">alpha</span>: item
        });
    }
};</pre></div></div>
            
        </li>
        
        
        <li id="section-33">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-33">&#182;</a>
              </div>
              <p>TODO - documentation</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>S.backgroundColor = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">item</span>) </span>{

    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.base) {

        <span class="hljs-keyword">this</span>.base.set({
            <span class="hljs-attr">backgroundColor</span>: item
        });
    }
};</pre></div></div>
            
        </li>
        
        
        <li id="section-34">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-34">&#182;</a>
              </div>
              <p>TODO - documentation</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>S.title = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">item</span>) </span>{

    <span class="hljs-keyword">this</span>.title = item;
    <span class="hljs-keyword">this</span>.dirtyAria = <span class="hljs-literal">true</span>;
};

S.label = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">item</span>) </span>{

    <span class="hljs-keyword">this</span>.label = item;
    <span class="hljs-keyword">this</span>.dirtyAria = <span class="hljs-literal">true</span>;
};

S.description = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">item</span>) </span>{

    <span class="hljs-keyword">this</span>.description = item;
    <span class="hljs-keyword">this</span>.dirtyAria = <span class="hljs-literal">true</span>;
};</pre></div></div>
            
        </li>
        
        
        <li id="section-35">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-35">&#182;</a>
              </div>
              <p>TODO - documentation</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>S.composite = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">item</span>) </span>{

    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.base) {
        <span class="hljs-keyword">this</span>.base.set({
            <span class="hljs-attr">composite</span>: item
        });
    }
};</pre></div></div>
            
        </li>
        
        
        <li id="section-36">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-36">&#182;</a>
              </div>
              <p>TODO - documentation</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>D.alpha = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">item</span>) </span>{

    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.base) {

        <span class="hljs-keyword">this</span>.base.deltaSet({
            <span class="hljs-attr">alpha</span>: item
        });
    }
};</pre></div></div>
            
        </li>
        
        
        <li id="section-37">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-37">&#182;</a>
              </div>
              <p>TODO - documentation</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>S.trackHere = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">bool</span>) </span>{

    <span class="hljs-keyword">if</span> (xt(bool)) {

        <span class="hljs-keyword">if</span> (bool) pushUnique(uiSubscribedElements, <span class="hljs-keyword">this</span>.name);
        <span class="hljs-keyword">else</span> removeItem(uiSubscribedElements, <span class="hljs-keyword">this</span>.name);

        <span class="hljs-keyword">this</span>.trackHere = bool;
    }
};</pre></div></div>
            
        </li>
        
        
        <li id="section-38">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-38">&#182;</a>
              </div>
              <h2 id="define-prototype-functions">Define prototype functions</h2>

            </div>
            
        </li>
        
        
        <li id="section-39">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-39">&#182;</a>
              </div>
              <p>TODO - documentation</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>P.setAsCurrentCanvas = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{

    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.base) setCurrentCanvas(<span class="hljs-keyword">this</span>);
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>;
};</pre></div></div>
            
        </li>
        
        
        <li id="section-40">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-40">&#182;</a>
              </div>
              <p>TODO - documentation</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>P.setBase = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">items</span>) </span>{

    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.base) {

        <span class="hljs-keyword">this</span>.base.set(items);
        <span class="hljs-keyword">this</span>.setBaseHelper();
    }
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>;
};</pre></div></div>
            
        </li>
        
        
        <li id="section-41">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-41">&#182;</a>
              </div>
              <p>TODO - documentation</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>P.deltaSetBase = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">items</span>) </span>{

    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.base) {

        <span class="hljs-keyword">this</span>.base.deltaSet(items);
        <span class="hljs-keyword">this</span>.setBaseHelper();
    }
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>;
};</pre></div></div>
            
        </li>
        
        
        <li id="section-42">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-42">&#182;</a>
              </div>
              <p>TODO - documentation</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>P.updateBaseHere = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{

    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.base) <span class="hljs-keyword">this</span>.base.updateBaseHere(<span class="hljs-keyword">this</span>.here, <span class="hljs-keyword">this</span>.fit);
};</pre></div></div>
            
        </li>
        
        
        <li id="section-43">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-43">&#182;</a>
              </div>
              <p>TODO - documentation</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>P.setBaseHelper = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{

    <span class="hljs-keyword">let</span> items = {};

    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.base.dirtyScale) items.dirtyScale = <span class="hljs-literal">true</span>;
    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.base.dirtyDimensions) items.dirtyDimensions = <span class="hljs-literal">true</span>;
    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.base.dirtyLock) items.dirtyLock = <span class="hljs-literal">true</span>;
    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.base.dirtyStart) items.dirtyStart = <span class="hljs-literal">true</span>;
    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.base.dirtyOffset) items.dirtyOffset = <span class="hljs-literal">true</span>;
    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.base.dirtyHandle) items.dirtyHandle = <span class="hljs-literal">true</span>;
    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.base.dirtyRotation) items.dirtyRotation = <span class="hljs-literal">true</span>;

    <span class="hljs-keyword">this</span>.cleanCells();
    <span class="hljs-keyword">this</span>.base.prepareStamp();

    <span class="hljs-keyword">this</span>.updateCells(items);
};</pre></div></div>
            
        </li>
        
        
        <li id="section-44">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-44">&#182;</a>
              </div>
              <p>TODO - documentation</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>P.updateCells = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">items = {}</span>) </span>{

    <span class="hljs-keyword">this</span>.cells.forEach(<span class="hljs-function"><span class="hljs-params">name</span> =&gt;</span> {

        <span class="hljs-keyword">let</span> mycell = cell[name];

        <span class="hljs-keyword">if</span> (mycell) {

            <span class="hljs-keyword">if</span> (items.dirtyScale) mycell.dirtyScale = <span class="hljs-literal">true</span>;
            <span class="hljs-keyword">if</span> (items.dirtyDimensions) mycell.dirtyDimensions = <span class="hljs-literal">true</span>;
            <span class="hljs-keyword">if</span> (items.dirtyLock) mycell.dirtyLock = <span class="hljs-literal">true</span>;
            <span class="hljs-keyword">if</span> (items.dirtyStart) mycell.dirtyStart = <span class="hljs-literal">true</span>;
            <span class="hljs-keyword">if</span> (items.dirtyOffset) mycell.dirtyOffset = <span class="hljs-literal">true</span>;
            <span class="hljs-keyword">if</span> (items.dirtyHandle) mycell.dirtyHandle = <span class="hljs-literal">true</span>;
            <span class="hljs-keyword">if</span> (items.dirtyRotation) mycell.dirtyRotation = <span class="hljs-literal">true</span>;
        }
    });
};</pre></div></div>
            
        </li>
        
        
        <li id="section-45">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-45">&#182;</a>
              </div>
              <p>TODO - documentation</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>P.buildCell = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">items = {}</span>) </span>{

    <span class="hljs-keyword">let</span> host = items.host || <span class="hljs-literal">false</span>;

    <span class="hljs-keyword">if</span> (!host) items.host = <span class="hljs-keyword">this</span>.base.name;

    <span class="hljs-keyword">let</span> mycell = makeCell(items);
    
    <span class="hljs-keyword">this</span>.addCell(mycell);
    <span class="hljs-keyword">this</span>.cleanCells();
    <span class="hljs-keyword">return</span> mycell;
};</pre></div></div>
            
        </li>
        
        
        <li id="section-46">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-46">&#182;</a>
              </div>
              <p>TODO - documentation</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>P.cleanDimensionsAdditionalActions = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{

    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.cells) {

        <span class="hljs-keyword">this</span>.updateCells({
            <span class="hljs-attr">dirtyDimensions</span>: <span class="hljs-literal">true</span>,
        });
    }

    <span class="hljs-keyword">this</span>.dirtyDomDimensions = <span class="hljs-literal">true</span>;
};</pre></div></div>
            
        </li>
        
        
        <li id="section-47">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-47">&#182;</a>
              </div>
              <p>TODO - documentation</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>P.addCell = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">item</span>) </span>{

    item = (item.substring) ? item : item.name || <span class="hljs-literal">false</span>;

    <span class="hljs-keyword">if</span> (item) {

        pushUnique(<span class="hljs-keyword">this</span>.cells, item);
        cell[item].prepareStamp();
        <span class="hljs-keyword">this</span>.dirtyCells = <span class="hljs-literal">true</span>;
    }
    <span class="hljs-keyword">return</span> item;
};</pre></div></div>
            
        </li>
        
        
        <li id="section-48">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-48">&#182;</a>
              </div>
              <p>TODO - documentation</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>P.removeCell = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">item</span>) </span>{

    item = (item.substring) ? item : item.name || <span class="hljs-literal">false</span>;

    <span class="hljs-keyword">if</span> (item) {

        removeItem(<span class="hljs-keyword">this</span>.cells, item);
        <span class="hljs-keyword">this</span>.dirtyCells = <span class="hljs-literal">true</span>;
    }
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>;
};</pre></div></div>
            
        </li>
        
        
        <li id="section-49">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-49">&#182;</a>
              </div>
              <p>TODO - is this all that is needed? </p>

            </div>
            
        </li>
        
        
        <li id="section-50">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-50">&#182;</a>
              </div>
              <p>Assume that killing a cell involves also killing its associated group(s) and any entitys, tweens, filters etc currently associated with it?</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>P.killCell = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">item</span>) </span>{

    <span class="hljs-keyword">let</span> mycell = (item.substring) ? cell[item] : item;

    <span class="hljs-keyword">if</span> (mycell) mycell.demolishCell();

    <span class="hljs-keyword">this</span>.dirtyCells = <span class="hljs-literal">true</span>;
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>;
};</pre></div></div>
            
        </li>
        
        
        <li id="section-51">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-51">&#182;</a>
              </div>
              <p>TODO - code up this functionality</p>

            </div>
            
        </li>
        
        
        <li id="section-52">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-52">&#182;</a>
              </div>
              <p>In the DOM, we need to:</p>
<ul>
<li>remove the canvas element</li>
<li>remove all the ARIA elements associated with it</li>
<li>remove the textHold element associated with it</li>
</ul>

            </div>
            
        </li>
        
        
        <li id="section-53">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-53">&#182;</a>
              </div>
              <p>In Scrawl-canvas, we need to:</p>
<ul>
<li>remove the base cell associated with the canvas<ul>
<li>which probably needs functionality coded up in factory/Cell.js</li>
<li>see if we need to add in checks for the existence of the object in tweens and pivot/mimic positioning functionality</li>
</ul>
</li>
<li>remove the canvas object from the library (artefact, canvas) - see if we need to overwrite core/base.js function</li>
</ul>

            </div>
            
            <div class="content"><div class='highlight'><pre>P.demolish = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">removeDomElement = true</span>) </span>{

    removeItem(uiSubscribedElements, <span class="hljs-keyword">this</span>.name);

    removeItem(rootElements, <span class="hljs-keyword">this</span>.name);
    setRootElementsSort();

    <span class="hljs-keyword">let</span> el = <span class="hljs-keyword">this</span>.domElement,
        navigation = <span class="hljs-keyword">this</span>.navigation,
        textHold = <span class="hljs-keyword">this</span>.textHold,
        ariaLabel = <span class="hljs-keyword">this</span>.ariaLabelElement,
        ariaDescription = <span class="hljs-keyword">this</span>.ariaDescriptionElement;

    navigation.parentNode.removeChild(navigation);
    textHold.parentNode.removeChild(textHold);
    ariaLabel.parentNode.removeChild(ariaLabel);
    ariaDescription.parentNode.removeChild(ariaDescription);
    <span class="hljs-keyword">if</span> (removeDomElement) el.parentNode.removeChild(el);

    <span class="hljs-keyword">this</span>.killCell(<span class="hljs-keyword">this</span>.base);

    <span class="hljs-keyword">this</span>.deregister();

    <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
};</pre></div></div>
            
        </li>
        
        
        <li id="section-54">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-54">&#182;</a>
              </div>
              <p>TODO - documentation</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>P.clear = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{

    <span class="hljs-keyword">let</span> self = <span class="hljs-keyword">this</span>;

    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Promise</span>(<span class="hljs-function">(<span class="hljs-params">resolve</span>) =&gt;</span> {

        <span class="hljs-keyword">let</span> promises = [];

        <span class="hljs-keyword">if</span> (self.dirtyCells) self.cleanCells();

        self.cellBatchesClear.forEach(<span class="hljs-function"><span class="hljs-params">mycell</span> =&gt;</span> promises.push(mycell.clear()));

        <span class="hljs-built_in">Promise</span>.all(promises)
        .then(<span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> resolve(<span class="hljs-literal">true</span>))
        .catch(<span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> resolve(<span class="hljs-literal">false</span>));
    });
};</pre></div></div>
            
        </li>
        
        
        <li id="section-55">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-55">&#182;</a>
              </div>
              <p>TODO - documentation</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>P.compile = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{

    <span class="hljs-keyword">let</span> self = <span class="hljs-keyword">this</span>;

    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Promise</span>(<span class="hljs-function">(<span class="hljs-params">resolve</span>) =&gt;</span> {

        <span class="hljs-keyword">let</span> promises = [];

        <span class="hljs-keyword">if</span> (self.dirtyCells) self.cleanCells();

        self.cellBatchesCompile.forEach(<span class="hljs-function"><span class="hljs-params">mycell</span> =&gt;</span> promises.push(mycell.compile()));

        <span class="hljs-built_in">Promise</span>.all(promises)
        .then(<span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> self.prepareStamp())
        .then(<span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> self.stamp())
        .then(<span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> resolve(<span class="hljs-literal">true</span>))
        .catch(<span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> resolve(<span class="hljs-literal">false</span>));
    });
};</pre></div></div>
            
        </li>
        
        
        <li id="section-56">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-56">&#182;</a>
              </div>
              <p>TODO - documentation</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>P.show = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)</span>{

    <span class="hljs-keyword">let</span> self = <span class="hljs-keyword">this</span>;

    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Promise</span>(<span class="hljs-function">(<span class="hljs-params">resolve</span>) =&gt;</span> {

        <span class="hljs-keyword">let</span> promises = [];

        <span class="hljs-keyword">if</span> (self.dirtyCells) self.cleanCells();

        self.cellBatchesShow.forEach(<span class="hljs-function"><span class="hljs-params">mycell</span> =&gt;</span> promises.push(mycell.show()));

        <span class="hljs-built_in">Promise</span>.all(promises)
        .then(<span class="hljs-function">(<span class="hljs-params">res</span>) =&gt;</span> {

            self.engine.clearRect(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, self.localWidth, self.localHeight);
            <span class="hljs-keyword">return</span> self.base.show();
        })
        .then(<span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> {

            domShow();

            <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.dirtyAria) <span class="hljs-keyword">this</span>.cleanAria();

            resolve(<span class="hljs-literal">true</span>);
        })
        .catch(<span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> resolve(<span class="hljs-literal">false</span>));
    });
};</pre></div></div>
            
        </li>
        
        
        <li id="section-57">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-57">&#182;</a>
              </div>
              <p>TODO - documentation</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>P.render = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{

    <span class="hljs-keyword">let</span> self = <span class="hljs-keyword">this</span>;

    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Promise</span>(<span class="hljs-function">(<span class="hljs-params">resolve</span>) =&gt;</span> {

        self.clear()
        .then(<span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> self.compile())
        .then(<span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> self.show())
        .then(<span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> resolve(<span class="hljs-literal">true</span>))
        .catch(<span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> resolve(<span class="hljs-literal">false</span>));
    });
};</pre></div></div>
            
        </li>
        
        
        <li id="section-58">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-58">&#182;</a>
              </div>
              <p>TODO - documentation</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>P.cleanCells = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{

    <span class="hljs-keyword">this</span>.dirtyCells = <span class="hljs-literal">false</span>;

    <span class="hljs-keyword">let</span> tempClear = [],
        tempCompile = [],
        tempShow = [],
        cells = <span class="hljs-keyword">this</span>.cells,
        order;

    cells.forEach(<span class="hljs-function"><span class="hljs-params">item</span> =&gt;</span> {

        <span class="hljs-keyword">let</span> mycell = cell[item];

        <span class="hljs-keyword">if</span> (mycell) {

            <span class="hljs-keyword">if</span> (mycell.cleared) tempClear.push(mycell);

            <span class="hljs-keyword">if</span> (mycell.compiled) {

                order = mycell.compileOrder;

                <span class="hljs-keyword">if</span> (!tempCompile[order]) tempCompile[order] = [];

                tempCompile[order].push(mycell);
            }

            <span class="hljs-keyword">if</span> (mycell.shown) {

                order = mycell.showOrder;

                <span class="hljs-keyword">if</span> (!tempShow[order]) tempShow[order] = [];
                tempShow[order].push(mycell);
            }
        }
    });

    <span class="hljs-keyword">this</span>.cellBatchesClear = [].concat(tempClear);
    <span class="hljs-keyword">this</span>.cellBatchesCompile = tempCompile.reduce(<span class="hljs-function">(<span class="hljs-params">a, v</span>) =&gt;</span> a.concat(v), []);
    <span class="hljs-keyword">this</span>.cellBatchesShow = tempShow.reduce(<span class="hljs-function">(<span class="hljs-params">a, v</span>) =&gt;</span> a.concat(v), []);
};</pre></div></div>
            
        </li>
        
        
        <li id="section-59">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-59">&#182;</a>
              </div>
              <p>Trigger event action responses in (visible) entitys at the current mouse/touch </p>

            </div>
            
        </li>
        
        
        <li id="section-60">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-60">&#182;</a>
              </div>
              <p>Trigger event action responses in (visible) entitys at the current canvas element <em>here</em> attribute coordinates</p>

            </div>
            
        </li>
        
        
        <li id="section-61">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-61">&#182;</a>
              </div>
              <ul>
<li>Available cascadeEventAction arguments are: ‘enter’, ‘leave’, ‘down’, or ‘up’</li>
</ul>

            </div>
            
        </li>
        
        
        <li id="section-62">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-62">&#182;</a>
              </div>
              <ul>
<li>A ‘move’ argument can also be used, which will trigger enter and leave actions on the entitys, as appropriate to each</li>
</ul>

            </div>
            
        </li>
        
        
        <li id="section-63">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-63">&#182;</a>
              </div>
              <p>Function returns an Array of name Strings for the entitys at the current mouse cursor coordinates </p>

            </div>
            
            <div class="content"><div class='highlight'><pre>P.cascadeEventAction = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">action</span>) </span>{

    <span class="hljs-keyword">if</span> (!<span class="hljs-keyword">this</span>.currentActiveEntityNames) <span class="hljs-keyword">this</span>.currentActiveEntityNames = [];

    <span class="hljs-keyword">let</span> currentActiveEntityNames = <span class="hljs-keyword">this</span>.currentActiveEntityNames,
        testActiveEntityObjects = [],
        testActiveEntityNames = [],
        newActiveEntityObjects = [],
        newActiveEntityNames = [],
        knownActiveEntityObjects = [],
        knownActiveEntityNames = [];</pre></div></div>
            
        </li>
        
        
        <li id="section-64">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-64">&#182;</a>
              </div>
              <ol>
<li>Find all entitys currently colliding with the mouse/touch coordinate over the canvas</li>
</ol>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">this</span>.cells.forEach(<span class="hljs-function"><span class="hljs-params">name</span> =&gt;</span> {

        <span class="hljs-keyword">let</span> myCell = cell[name];

        <span class="hljs-keyword">if</span> (myCell &amp;&amp; (myCell.shown || myCell.isBase)) testActiveEntityObjects.push(myCell.getEntityHits());
    });

    testActiveEntityObjects = testActiveEntityObjects.reduce(<span class="hljs-function">(<span class="hljs-params">a, v</span>) =&gt;</span> a.concat(v), []);</pre></div></div>
            
        </li>
        
        
        <li id="section-65">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-65">&#182;</a>
              </div>
              <ol start="2">
<li>Process the returned test results</li>
</ol>

            </div>
            
            <div class="content"><div class='highlight'><pre>    testActiveEntityObjects.forEach(<span class="hljs-function"><span class="hljs-params">item</span> =&gt;</span> {

        <span class="hljs-keyword">let</span> name = item.name;

        <span class="hljs-keyword">if</span> (testActiveEntityNames.indexOf(name) &lt; <span class="hljs-number">0</span>) {

            testActiveEntityNames.push(name);

            <span class="hljs-keyword">if</span> (currentActiveEntityNames.indexOf(name) &lt; <span class="hljs-number">0</span>) {

                newActiveEntityObjects.push(item);
                newActiveEntityNames.push(name);
            }
            <span class="hljs-keyword">else</span> {

                knownActiveEntityObjects.push(item);
                knownActiveEntityNames.push(name);
            }
        }
    });

    <span class="hljs-keyword">let</span> currentActiveEntityObjects = newActiveEntityObjects.concat(knownActiveEntityObjects);</pre></div></div>
            
        </li>
        
        
        <li id="section-66">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-66">&#182;</a>
              </div>
              <ol start="3">
<li>Trigger the required action on each affected entity</li>
</ol>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">let</span> doLeave = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{

        <span class="hljs-keyword">if</span> (currentActiveEntityNames.length) {

            newActiveEntityNames.forEach(<span class="hljs-function"><span class="hljs-params">name</span> =&gt;</span> removeItem(currentActiveEntityNames, name));
            knownActiveEntityNames.forEach(<span class="hljs-function"><span class="hljs-params">name</span> =&gt;</span> removeItem(currentActiveEntityNames, name));

            currentActiveEntityNames.forEach(<span class="hljs-function"><span class="hljs-params">name</span> =&gt;</span> {

                <span class="hljs-keyword">let</span> myArt = artefact[name];

                <span class="hljs-keyword">if</span> (myArt) myArt.onLeave();
            });
        }
    };

    <span class="hljs-keyword">switch</span> (action) {

        <span class="hljs-keyword">case</span> <span class="hljs-string">'down'</span> :
            currentActiveEntityObjects.forEach(<span class="hljs-function"><span class="hljs-params">art</span> =&gt;</span> art.onDown());
            <span class="hljs-keyword">break</span>;

        <span class="hljs-keyword">case</span> <span class="hljs-string">'up'</span> :
            currentActiveEntityObjects.forEach(<span class="hljs-function"><span class="hljs-params">art</span> =&gt;</span> art.onUp());
            <span class="hljs-keyword">break</span>;

        <span class="hljs-keyword">case</span> <span class="hljs-string">'enter'</span> :
            newActiveEntityObjects.forEach(<span class="hljs-function"><span class="hljs-params">art</span> =&gt;</span> art.onEnter());
            <span class="hljs-keyword">break</span>;

        <span class="hljs-keyword">case</span> <span class="hljs-string">'leave'</span> :
            doLeave();
            <span class="hljs-keyword">break</span>;

        <span class="hljs-keyword">case</span> <span class="hljs-string">'move'</span> :
            doLeave();
            newActiveEntityObjects.forEach(<span class="hljs-function"><span class="hljs-params">art</span> =&gt;</span> art.onEnter());
            <span class="hljs-keyword">break</span>;
    }</pre></div></div>
            
        </li>
        
        
        <li id="section-67">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-67">&#182;</a>
              </div>
              <ol start="4">
<li>Cleanup and return</li>
</ol>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">this</span>.currentActiveEntityNames = newActiveEntityNames.concat(knownActiveEntityNames);

    <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.currentActiveEntityNames;
};</pre></div></div>
            
        </li>
        
        
        <li id="section-68">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-68">&#182;</a>
              </div>
              <p>TODO - documentation</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>P.cleanAria = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{

    <span class="hljs-keyword">this</span>.dirtyAria = <span class="hljs-literal">false</span>;
    <span class="hljs-keyword">this</span>.domElement.setAttribute(<span class="hljs-string">'title'</span>, <span class="hljs-keyword">this</span>.title);
    <span class="hljs-keyword">this</span>.ariaLabelElement.textContent = <span class="hljs-keyword">this</span>.label;
    <span class="hljs-keyword">this</span>.ariaDescriptionElement.textContent = <span class="hljs-keyword">this</span>.description;
}</pre></div></div>
            
        </li>
        
        
        <li id="section-69">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-69">&#182;</a>
              </div>
              <h2 id="exported-factory-function">Exported factory function</h2>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">const</span> makeCanvas = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">items</span>) </span>{
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> Canvas(items);
};

constructors.Canvas = Canvas;

<span class="hljs-keyword">export</span> {
    makeCanvas,
};</pre></div></div>
            
        </li>
        
    </ul>
  </div>
</body>
</html>
