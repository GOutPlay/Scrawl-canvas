<!DOCTYPE html>

<html>
<head>
  <title>Phrase factory</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <meta name="viewport" content="width=device-width, target-densitydpi=160dpi, initial-scale=1.0; maximum-scale=1.0; user-scalable=0;">
  <link rel="stylesheet" media="all" href="../../docco.css" />
</head>
<body>
  <div id="container">
    <div id="background"></div>
    
      <ul id="jump_to">
        <li>
          <a class="large" href="javascript:void(0);">Jump To &hellip;</a>
          <a class="small" href="javascript:void(0);">+</a>
          <div id="jump_wrapper">
          <div id="jump_page_wrapper">
            <div id="jump_page">
              
                
                <a class="source" href="../core/animationloop.html">
                  ./source/core/animationloop.js
                </a>
              
                
                <a class="source" href="../core/component.html">
                  ./source/core/component.js
                </a>
              
                
                <a class="source" href="../core/document.html">
                  ./source/core/document.js
                </a>
              
                
                <a class="source" href="../core/init.html">
                  ./source/core/init.js
                </a>
              
                
                <a class="source" href="../core/library.html">
                  ./source/core/library.js
                </a>
              
                
                <a class="source" href="../core/userInteraction.html">
                  ./source/core/userInteraction.js
                </a>
              
                
                <a class="source" href="../core/utilities.html">
                  ./source/core/utilities.js
                </a>
              
                
                <a class="source" href="action.html">
                  ./source/factory/action.js
                </a>
              
                
                <a class="source" href="anchor.html">
                  ./source/factory/anchor.js
                </a>
              
                
                <a class="source" href="animation.html">
                  ./source/factory/animation.js
                </a>
              
                
                <a class="source" href="block.html">
                  ./source/factory/block.js
                </a>
              
                
                <a class="source" href="canvas.html">
                  ./source/factory/canvas.js
                </a>
              
                
                <a class="source" href="cell.html">
                  ./source/factory/cell.js
                </a>
              
                
                <a class="source" href="color.html">
                  ./source/factory/color.js
                </a>
              
                
                <a class="source" href="coordinate.html">
                  ./source/factory/coordinate.js
                </a>
              
                
                <a class="source" href="element.html">
                  ./source/factory/element.js
                </a>
              
                
                <a class="source" href="filter.html">
                  ./source/factory/filter.js
                </a>
              
                
                <a class="source" href="fontAttributes.html">
                  ./source/factory/fontAttributes.js
                </a>
              
                
                <a class="source" href="gradient.html">
                  ./source/factory/gradient.js
                </a>
              
                
                <a class="source" href="grid.html">
                  ./source/factory/grid.js
                </a>
              
                
                <a class="source" href="group.html">
                  ./source/factory/group.js
                </a>
              
                
                <a class="source" href="imageAsset.html">
                  ./source/factory/imageAsset.js
                </a>
              
                
                <a class="source" href="loom.html">
                  ./source/factory/loom.js
                </a>
              
                
                <a class="source" href="palette.html">
                  ./source/factory/palette.js
                </a>
              
                
                <a class="source" href="pattern.html">
                  ./source/factory/pattern.js
                </a>
              
                
                <a class="source" href="phrase.html">
                  ./source/factory/phrase.js
                </a>
              
                
                <a class="source" href="picture.html">
                  ./source/factory/picture.js
                </a>
              
                
                <a class="source" href="quaternion.html">
                  ./source/factory/quaternion.js
                </a>
              
                
                <a class="source" href="radialGradient.html">
                  ./source/factory/radialGradient.js
                </a>
              
                
                <a class="source" href="renderAnimation.html">
                  ./source/factory/renderAnimation.js
                </a>
              
                
                <a class="source" href="shape.html">
                  ./source/factory/shape.js
                </a>
              
                
                <a class="source" href="spriteAsset.html">
                  ./source/factory/spriteAsset.js
                </a>
              
                
                <a class="source" href="stack.html">
                  ./source/factory/stack.js
                </a>
              
                
                <a class="source" href="state.html">
                  ./source/factory/state.js
                </a>
              
                
                <a class="source" href="ticker.html">
                  ./source/factory/ticker.js
                </a>
              
                
                <a class="source" href="tween.html">
                  ./source/factory/tween.js
                </a>
              
                
                <a class="source" href="unstackedElement.html">
                  ./source/factory/unstackedElement.js
                </a>
              
                
                <a class="source" href="vector.html">
                  ./source/factory/vector.js
                </a>
              
                
                <a class="source" href="videoAsset.html">
                  ./source/factory/videoAsset.js
                </a>
              
                
                <a class="source" href="wheel.html">
                  ./source/factory/wheel.js
                </a>
              
                
                <a class="source" href="../mixin/anchor.html">
                  ./source/mixin/anchor.js
                </a>
              
                
                <a class="source" href="../mixin/asset.html">
                  ./source/mixin/asset.js
                </a>
              
                
                <a class="source" href="../mixin/assetConsumer.html">
                  ./source/mixin/assetConsumer.js
                </a>
              
                
                <a class="source" href="../mixin/base.html">
                  ./source/mixin/base.js
                </a>
              
                
                <a class="source" href="../mixin/cascade.html">
                  ./source/mixin/cascade.js
                </a>
              
                
                <a class="source" href="../mixin/dom.html">
                  ./source/mixin/dom.js
                </a>
              
                
                <a class="source" href="../mixin/entity.html">
                  ./source/mixin/entity.js
                </a>
              
                
                <a class="source" href="../mixin/filter.html">
                  ./source/mixin/filter.js
                </a>
              
                
                <a class="source" href="../mixin/position.html">
                  ./source/mixin/position.js
                </a>
              
                
                <a class="source" href="../mixin/shapePathCalculation.html">
                  ./source/mixin/shapePathCalculation.js
                </a>
              
                
                <a class="source" href="../mixin/styles.html">
                  ./source/mixin/styles.js
                </a>
              
                
                <a class="source" href="../mixin/tween.html">
                  ./source/mixin/tween.js
                </a>
              
                
                <a class="source" href="../worker/filter.html">
                  ./source/worker/filter.js
                </a>
              
            </div>
          </div>
        </li>
      </ul>
    
    <ul class="sections">
        
        
        
        <li id="section-1">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-1">&#182;</a>
              </div>
              
            </div>
            
        </li>
        
        
        <li id="section-2">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-2">&#182;</a>
              </div>
              <h1 id="phrase-factory">Phrase factory</h1>

            </div>
            
        </li>
        
        
        <li id="section-3">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-3">&#182;</a>
              </div>
              <p>TODO - documentation</p>

            </div>
            
        </li>
        
        
        <li id="section-4">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-4">&#182;</a>
              </div>
              <h4 id="to-instantiate-objects-from-the-factory">To instantiate objects from the factory</h4>

            </div>
            
        </li>
        
        
        <li id="section-5">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-5">&#182;</a>
              </div>
              <h4 id="library-storage">Library storage</h4>

            </div>
            
        </li>
        
        
        <li id="section-6">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-6">&#182;</a>
              </div>
              <h4 id="clone-functionality">Clone functionality</h4>

            </div>
            
        </li>
        
        
        <li id="section-7">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-7">&#182;</a>
              </div>
              <h4 id="kill-functionality">Kill functionality</h4>

            </div>
            
        </li>
        
        
        <li id="section-8">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-8">&#182;</a>
              </div>
              <h2 id="imports">Imports</h2>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">import</span> { constructors, cell, cellnames, styles, stylesnames, artefact } <span class="hljs-keyword">from</span> <span class="hljs-string">'../core/library.js'</span>;
<span class="hljs-keyword">import</span> { scrawlCanvasHold } <span class="hljs-keyword">from</span> <span class="hljs-string">'../core/document.js'</span>;
<span class="hljs-keyword">import</span> { mergeOver, pushUnique, xt, ensurePositiveFloat, ensureFloat, ensureString } <span class="hljs-keyword">from</span> <span class="hljs-string">'../core/utilities.js'</span>;

<span class="hljs-keyword">import</span> { requestCell, releaseCell } <span class="hljs-keyword">from</span> <span class="hljs-string">'./cell.js'</span>;

<span class="hljs-keyword">import</span> { makeFontAttributes } <span class="hljs-keyword">from</span> <span class="hljs-string">'./fontAttributes.js'</span>;

<span class="hljs-keyword">import</span> baseMix <span class="hljs-keyword">from</span> <span class="hljs-string">'../mixin/base.js'</span>;
<span class="hljs-keyword">import</span> positionMix <span class="hljs-keyword">from</span> <span class="hljs-string">'../mixin/position.js'</span>;
<span class="hljs-keyword">import</span> anchorMix <span class="hljs-keyword">from</span> <span class="hljs-string">'../mixin/anchor.js'</span>;
<span class="hljs-keyword">import</span> entityMix <span class="hljs-keyword">from</span> <span class="hljs-string">'../mixin/entity.js'</span>;
<span class="hljs-keyword">import</span> filterMix <span class="hljs-keyword">from</span> <span class="hljs-string">'../mixin/filter.js'</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-9">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-9">&#182;</a>
              </div>
              <p>Constants used by Phrase entitys</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">const</span> fontHeightCalculator = <span class="hljs-built_in">document</span>.createElement(<span class="hljs-string">'div'</span>);
fontHeightCalculator.style.padding = <span class="hljs-number">0</span>;
fontHeightCalculator.style.border = <span class="hljs-number">0</span>;
fontHeightCalculator.style.margin = <span class="hljs-number">0</span>;
fontHeightCalculator.style.height = <span class="hljs-string">'auto'</span>;
fontHeightCalculator.style.lineHeight = <span class="hljs-number">1</span>;
fontHeightCalculator.style.boxSizing = <span class="hljs-string">'border-box'</span>;
fontHeightCalculator.innerHTML = <span class="hljs-string">'|/}ÁÅþ§¶¿∑ƒ⌈⌊qwertyd0123456789QWERTY'</span>;
scrawlCanvasHold.appendChild(fontHeightCalculator);

<span class="hljs-keyword">const</span> textEntityConverter = <span class="hljs-built_in">document</span>.createElement(<span class="hljs-string">'textarea'</span>);</pre></div></div>
            
        </li>
        
        
        <li id="section-10">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-10">&#182;</a>
              </div>
              <h2 id="phrase-constructor">Phrase constructor</h2>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">const</span> Phrase = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">items = {}</span>) </span>{

    <span class="hljs-keyword">this</span>.fontAttributes = makeFontAttributes(items);

    <span class="hljs-keyword">delete</span> items.font;
    <span class="hljs-keyword">delete</span> items.style;
    <span class="hljs-keyword">delete</span> items.variant;
    <span class="hljs-keyword">delete</span> items.weight;
    <span class="hljs-keyword">delete</span> items.stretch;
    <span class="hljs-keyword">delete</span> items.size;
    <span class="hljs-keyword">delete</span> items.sizeValue;
    <span class="hljs-keyword">delete</span> items.sizeMetric;
    <span class="hljs-keyword">delete</span> items.family;

    <span class="hljs-keyword">this</span>.entityInit(items);

    <span class="hljs-keyword">this</span>.glyphStyles = [];

    <span class="hljs-keyword">this</span>.dirtyText = <span class="hljs-literal">true</span>;
    <span class="hljs-keyword">this</span>.dirtyFont = <span class="hljs-literal">true</span>;
    <span class="hljs-keyword">this</span>.dirtyPathObject = <span class="hljs-literal">true</span>;

    <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>;
};</pre></div></div>
            
        </li>
        
        
        <li id="section-11">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-11">&#182;</a>
              </div>
              <h2 id="phrase-object-prototype-setup">Phrase object prototype setup</h2>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">let</span> P = Phrase.prototype = <span class="hljs-built_in">Object</span>.create(<span class="hljs-built_in">Object</span>.prototype);
P.type = <span class="hljs-string">'Phrase'</span>;
P.lib = <span class="hljs-string">'entity'</span>;
P.isArtefact = <span class="hljs-literal">true</span>;
P.isAsset = <span class="hljs-literal">false</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-12">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-12">&#182;</a>
              </div>
              <p>Apply mixins to prototype object</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>P = baseMix(P);
P = positionMix(P);
P = anchorMix(P);
P = entityMix(P);
P = filterMix(P);</pre></div></div>
            
        </li>
        
        
        <li id="section-13">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-13">&#182;</a>
              </div>
              <h2 id="define-default-attributes">Define default attributes</h2>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">let</span> defaultAttributes = {</pre></div></div>
            
        </li>
        
        
        <li id="section-14">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-14">&#182;</a>
              </div>
              <p>TODO - documentation</p>

            </div>
            
        </li>
        
        
        <li id="section-15">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-15">&#182;</a>
              </div>
              <p>How many of these attributes need to be in the defs section? If they’re internal, they should not be here!</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    text: <span class="hljs-string">''</span>,
    <span class="hljs-attr">textPositions</span>: <span class="hljs-literal">null</span>,</pre></div></div>
            
        </li>
        
        
        <li id="section-16">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-16">&#182;</a>
              </div>
              <p>TODO - documentation</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    textLines: <span class="hljs-literal">null</span>,
    <span class="hljs-attr">textLineWidths</span>: <span class="hljs-literal">null</span>,
    <span class="hljs-attr">textLineWords</span>: <span class="hljs-literal">null</span>,

    <span class="hljs-attr">treatWordAsGlyph</span>: <span class="hljs-literal">false</span>,

    <span class="hljs-attr">textGlyphs</span>: <span class="hljs-literal">null</span>,
    <span class="hljs-attr">textGlyphWidths</span>: <span class="hljs-literal">null</span>,</pre></div></div>
            
        </li>
        
        
        <li id="section-17">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-17">&#182;</a>
              </div>
              <p>Accessibility feature - when <strong>exposeText</strong> is set to true, Scrawl-canvas will create an element in the DOM and mirror its current text value in that element. The element - a div - is attached to the canvas element’s textHold element, which immediately follows that element and has zero dimensions, so its contents don’t interfere with the flow of the rest of the DOM content.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    exposeText: <span class="hljs-literal">false</span>,</pre></div></div>
            
        </li>
        
        
        <li id="section-18">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-18">&#182;</a>
              </div>
              <p>Glyphs (individual letters) can be individually styled by adding a styling object to the <strong>glyphStyles</strong> array. Subsequent glyphs will inherit those styles until a second styling object is encountered further along the array.</p>

            </div>
            
        </li>
        
        
        <li id="section-19">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-19">&#182;</a>
              </div>
              <p>Subsequent styling objects will alter specified attributes, leaving other attributes in their current (not default) state. To reset all attributes to their defaults and at the same time change selected attributes, include <em>defaults: true</em> in the object.</p>

            </div>
            
        </li>
        
        
        <li id="section-20">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-20">&#182;</a>
              </div>
              <p>The styling object can take one or more of the following attributes:</p>

            </div>
            
        </li>
        
        
        <li id="section-21">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-21">&#182;</a>
              </div>
              <ul>
<li>style - eg ‘italic’</li>
<li>variant - eg ‘small-caps’</li>
<li>weight - eg ‘bold’</li>
<li>stretch</li>
<li>size - any permitted font size value</li>
<li>family </li>
</ul>

            </div>
            
        </li>
        
        
        <li id="section-22">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-22">&#182;</a>
              </div>
              <ul>
<li>space - alter the letterSpacing values to spread or condense glyphs</li>
</ul>

            </div>
            
        </li>
        
        
        <li id="section-23">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-23">&#182;</a>
              </div>
              <ul>
<li>fill - fillStyle to be applied to the glyph</li>
<li>stroke - strokeStyle to be applied to the glyph</li>
</ul>

            </div>
            
        </li>
        
        
        <li id="section-24">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-24">&#182;</a>
              </div>
              <ul>
<li>highlight - boolean - whether highlight should be applied to the glyph</li>
</ul>

            </div>
            
        </li>
        
        
        <li id="section-25">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-25">&#182;</a>
              </div>
              <ul>
<li>underline - boolean - whether underline should be applied to the glyph</li>
<li>overline - boolean - whether overline should be applied to the glyph</li>
</ul>

            </div>
            
        </li>
        
        
        <li id="section-26">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-26">&#182;</a>
              </div>
              <ul>
<li>defaults - boolean - setting this to true will set the glyph (and subsequent glyphs) to the Phrase entity’s current font and fill/stroke style values</li>
</ul>

            </div>
            
        </li>
        
        
        <li id="section-27">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-27">&#182;</a>
              </div>
              <p>Example: “make the word <strong>glyphs</strong> bold”</p>

            </div>
            
        </li>
        
        
        <li id="section-28">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-28">&#182;</a>
              </div>
              <p>   myPhrase.setGlyphStyles(14, {weight: ‘bold’});
   myPhrase.setGlyphStyles(20, {defaults: true});
   myPhrase.setGlyphStyles(22, {fill: ‘red’});</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    glyphStyles: [],</pre></div></div>
            
        </li>
        
        
        <li id="section-29">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-29">&#182;</a>
              </div>
              <p>Permitted values are: ‘left’ (default), ‘center’, ‘right’, ‘full’</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    justify: <span class="hljs-string">'left'</span>,</pre></div></div>
            
        </li>
        
        
        <li id="section-30">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-30">&#182;</a>
              </div>
              <p>A multiplier applied to the font height to add space between lines of text</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    lineHeight: <span class="hljs-number">1.5</span>,</pre></div></div>
            
        </li>
        
        
        <li id="section-31">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-31">&#182;</a>
              </div>
              <p>The position and stroke style to be applied to a glyph when it is set to show underline or overline</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    overlinePosition: <span class="hljs-number">0.1</span>,
    <span class="hljs-attr">overlineStyle</span>: <span class="hljs-string">'rgb(250,0,0)'</span>,
    <span class="hljs-attr">underlinePosition</span>: <span class="hljs-number">0.6</span>,
    <span class="hljs-attr">underlineStyle</span>: <span class="hljs-string">'rgb(250,0,0)'</span>,</pre></div></div>
            
        </li>
        
        
        <li id="section-32">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-32">&#182;</a>
              </div>
              <p>The fill style to be applied to a glyph when it is set to show background highlighting</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    highlightStyle: <span class="hljs-string">'rgba(250,218,94,0.4)'</span>,</pre></div></div>
            
        </li>
        
        
        <li id="section-33">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-33">&#182;</a>
              </div>
              <p>A set number of pixels to place between each glyph. Positive numbers only</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    letterSpacing: <span class="hljs-number">0</span>,</pre></div></div>
            
        </li>
        
        
        <li id="section-34">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-34">&#182;</a>
              </div>
              <p>TODO - documentation</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    textPath: <span class="hljs-string">''</span>,
    <span class="hljs-attr">textPathPosition</span>: <span class="hljs-number">0</span>,
    <span class="hljs-attr">textPathDirection</span>: <span class="hljs-string">'ltr'</span>,
    <span class="hljs-attr">textPathLoop</span>: <span class="hljs-literal">true</span>,
    <span class="hljs-attr">addTextPathRoll</span>: <span class="hljs-literal">true</span>,</pre></div></div>
            
        </li>
        
        
        <li id="section-35">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-35">&#182;</a>
              </div>
              <p>TODO - documentation</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    boundingBoxColor: <span class="hljs-string">'rgba(0,0,0,0.5)'</span>,
    <span class="hljs-attr">showBoundingBox</span>: <span class="hljs-literal">false</span>,
};
P.defs = mergeOver(P.defs, defaultAttributes);</pre></div></div>
            
        </li>
        
        
        <li id="section-36">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-36">&#182;</a>
              </div>
              <h2 id="packet-management">Packet management</h2>

            </div>
            
            <div class="content"><div class='highlight'><pre>P.packetExclusions = pushUnique(P.packetExclusions, [<span class="hljs-string">'textPositions'</span>, <span class="hljs-string">'textLines'</span>, <span class="hljs-string">'textLineWidths'</span>, <span class="hljs-string">'textLineWords'</span>, <span class="hljs-string">'textGlyphs'</span>, <span class="hljs-string">'textGlyphWidths'</span>, <span class="hljs-string">'fontAttributes'</span>]);
P.packetExclusionsByRegex = pushUnique(P.packetExclusionsByRegex, []);
P.packetCoordinates = pushUnique(P.packetCoordinates, []);
P.packetObjects = pushUnique(P.packetObjects, []);
P.packetFunctions = pushUnique(P.packetFunctions, []);

P.finalizePacketOut = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">copy, items</span>) </span>{

    <span class="hljs-keyword">let</span> stateCopy = <span class="hljs-built_in">JSON</span>.parse(<span class="hljs-keyword">this</span>.state.saveAsPacket(items))[<span class="hljs-number">3</span>];
    copy = mergeOver(copy, stateCopy);

    <span class="hljs-keyword">let</span> fontAttributesCopy = <span class="hljs-built_in">JSON</span>.parse(<span class="hljs-keyword">this</span>.fontAttributes.saveAsPacket(items))[<span class="hljs-number">3</span>];
    <span class="hljs-keyword">delete</span> fontAttributesCopy.name;
    copy = mergeOver(copy, fontAttributesCopy);

    copy = <span class="hljs-keyword">this</span>.handlePacketAnchor(copy, items);

    <span class="hljs-keyword">return</span> copy;
};</pre></div></div>
            
        </li>
        
        
        <li id="section-37">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-37">&#182;</a>
              </div>
              <h2 id="define-getter-setter-and-deltasetter-functions">Define getter, setter and deltaSetter functions</h2>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">let</span> G = P.getters,
    S = P.setters,
    D = P.deltaSetters;</pre></div></div>
            
        </li>
        
        
        <li id="section-38">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-38">&#182;</a>
              </div>
              <p>Overwrites mixin/position.js function</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>S.handleX = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">coord</span>) </span>{

    <span class="hljs-keyword">if</span> (coord != <span class="hljs-literal">null</span>) {

        <span class="hljs-keyword">this</span>.handle[<span class="hljs-number">0</span>] = coord;
        <span class="hljs-keyword">this</span>.dirtyHandle = <span class="hljs-literal">true</span>;
        <span class="hljs-keyword">this</span>.dirtyText = <span class="hljs-literal">true</span>;
        <span class="hljs-keyword">this</span>.dirtyPathObject = <span class="hljs-literal">true</span>;
    }
};
S.handleY = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">coord</span>) </span>{

    <span class="hljs-keyword">if</span> (coord != <span class="hljs-literal">null</span>) {

        <span class="hljs-keyword">this</span>.handle[<span class="hljs-number">1</span>] = coord;
        <span class="hljs-keyword">this</span>.dirtyHandle = <span class="hljs-literal">true</span>;
        <span class="hljs-keyword">this</span>.dirtyText = <span class="hljs-literal">true</span>;
        <span class="hljs-keyword">this</span>.dirtyPathObject = <span class="hljs-literal">true</span>;
    }
};
S.handle = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">x, y</span>) </span>{

    <span class="hljs-keyword">this</span>.setCoordinateHelper(<span class="hljs-string">'handle'</span>, x, y);
    <span class="hljs-keyword">this</span>.dirtyHandle = <span class="hljs-literal">true</span>;
    <span class="hljs-keyword">this</span>.dirtyText = <span class="hljs-literal">true</span>;
    <span class="hljs-keyword">this</span>.dirtyPathObject = <span class="hljs-literal">true</span>;
};
D.handleX = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">coord</span>) </span>{

    <span class="hljs-keyword">let</span> c = <span class="hljs-keyword">this</span>.handle;
    c[<span class="hljs-number">0</span>] = addStrings(c[<span class="hljs-number">0</span>], coord);
    <span class="hljs-keyword">this</span>.dirtyHandle = <span class="hljs-literal">true</span>;
    <span class="hljs-keyword">this</span>.dirtyText = <span class="hljs-literal">true</span>;
    <span class="hljs-keyword">this</span>.dirtyPathObject = <span class="hljs-literal">true</span>;
};
D.handleY = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">coord</span>) </span>{

    <span class="hljs-keyword">let</span> c = <span class="hljs-keyword">this</span>.handle;
    c[<span class="hljs-number">1</span>] = addStrings(c[<span class="hljs-number">1</span>], coord);
    <span class="hljs-keyword">this</span>.dirtyHandle = <span class="hljs-literal">true</span>;
    <span class="hljs-keyword">this</span>.dirtyText = <span class="hljs-literal">true</span>;
    <span class="hljs-keyword">this</span>.dirtyPathObject = <span class="hljs-literal">true</span>;
};
D.handle = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">x, y</span>) </span>{

    <span class="hljs-keyword">this</span>.setDeltaCoordinateHelper(<span class="hljs-string">'handle'</span>, x, y);
    <span class="hljs-keyword">this</span>.dirtyHandle = <span class="hljs-literal">true</span>;
    <span class="hljs-keyword">this</span>.dirtyText = <span class="hljs-literal">true</span>;
    <span class="hljs-keyword">this</span>.dirtyPathObject = <span class="hljs-literal">true</span>;
};</pre></div></div>
            
        </li>
        
        
        <li id="section-39">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-39">&#182;</a>
              </div>
              <p>TODO - documentation</p>

            </div>
            
        </li>
        
        
        <li id="section-40">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-40">&#182;</a>
              </div>
              <p>Retrieving aspects of the font string</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>G.style = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{

    <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.fontAttributes.get(<span class="hljs-string">'style'</span>);
};
G.variant = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{

    <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.fontAttributes.get(<span class="hljs-string">'variant'</span>);
};
G.weight = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{

    <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.fontAttributes.get(<span class="hljs-string">'weight'</span>);
};
G.stretch = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{

    <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.fontAttributes.get(<span class="hljs-string">'stretch'</span>);
};
G.size = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{

    <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.fontAttributes.get(<span class="hljs-string">'size'</span>);
};
G.sizeValue = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{

    <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.fontAttributes.get(<span class="hljs-string">'sizeValue'</span>);
};
G.sizeMetric = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{

    <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.fontAttributes.get(<span class="hljs-string">'sizeMetric'</span>);
};
G.family = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{

    <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.fontAttributes.get(<span class="hljs-string">'family'</span>);
};
G.font = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{

    <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.fontAttributes.get(<span class="hljs-string">'font'</span>);
};</pre></div></div>
            
        </li>
        
        
        <li id="section-41">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-41">&#182;</a>
              </div>
              <p>TODO - documentation</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>S.font = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">item</span>) </span>{

    <span class="hljs-keyword">this</span>.fontAttributes.set({<span class="hljs-attr">font</span>: item});

    <span class="hljs-keyword">this</span>.dirtyFont = <span class="hljs-literal">true</span>;
    <span class="hljs-keyword">this</span>.dirtyPathObject = <span class="hljs-literal">true</span>;
};
S.style = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">item</span>) </span>{

    <span class="hljs-keyword">this</span>.fontAttributes.set({<span class="hljs-attr">style</span>: item});

    <span class="hljs-keyword">this</span>.dirtyFont = <span class="hljs-literal">true</span>;
    <span class="hljs-keyword">this</span>.dirtyPathObject = <span class="hljs-literal">true</span>;
};
S.variant = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">item</span>) </span>{

    <span class="hljs-keyword">this</span>.fontAttributes.set({<span class="hljs-attr">variant</span>: item});

    <span class="hljs-keyword">this</span>.dirtyFont = <span class="hljs-literal">true</span>;
    <span class="hljs-keyword">this</span>.dirtyPathObject = <span class="hljs-literal">true</span>;
};
S.weight = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">item</span>) </span>{

    <span class="hljs-keyword">this</span>.fontAttributes.set({<span class="hljs-attr">weight</span>: item});

    <span class="hljs-keyword">this</span>.dirtyFont = <span class="hljs-literal">true</span>;
    <span class="hljs-keyword">this</span>.dirtyPathObject = <span class="hljs-literal">true</span>;
};
S.stretch = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">item</span>) </span>{

    <span class="hljs-keyword">this</span>.fontAttributes.set({<span class="hljs-attr">stretch</span>: item});

    <span class="hljs-keyword">this</span>.dirtyFont = <span class="hljs-literal">true</span>;
    <span class="hljs-keyword">this</span>.dirtyPathObject = <span class="hljs-literal">true</span>;
};
S.size = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">item</span>) </span>{

    <span class="hljs-keyword">this</span>.fontAttributes.set({<span class="hljs-attr">size</span>: item});

    <span class="hljs-keyword">this</span>.dirtyFont = <span class="hljs-literal">true</span>;
    <span class="hljs-keyword">this</span>.dirtyPathObject = <span class="hljs-literal">true</span>;
};
S.sizeValue = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">item</span>) </span>{

    <span class="hljs-keyword">this</span>.fontAttributes.set({<span class="hljs-attr">sizeValue</span>: item});

    <span class="hljs-keyword">this</span>.dirtyFont = <span class="hljs-literal">true</span>;
    <span class="hljs-keyword">this</span>.dirtyPathObject = <span class="hljs-literal">true</span>;
};
D.sizeValue = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">item</span>) </span>{

    <span class="hljs-keyword">this</span>.fontAttributes.deltaSet({<span class="hljs-attr">sizeValue</span>: item});

    <span class="hljs-keyword">this</span>.dirtyFont = <span class="hljs-literal">true</span>;
    <span class="hljs-keyword">this</span>.dirtyPathObject = <span class="hljs-literal">true</span>;
};
S.sizeMetric = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">item</span>) </span>{

    <span class="hljs-keyword">this</span>.fontAttributes.set({<span class="hljs-attr">sizeMetric</span>: item});

    <span class="hljs-keyword">this</span>.dirtyFont = <span class="hljs-literal">true</span>;
    <span class="hljs-keyword">this</span>.dirtyPathObject = <span class="hljs-literal">true</span>;
};
S.family = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">item</span>) </span>{
    
    <span class="hljs-keyword">this</span>.fontAttributes.set({<span class="hljs-attr">family</span>: item});

    <span class="hljs-keyword">this</span>.dirtyFont = <span class="hljs-literal">true</span>;
    <span class="hljs-keyword">this</span>.dirtyPathObject = <span class="hljs-literal">true</span>;
};</pre></div></div>
            
        </li>
        
        
        <li id="section-42">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-42">&#182;</a>
              </div>
              <p>TODO - documentation</p>

            </div>
            
        </li>
        
        
        <li id="section-43">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-43">&#182;</a>
              </div>
              <p>Handling text updates</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>S.textPath = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">item</span>) </span>{

    <span class="hljs-keyword">this</span>.textPath = item;

    <span class="hljs-keyword">this</span>.dirtyHandle = <span class="hljs-literal">true</span>;
    <span class="hljs-keyword">this</span>.dirtyText = <span class="hljs-literal">true</span>;
    <span class="hljs-keyword">this</span>.dirtyPathObject = <span class="hljs-literal">true</span>;
};</pre></div></div>
            
        </li>
        
        
        <li id="section-44">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-44">&#182;</a>
              </div>
              <p>TODO - documentation</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>S.text = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">item</span>) </span>{

    <span class="hljs-keyword">this</span>.text = ensureString(item);
    
    <span class="hljs-keyword">this</span>.dirtyText = <span class="hljs-literal">true</span>;
    <span class="hljs-keyword">this</span>.dirtyPathObject = <span class="hljs-literal">true</span>;
};</pre></div></div>
            
        </li>
        
        
        <li id="section-45">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-45">&#182;</a>
              </div>
              <p>TODO - documentation</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>P.permittedJustifications = [<span class="hljs-string">'left'</span>, <span class="hljs-string">'right'</span>, <span class="hljs-string">'center'</span>, <span class="hljs-string">'full'</span>];
S.justify = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">item</span>) </span>{

    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.permittedJustifications.indexOf(item) &gt;= <span class="hljs-number">0</span>) <span class="hljs-keyword">this</span>.justify = item;
    
    <span class="hljs-keyword">this</span>.dirtyText = <span class="hljs-literal">true</span>;
    <span class="hljs-keyword">this</span>.dirtyPathObject = <span class="hljs-literal">true</span>;
};</pre></div></div>
            
        </li>
        
        
        <li id="section-46">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-46">&#182;</a>
              </div>
              <p>TODO - documentation</p>

            </div>
            
        </li>
        
        
        <li id="section-47">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-47">&#182;</a>
              </div>
              <p>Handling text width - overwrites functions defined in mixin/entity.js</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>S.width = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">item</span>) </span>{

    <span class="hljs-keyword">this</span>.dimensions[<span class="hljs-number">0</span>] = item;

    <span class="hljs-keyword">this</span>.dirtyDimensions = <span class="hljs-literal">true</span>;
    <span class="hljs-keyword">this</span>.dirtyHandle = <span class="hljs-literal">true</span>;
    <span class="hljs-keyword">this</span>.dirtyPathObject = <span class="hljs-literal">true</span>;
    <span class="hljs-keyword">this</span>.dirtyText = <span class="hljs-literal">true</span>;
};
D.width = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">item</span>) </span>{

    <span class="hljs-keyword">let</span> c = <span class="hljs-keyword">this</span>.dimensions;
    c[<span class="hljs-number">0</span>] = addStrings(c[<span class="hljs-number">0</span>], item);

    <span class="hljs-keyword">this</span>.dirtyDimensions = <span class="hljs-literal">true</span>;
    <span class="hljs-keyword">this</span>.dirtyHandle = <span class="hljs-literal">true</span>;
    <span class="hljs-keyword">this</span>.dirtyPathObject = <span class="hljs-literal">true</span>;
    <span class="hljs-keyword">this</span>.dirtyText = <span class="hljs-literal">true</span>;
};
S.scale = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">item</span>) </span>{

    <span class="hljs-keyword">this</span>.scale = item;

    <span class="hljs-keyword">this</span>.dirtyDimensions = <span class="hljs-literal">true</span>;
    <span class="hljs-keyword">this</span>.dirtyHandle = <span class="hljs-literal">true</span>;
    <span class="hljs-keyword">this</span>.dirtyFont = <span class="hljs-literal">true</span>;
    <span class="hljs-keyword">this</span>.dirtyPathObject = <span class="hljs-literal">true</span>;
    <span class="hljs-keyword">this</span>.dirtyScale = <span class="hljs-literal">true</span>;
};
D.scale = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">item</span>) </span>{

    <span class="hljs-keyword">this</span>.scale += item;

    <span class="hljs-keyword">this</span>.dirtyDimensions = <span class="hljs-literal">true</span>;
    <span class="hljs-keyword">this</span>.dirtyHandle = <span class="hljs-literal">true</span>;
    <span class="hljs-keyword">this</span>.dirtyFont = <span class="hljs-literal">true</span>;
    <span class="hljs-keyword">this</span>.dirtyPathObject = <span class="hljs-literal">true</span>;
    <span class="hljs-keyword">this</span>.dirtyScale = <span class="hljs-literal">true</span>;
};</pre></div></div>
            
        </li>
        
        
        <li id="section-48">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-48">&#182;</a>
              </div>
              <p>TODO - documentation</p>

            </div>
            
        </li>
        
        
        <li id="section-49">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-49">&#182;</a>
              </div>
              <p>Manipulating lineHeight and letterSpacing attributes</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>S.lineHeight = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">item</span>) </span>{

    <span class="hljs-keyword">this</span>.lineHeight = ensurePositiveFloat(item, <span class="hljs-number">3</span>);

    <span class="hljs-keyword">this</span>.dirtyPathObject = <span class="hljs-literal">true</span>;
    <span class="hljs-keyword">this</span>.dirtyText = <span class="hljs-literal">true</span>;
};
D.lineHeight = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">item</span>) </span>{

    <span class="hljs-keyword">this</span>.lineHeight += ensureFloat(item, <span class="hljs-number">3</span>);
    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.lineHeight &lt; <span class="hljs-number">0</span>) <span class="hljs-keyword">this</span>.lineHeight = <span class="hljs-number">0</span>;

    <span class="hljs-keyword">this</span>.dirtyPathObject = <span class="hljs-literal">true</span>;
    <span class="hljs-keyword">this</span>.dirtyText = <span class="hljs-literal">true</span>;
};

S.letterSpacing = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">item</span>) </span>{

    <span class="hljs-keyword">this</span>.letterSpacing = ensurePositiveFloat(item, <span class="hljs-number">3</span>);

    <span class="hljs-keyword">this</span>.dirtyPathObject = <span class="hljs-literal">true</span>;
    <span class="hljs-keyword">this</span>.dirtyText = <span class="hljs-literal">true</span>;
};
D.letterSpacing = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">item</span>) </span>{

    <span class="hljs-keyword">this</span>.letterSpacing += ensureFloat(item, <span class="hljs-number">3</span>);
    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.letterSpacing &lt; <span class="hljs-number">0</span>) <span class="hljs-keyword">this</span>.letterSpacing = <span class="hljs-number">0</span>;

    <span class="hljs-keyword">this</span>.dirtyPathObject = <span class="hljs-literal">true</span>;
    <span class="hljs-keyword">this</span>.dirtyText = <span class="hljs-literal">true</span>;
};

S.overlinePosition = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">item</span>) </span>{

    <span class="hljs-keyword">this</span>.overlinePosition = ensureFloat(item, <span class="hljs-number">3</span>);

    <span class="hljs-keyword">this</span>.dirtyPathObject = <span class="hljs-literal">true</span>;
    <span class="hljs-keyword">this</span>.dirtyText = <span class="hljs-literal">true</span>;
};
D.overlinePosition = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">item</span>) </span>{

    <span class="hljs-keyword">this</span>.overlinePosition += ensureFloat(item, <span class="hljs-number">3</span>);

    <span class="hljs-keyword">this</span>.dirtyPathObject = <span class="hljs-literal">true</span>;
    <span class="hljs-keyword">this</span>.dirtyText = <span class="hljs-literal">true</span>;
};

S.underlinePosition = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">item</span>) </span>{

    <span class="hljs-keyword">this</span>.underlinePosition = ensureFloat(item, <span class="hljs-number">3</span>);

    <span class="hljs-keyword">this</span>.dirtyPathObject = <span class="hljs-literal">true</span>;
    <span class="hljs-keyword">this</span>.dirtyText = <span class="hljs-literal">true</span>;
};
D.underlinePosition = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">item</span>) </span>{

    <span class="hljs-keyword">this</span>.underlinePosition += ensureFloat(item, <span class="hljs-number">3</span>);

    <span class="hljs-keyword">this</span>.dirtyPathObject = <span class="hljs-literal">true</span>;
    <span class="hljs-keyword">this</span>.dirtyText = <span class="hljs-literal">true</span>;
};</pre></div></div>
            
        </li>
        
        
        <li id="section-50">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-50">&#182;</a>
              </div>
              <p>TODO - documentation</p>

            </div>
            
        </li>
        
        
        <li id="section-51">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-51">&#182;</a>
              </div>
              <p>textPathPosition needs to take into account whether the text is looping along the path, or not</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>S.textPathPosition = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">item</span>) </span>{

    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.textPathLoop) {

        item = <span class="hljs-built_in">Math</span>.abs(item);
        <span class="hljs-keyword">this</span>.textPathPosition = item - <span class="hljs-built_in">Math</span>.floor(item);
    }
    <span class="hljs-keyword">else</span> <span class="hljs-keyword">this</span>.textPathPosition = item;
};

D.textPathPosition = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">item</span>) </span>{

    <span class="hljs-keyword">let</span> newVal = <span class="hljs-keyword">this</span>.textPathPosition + item;

    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.textPathLoop) {

        newVal = <span class="hljs-built_in">Math</span>.abs(newVal);
        <span class="hljs-keyword">this</span>.textPathPosition = newVal - <span class="hljs-built_in">Math</span>.floor(newVal);
    }
    <span class="hljs-keyword">else</span> <span class="hljs-keyword">this</span>.textPathPosition = newVal;
};</pre></div></div>
            
        </li>
        
        
        <li id="section-52">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-52">&#182;</a>
              </div>
              <h2 id="define-prototype-functions">Define prototype functions</h2>

            </div>
            
        </li>
        
        
        <li id="section-53">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-53">&#182;</a>
              </div>
              <p>TODO - documentation</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>P.setGlyphStyles = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">args, ...pos</span>) </span>{

    <span class="hljs-keyword">if</span> (args &amp;&amp; <span class="hljs-built_in">Array</span>.isArray(pos)) {

        <span class="hljs-keyword">let</span> styles = <span class="hljs-keyword">this</span>.glyphStyles,
            slot, style, i, iz;

        <span class="hljs-keyword">for</span> (i = <span class="hljs-number">0</span>, iz = pos.length; i &lt; iz; i++) {

            slot = pos[i];
            style = styles[slot];

            <span class="hljs-keyword">if</span> (!style) styles[slot] = args;
            <span class="hljs-keyword">else</span> mergeOver(style, args);
        }

        <span class="hljs-keyword">this</span>.dirtyPathObject = <span class="hljs-literal">true</span>;
        <span class="hljs-keyword">this</span>.dirtyText = <span class="hljs-literal">true</span>;
    }

    <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>;
};</pre></div></div>
            
        </li>
        
        
        <li id="section-54">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-54">&#182;</a>
              </div>
              <p>TODO - documentation</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>P.getTextPath = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{

    <span class="hljs-keyword">let</span> path = <span class="hljs-keyword">this</span>.textPath;

    <span class="hljs-keyword">if</span> (path &amp;&amp; path.substring) {

        path = <span class="hljs-keyword">this</span>.textPath = artefact[<span class="hljs-keyword">this</span>.textPath];

        <span class="hljs-keyword">if</span> (path.type === <span class="hljs-string">'Shape'</span> &amp;&amp; path.useAsPath) path.pathed.push(<span class="hljs-keyword">this</span>.name);
        <span class="hljs-keyword">else</span> {

            path = <span class="hljs-keyword">this</span>.path = <span class="hljs-literal">false</span>;
        }
    }

    <span class="hljs-keyword">return</span> path;
};</pre></div></div>
            
        </li>
        
        
        <li id="section-55">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-55">&#182;</a>
              </div>
              <p>TODO - documentation</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>P.buildText = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{

    <span class="hljs-keyword">this</span>.dirtyText = <span class="hljs-literal">false</span>;
    <span class="hljs-keyword">this</span>.text = <span class="hljs-keyword">this</span>.convertTextEntityCharacters(<span class="hljs-keyword">this</span>.text);
    <span class="hljs-keyword">this</span>.calculateTextPositions(<span class="hljs-keyword">this</span>.text);

    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.exposeText) {

        <span class="hljs-keyword">if</span> (!<span class="hljs-keyword">this</span>.exposedTextHold) {

            <span class="hljs-keyword">let</span> myhold = <span class="hljs-built_in">document</span>.createElement(<span class="hljs-string">'div'</span>);
            myhold.id = <span class="hljs-string">`<span class="hljs-subst">${<span class="hljs-keyword">this</span>.name}</span>-text-hold`</span>;
            <span class="hljs-keyword">this</span>.exposedTextHold = myhold;
            <span class="hljs-keyword">this</span>.exposedTextHoldAttached = <span class="hljs-literal">false</span>;
        }

        <span class="hljs-keyword">this</span>.exposedTextHold.textContent = <span class="hljs-keyword">this</span>.text;

        <span class="hljs-keyword">if</span> (!<span class="hljs-keyword">this</span>.exposedTextHoldAttached) {

            <span class="hljs-keyword">if</span>(<span class="hljs-keyword">this</span>.currentHost &amp;&amp; <span class="hljs-keyword">this</span>.currentHost.controller &amp;&amp; <span class="hljs-keyword">this</span>.currentHost.controller.textHold) {

                <span class="hljs-keyword">this</span>.currentHost.controller.textHold.appendChild(<span class="hljs-keyword">this</span>.exposedTextHold);
                <span class="hljs-keyword">this</span>.exposedTextHoldAttached = <span class="hljs-literal">true</span>;
            }
        }
    }
};</pre></div></div>
            
        </li>
        
        
        <li id="section-56">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-56">&#182;</a>
              </div>
              <p>TODO - documentation</p>

            </div>
            
        </li>
        
        
        <li id="section-57">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-57">&#182;</a>
              </div>
              <p>To get convert any HTML entity (eg: &lt; &epsilon;) in the text string into their required glyphs</p>

            </div>
            
        </li>
        
        
        <li id="section-58">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-58">&#182;</a>
              </div>
              <p>Also removes excessive white space</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>P.convertTextEntityCharacters = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">item</span>) </span>{

    <span class="hljs-keyword">let</span> mytext = item.trim();

    mytext = mytext.replace(<span class="hljs-regexp">/[\s\uFEFF\xA0]+/g</span>, <span class="hljs-string">' '</span>);

    textEntityConverter.innerHTML = mytext;
    <span class="hljs-keyword">return</span> textEntityConverter.value;
};</pre></div></div>
            
        </li>
        
        
        <li id="section-59">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-59">&#182;</a>
              </div>
              <p>TODO - documentation</p>

            </div>
            
        </li>
        
        
        <li id="section-60">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-60">&#182;</a>
              </div>
              <p>(If you are not a fan of big, complex functions … look away now!)</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>P.calculateTextPositions = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">mytext</span>) </span>{</pre></div></div>
            
        </li>
        
        
        <li id="section-61">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-61">&#182;</a>
              </div>
              <ol start="0">
<li>strokeStyle/fillStyle helper function
TODO: need to check (with a demo-test) that we can use gradients and patterns as styles</li>
</ol>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">let</span> makeStyle = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">item</span>) </span>{

        <span class="hljs-keyword">if</span> (item.substring) {

            <span class="hljs-keyword">let</span> brokenStyle = <span class="hljs-literal">false</span>;

            <span class="hljs-keyword">if</span> (stylesnames.indexOf(item) &gt;= <span class="hljs-number">0</span>) brokenStyle = styles[item];
            <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (cellnames.indexOf(item) &gt;= <span class="hljs-number">0</span>) brokenStyle = cell[item];

            <span class="hljs-keyword">if</span> (brokenStyle) <span class="hljs-keyword">return</span> brokenStyle.getData(self, host, <span class="hljs-literal">true</span>);
            <span class="hljs-keyword">else</span> <span class="hljs-keyword">return</span> item;
        }
        <span class="hljs-keyword">else</span> <span class="hljs-keyword">return</span> item.getData(self, host, <span class="hljs-literal">true</span>);
    };</pre></div></div>
            
        </li>
        
        
        <li id="section-62">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-62">&#182;</a>
              </div>
              <ol>
<li>setup - get values for text? arrays, current?, highlight?, ?Attributes, etc
TODO - check code uses all of these local variables; remove those that are not used</li>
</ol>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">let</span> myCell = requestCell(),
        engine = myCell.engine;

    <span class="hljs-keyword">let</span> self = <span class="hljs-keyword">this</span>,
        host = (<span class="hljs-keyword">this</span>.group &amp;&amp; <span class="hljs-keyword">this</span>.group.getHost) ? <span class="hljs-keyword">this</span>.group.getHost() : myCell;

    <span class="hljs-keyword">let</span> textGlyphs, 
        textGlyphWidths = [], 
        textLines = [], 
        textLineWidths = [],
        textLineWords = [], 
        textPositions = [],
        spacesArray = [],
        gStyle, gPos, item, 
        starts, ends, cursor, word, height,
        space, i, iz, j, jz, k, kz;

    <span class="hljs-keyword">let</span> fragment, len, glyphArr, glyph, nextGlyph, glyphWidth, lineLen, totalLen,
        singles = [],
        pairs = [],
        path = <span class="hljs-keyword">this</span>.getTextPath(),
        direction, loop, rotate;

    <span class="hljs-keyword">let</span> fontAttributes = <span class="hljs-keyword">this</span>.fontAttributes,
        glyphAttributes = fontAttributes.clone({});

    <span class="hljs-keyword">let</span> glyphStyles = <span class="hljs-keyword">this</span>.glyphStyles;

    <span class="hljs-keyword">let</span> state = <span class="hljs-keyword">this</span>.state,
        fontLibrary = {},
        fontArray = [];

    <span class="hljs-keyword">let</span> scale = <span class="hljs-keyword">this</span>.currentScale,
        dims = <span class="hljs-keyword">this</span>.currentDimensions,
        width = dims[<span class="hljs-number">0</span>] * scale,
        treatWordAsGlyph = <span class="hljs-keyword">this</span>.treatWordAsGlyph,
        lineHeight = <span class="hljs-keyword">this</span>.lineHeight,
        justify = <span class="hljs-keyword">this</span>.justify,
        handle, handleX, handleY;

    <span class="hljs-keyword">let</span> defaultFont = fontAttributes.update(scale), 
        defaultFillStyle = makeStyle(state.fillStyle), 
        defaultStrokeStyle = makeStyle(state.strokeStyle), 
        defaultSpace = <span class="hljs-keyword">this</span>.letterSpacing * scale, 

        currentFont = defaultFont, 
        currentFillStyle = defaultFillStyle, 
        currentStrokeStyle = defaultStrokeStyle, 
        currentSpace = defaultSpace;

    <span class="hljs-keyword">let</span> highlightStyle = (<span class="hljs-keyword">this</span>.highlightStyle) ? makeStyle(<span class="hljs-keyword">this</span>.highlightStyle) : <span class="hljs-literal">false</span>,
        highlightFlag = <span class="hljs-literal">false</span>;

    <span class="hljs-keyword">let</span> underlineStyle = (<span class="hljs-keyword">this</span>.underlineStyle) ? makeStyle(<span class="hljs-keyword">this</span>.underlineStyle) : <span class="hljs-literal">false</span>,
        underlinePosition = <span class="hljs-keyword">this</span>.underlinePosition,
        underlineFlag = <span class="hljs-literal">false</span>;

    <span class="hljs-keyword">let</span> overlineStyle = (<span class="hljs-keyword">this</span>.overlineStyle) ? makeStyle(<span class="hljs-keyword">this</span>.overlineStyle) : <span class="hljs-literal">false</span>,
        overlinePosition = <span class="hljs-keyword">this</span>.overlinePosition,
        overlineFlag = <span class="hljs-literal">false</span>;

    <span class="hljs-keyword">let</span> maxHeight = <span class="hljs-number">0</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-63">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-63">&#182;</a>
              </div>
              <ol start="2">
<li>create textGlyphs array</li>
</ol>
<ul>
<li>also shove the default font into the fontLibrary array</li>
</ul>

            </div>
            
            <div class="content"><div class='highlight'><pre>    textGlyphs = (treatWordAsGlyph) ? <span class="hljs-keyword">this</span>.text.split(<span class="hljs-string">' '</span>) : <span class="hljs-keyword">this</span>.text.split(<span class="hljs-string">''</span>);
    fontArray.push(currentFont);</pre></div></div>
            
        </li>
        
        
        <li id="section-64">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-64">&#182;</a>
              </div>
              <ol start="3">
<li>textPositions array will include an array of data for each glyph</li>
</ol>
<ul>
<li>[font, strokeStyle, fillStyle, highlight, underline, overline, text, startX, startY, (pathData)]</li>
<li>and populate spacesArray with space position data (for full justify calculations later)
TODO - does current code use SpacesArray? If not, refactor code to delete it</li>
</ul>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">for</span> (i = <span class="hljs-number">0</span>, iz = textGlyphs.length; i &lt; iz; i++) {

        item = textGlyphs[i];

        textPositions[i] = [, , , , , , item, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>];

        <span class="hljs-keyword">if</span> (item === <span class="hljs-string">' '</span>) spacesArray.push(i);
    }</pre></div></div>
            
        </li>
        
        
        <li id="section-65">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-65">&#182;</a>
              </div>
              <ol start="4">
<li>process the glyphStyles array to start populating the textPositions arrays</li>
</ol>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">if</span> (!glyphStyles[<span class="hljs-number">0</span>]) glyphStyles[<span class="hljs-number">0</span>] = {
        <span class="hljs-attr">family</span>: glyphAttributes.family,
        <span class="hljs-attr">size</span>: (glyphAttributes.sizeValue) ? <span class="hljs-string">`<span class="hljs-subst">${glyphAttributes.sizeValue}</span><span class="hljs-subst">${glyphAttributes.sizeMetric}</span>`</span> : glyphAttributes.sizeMetric,
        <span class="hljs-attr">stretch</span>: glyphAttributes.stretch,
        <span class="hljs-attr">style</span>: glyphAttributes.style,
        <span class="hljs-attr">variant</span>: glyphAttributes.variant,
        <span class="hljs-attr">weight</span>: glyphAttributes.weight,
    };

    <span class="hljs-keyword">for</span> (i = <span class="hljs-number">0</span>, iz = glyphStyles.length; i &lt; iz; i++) {

        gStyle = glyphStyles[i];

        <span class="hljs-keyword">if</span> (gStyle) {

            gPos = textPositions[i];

            <span class="hljs-keyword">if</span> (i === <span class="hljs-number">0</span>) {
                gPos[<span class="hljs-number">0</span>] = currentFont;
                gPos[<span class="hljs-number">1</span>] = currentStrokeStyle;
                gPos[<span class="hljs-number">2</span>] = currentFillStyle;
                gPos[<span class="hljs-number">3</span>] = highlightFlag;
                gPos[<span class="hljs-number">4</span>] = underlineFlag;
                gPos[<span class="hljs-number">5</span>] = overlineFlag;
            }

            <span class="hljs-keyword">if</span> (gStyle.defaults) {
                currentFont = glyphAttributes.update(scale, fontAttributes);
                currentStrokeStyle = defaultStrokeStyle;
                currentFillStyle = defaultFillStyle;
                currentSpace = defaultSpace;
                gPos[<span class="hljs-number">0</span>] = currentFont;
                gPos[<span class="hljs-number">1</span>] = currentStrokeStyle;
                gPos[<span class="hljs-number">2</span>] = currentFillStyle;
                gPos[<span class="hljs-number">3</span>] = highlightFlag;
                gPos[<span class="hljs-number">4</span>] = underlineFlag;
                gPos[<span class="hljs-number">5</span>] = overlineFlag;
            }

            item = gStyle.stroke;
            <span class="hljs-keyword">if</span> (item &amp;&amp; item !== currentStrokeStyle) {

                currentStrokeStyle = makeStyle(gStyle.stroke);
                gPos[<span class="hljs-number">1</span>] = currentStrokeStyle;
            };

            item = gStyle.fill;
            <span class="hljs-keyword">if</span> (item &amp;&amp; item !== currentFillStyle) {

                currentFillStyle = makeStyle(gStyle.fill);
                gPos[<span class="hljs-number">2</span>] = currentFillStyle;
            };

            item = gStyle.space;
            <span class="hljs-keyword">if</span> (xt(item) &amp;&amp; item !== currentSpace) currentSpace = item * scale

            item = gStyle.highlight;
            <span class="hljs-keyword">if</span> (xt(item) &amp;&amp; item !== highlightFlag) {

                highlightFlag = item;
                gPos[<span class="hljs-number">3</span>] = highlightFlag;
            };

            item = gStyle.underline;
            <span class="hljs-keyword">if</span> (xt(item) &amp;&amp; item !== underlineFlag) {

                underlineFlag = item;
                gPos[<span class="hljs-number">4</span>] = underlineFlag;
            };

            item = gStyle.overline;
            <span class="hljs-keyword">if</span> (xt(item) &amp;&amp; item !== overlineFlag) {

                overlineFlag = item;
                gPos[<span class="hljs-number">5</span>] = overlineFlag;
            };

            <span class="hljs-keyword">if</span> (i !== <span class="hljs-number">0</span> &amp;&amp; (gStyle.variant || gStyle.weight || gStyle.style || gStyle.stretch || gStyle.size || gStyle.sizeValue || gStyle.sizeMetric || gStyle.family || gStyle.font)) {

                item = glyphAttributes.update(scale, gStyle);
                <span class="hljs-keyword">if</span> (item !== currentFont) {

                    currentFont = item;
                    gPos[<span class="hljs-number">0</span>] = currentFont;

                    <span class="hljs-keyword">if</span> (fontArray.indexOf(currentFont) &lt; <span class="hljs-number">0</span>) fontArray.push(currentFont);
                }
            }
        }</pre></div></div>
            
        </li>
        
        
        <li id="section-66">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-66">&#182;</a>
              </div>
              <p>setup textGlyphWidths array, populating it with current letterSpacing values</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        textGlyphWidths[i] = currentSpace;
    }</pre></div></div>
            
        </li>
        
        
        <li id="section-67">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-67">&#182;</a>
              </div>
              <p>finish populating textGlyphWidths</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">for</span> (i = <span class="hljs-number">0</span>, iz = textGlyphs.length; i &lt; iz; i++) {

        <span class="hljs-keyword">if</span> (xt(textGlyphWidths[i])) currentSpace = textGlyphWidths[i];

        textGlyphWidths[i] = currentSpace;
    }</pre></div></div>
            
        </li>
        
        
        <li id="section-68">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-68">&#182;</a>
              </div>
              <ol start="5">
<li>calculate the text height value</li>
</ol>
<ul>
<li>all lines in a multiline Phrase will use the maximum text height value, even if they don’t include the biggest value</li>
</ul>

            </div>
            
            <div class="content"><div class='highlight'><pre>    fontArray.forEach(<span class="hljs-function"><span class="hljs-params">font</span> =&gt;</span> {

        fontHeightCalculator.style.font = font;
        item = fontHeightCalculator.clientHeight;
        fontLibrary[font] = item;
    });

    maxHeight = <span class="hljs-built_in">Math</span>.max(...Object.values(fontLibrary));</pre></div></div>
            
        </li>
        
        
        <li id="section-69">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-69">&#182;</a>
              </div>
              <ol start="6">
<li>calculate glyph width values</li>
</ol>
<ul>
<li>this is the tricky bit as, ideally, we need to take into account font kerning values</li>
<li>however kerning values go out of the window when font attributes (especially size) change in mid-text</li>
<li>and we need to remember that letterSpacing can also be different in different parts of the text</li>
<li>this is also the best place to populate the textLine arrays</li>
</ul>

            </div>
            
        </li>
        
        
        <li id="section-70">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-70">&#182;</a>
              </div>
              <p>TODO - none of this takes into consideration the needs of RTL scripts eg Arabic, Hebrew, etc - needs testing, review and necessary refactor to fix (if required)</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>
    totalLen = lineLen = starts = ends = <span class="hljs-number">0</span>;

    <span class="hljs-keyword">for</span> (i = <span class="hljs-number">0</span>, iz = textPositions.length; i &lt; iz; i++) {

        glyphArr = textPositions[i];
        glyph = glyphArr[<span class="hljs-number">6</span>];

        <span class="hljs-keyword">if</span> (glyphArr[<span class="hljs-number">0</span>]) engine.font = glyphArr[<span class="hljs-number">0</span>];

        singles.push(engine.measureText(glyph).width);
        
        nextGlyph = textPositions[i + <span class="hljs-number">1</span>];
        nextGlyph = (!treatWordAsGlyph &amp;&amp; nextGlyph) ? nextGlyph[<span class="hljs-number">6</span>] : <span class="hljs-literal">false</span>;

        len = (nextGlyph) ? engine.measureText(<span class="hljs-string">`<span class="hljs-subst">${glyph}</span><span class="hljs-subst">${nextGlyph}</span>`</span>).width : <span class="hljs-literal">false</span>;
        pairs.push(len);
    }

    <span class="hljs-keyword">for</span> (i = <span class="hljs-number">0</span>, iz = pairs.length; i &lt; iz; i++) {

        glyph = pairs[i];

        <span class="hljs-keyword">if</span> (glyph) {

            len = singles[i] + singles[i + <span class="hljs-number">1</span>];
            gPos = textPositions[i + <span class="hljs-number">1</span>];

            <span class="hljs-keyword">if</span> (len &gt; glyph &amp;&amp; !gPos[<span class="hljs-number">0</span>]) singles[i] -= (len - glyph);
        }
    }</pre></div></div>
            
        </li>
        
        
        <li id="section-71">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-71">&#182;</a>
              </div>
              <p>calculate text line arrays
TODO: create a demo-test for treatWordAsGlyph</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">for</span> (i = <span class="hljs-number">0</span>, iz = textPositions.length; i &lt; iz; i++) {

        glyphArr = textPositions[i];
        glyph = glyphArr[<span class="hljs-number">6</span>];

        glyphWidth = singles[i] + textGlyphWidths[i];
        textGlyphWidths[i] = glyphWidth;

        <span class="hljs-keyword">if</span> (treatWordAsGlyph || glyph === <span class="hljs-string">' '</span>) ends = i;

        lineLen += glyphWidth;
        totalLen += glyphWidth;</pre></div></div>
            
        </li>
        
        
        <li id="section-72">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-72">&#182;</a>
              </div>
              <p>need starts to be less than ends</p>
<ul>
<li>this should make sure we pick up individual words that are longer than the Phrase entity’s width</li>
</ul>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">if</span> (lineLen &gt;= width &amp;&amp; starts &lt; ends) {

            fragment = textGlyphs.slice(starts, ends).join(<span class="hljs-string">''</span>);
            textLines.push(fragment);
            len = (treatWordAsGlyph) ? fragment.split(<span class="hljs-string">' '</span>).length - <span class="hljs-number">1</span> : fragment.split(<span class="hljs-string">' '</span>).length;
            textLineWords.push(len);

            len = textGlyphWidths.slice(starts, ends).reduce(<span class="hljs-function">(<span class="hljs-params">a, v</span>) =&gt;</span> a + v, <span class="hljs-number">0</span>);
            textLineWidths.push(len);

            lineLen -= len;
            starts = ends + <span class="hljs-number">1</span>;
        }</pre></div></div>
            
        </li>
        
        
        <li id="section-73">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-73">&#182;</a>
              </div>
              <p>need to pick up the last (or only) line</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">if</span> (i + <span class="hljs-number">1</span> === iz) {</pre></div></div>
            
        </li>
        
        
        <li id="section-74">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-74">&#182;</a>
              </div>
              <p>pick up single line</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            <span class="hljs-keyword">if</span> (lineLen === totalLen) {

                fragment = <span class="hljs-keyword">this</span>.text;

                textLines.push(fragment);
                textLineWords.push((treatWordAsGlyph) ? fragment.split(<span class="hljs-string">' '</span>).length - <span class="hljs-number">1</span> : fragment.split(<span class="hljs-string">' '</span>).length);
                textLineWidths.push(totalLen);
            }</pre></div></div>
            
        </li>
        
        
        <li id="section-75">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-75">&#182;</a>
              </div>
              <p>final line of multiline text</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            <span class="hljs-keyword">else</span> {

                fragment = textGlyphs.slice(starts).join(<span class="hljs-string">''</span>);
                textLines.push(fragment);
                len = (treatWordAsGlyph) ? fragment.split(<span class="hljs-string">' '</span>).length - <span class="hljs-number">1</span> : fragment.split(<span class="hljs-string">' '</span>).length;
                textLineWords.push(len);

                len = textGlyphWidths.slice(starts).reduce(<span class="hljs-function">(<span class="hljs-params">a, v</span>) =&gt;</span> a + v, <span class="hljs-number">0</span>);
                textLineWidths.push(len);
            }
        }</pre></div></div>
            
        </li>
        
        
        <li id="section-76">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-76">&#182;</a>
              </div>
              <p>and complete the population of data for highlight, overline, underline</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">if</span> (xt(glyphArr[<span class="hljs-number">3</span>])) highlightFlag = glyphArr[<span class="hljs-number">3</span>];
        <span class="hljs-keyword">if</span> (xt(glyphArr[<span class="hljs-number">4</span>])) underlineFlag = glyphArr[<span class="hljs-number">4</span>];
        <span class="hljs-keyword">if</span> (xt(glyphArr[<span class="hljs-number">5</span>])) overlineFlag = glyphArr[<span class="hljs-number">5</span>];

        glyphArr[<span class="hljs-number">3</span>] = highlightFlag;
        glyphArr[<span class="hljs-number">4</span>] = underlineFlag;
        glyphArr[<span class="hljs-number">5</span>] = overlineFlag;
    }</pre></div></div>
            
        </li>
        
        
        <li id="section-77">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-77">&#182;</a>
              </div>
              <p>handle path positioning (which we’ll assume will need to be done for every display cycle) separately during stamping</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">if</span> (!path) {</pre></div></div>
            
        </li>
        
        
        <li id="section-78">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-78">&#182;</a>
              </div>
              <ol start="7">
<li>calculate localHeight</li>
</ol>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">if</span> (scale &lt;= <span class="hljs-number">0</span>) scale = <span class="hljs-number">1</span>;
        dims[<span class="hljs-number">1</span>] = ((((textLines.length - <span class="hljs-number">1</span>) * maxHeight) * lineHeight) + maxHeight) / scale;

        <span class="hljs-keyword">this</span>.cleanHandle();
        <span class="hljs-keyword">this</span>.dirtyHandle = <span class="hljs-literal">false</span>;
        handle = <span class="hljs-keyword">this</span>.currentHandle;
        
        handleX = -handle[<span class="hljs-number">0</span>] * scale;
        handleY = -handle[<span class="hljs-number">1</span>] * scale;</pre></div></div>
            
        </li>
        
        
        <li id="section-79">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-79">&#182;</a>
              </div>
              <ol start="8">
<li>we should now be in a position where we can calculate each glyph’s startXY values</li>
</ol>

            </div>
            
        </li>
        
        
        <li id="section-80">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-80">&#182;</a>
              </div>
              <ul>
<li>we have 2 non-path scenarios: full-justified text; and regular text</li>
</ul>

            </div>
            
        </li>
        
        
        <li id="section-81">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-81">&#182;</a>
              </div>
              <p>Scenario 1: justify === ‘full’</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">if</span> (justify === <span class="hljs-string">'full'</span>) {

            cursor = <span class="hljs-number">0</span>;
            height = handleY + (maxHeight / <span class="hljs-number">2</span>);

            <span class="hljs-keyword">for</span> (i = <span class="hljs-number">0</span>, iz = textLineWidths.length; i &lt; iz; i++) {

                len = handleX;

                <span class="hljs-keyword">if</span> (textLineWords[i] &gt; <span class="hljs-number">1</span>) space = (width - textLineWidths[i]) / (textLineWords[i] - <span class="hljs-number">1</span>);
                <span class="hljs-keyword">else</span> space = <span class="hljs-number">0</span>;

                <span class="hljs-keyword">for</span> (j = <span class="hljs-number">0</span>, jz = textLines[i].length; j &lt; jz; j++) {

                    item = textPositions[cursor];

                    <span class="hljs-keyword">if</span> (item[<span class="hljs-number">6</span>] === <span class="hljs-string">' '</span>) textGlyphWidths[cursor] += space;

                    item[<span class="hljs-number">7</span>] = len;
                    item[<span class="hljs-number">8</span>] = height;
                    item[<span class="hljs-number">9</span>] = textGlyphWidths[cursor];

                    len += textGlyphWidths[cursor];

                    cursor++;
                }

                cursor++;
                height += (maxHeight * lineHeight);
            }
        }</pre></div></div>
            
        </li>
        
        
        <li id="section-82">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-82">&#182;</a>
              </div>
              <p>Scenario 2: regular text - justify === ‘left’, or ‘centre’, or ‘right’</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">else</span> {

            cursor = <span class="hljs-number">0</span>;
            height = handleY + (maxHeight / <span class="hljs-number">2</span>);

            <span class="hljs-keyword">for</span> (i = <span class="hljs-number">0</span>, iz = textLineWidths.length; i &lt; iz; i++) {

                <span class="hljs-keyword">if</span> (justify === <span class="hljs-string">'right'</span>) len = (width - textLineWidths[i]) + handleX;
                <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (justify === <span class="hljs-string">'center'</span>) len = ((width - textLineWidths[i]) / <span class="hljs-number">2</span>) + handleX;
                <span class="hljs-keyword">else</span> len = handleX;

                <span class="hljs-keyword">for</span> (j = <span class="hljs-number">0</span>, jz = textLines[i].length; j &lt; jz; j++) {

                    item = textPositions[cursor];

                    item[<span class="hljs-number">7</span>] = len;
                    item[<span class="hljs-number">8</span>] = height;
                    item[<span class="hljs-number">9</span>] = textGlyphWidths[cursor];

                    len += textGlyphWidths[cursor];

                    cursor++;
                }

                cursor++;
                height += (maxHeight * lineHeight);
            }
        }
    }</pre></div></div>
            
        </li>
        
        
        <li id="section-83">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-83">&#182;</a>
              </div>
              <ol start="9">
<li>clean up and exit</li>
</ol>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">this</span>.textGlyphs = textGlyphs;
    <span class="hljs-keyword">this</span>.textGlyphWidths = textGlyphWidths;
    <span class="hljs-keyword">this</span>.textLines = textLines;
    <span class="hljs-keyword">this</span>.textLineWidths = textLineWidths;
    <span class="hljs-keyword">this</span>.textLineWords = textLineWords;
    <span class="hljs-keyword">this</span>.textPositions = textPositions;
    <span class="hljs-keyword">this</span>.textHeight = maxHeight;
    <span class="hljs-keyword">this</span>.textLength = totalLen;
    <span class="hljs-keyword">this</span>.fontLibrary = fontLibrary;

    releaseCell(myCell);
};</pre></div></div>
            
        </li>
        
        
        <li id="section-84">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-84">&#182;</a>
              </div>
              <p>TODO - documentation</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>P.calculateGlyphPathPositions = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{

    <span class="hljs-keyword">let</span> path = <span class="hljs-keyword">this</span>.getTextPath(),
        len = path.length,
        textPos = <span class="hljs-keyword">this</span>.textPositions,
        widths = <span class="hljs-keyword">this</span>.textGlyphWidths,
        direction = (<span class="hljs-keyword">this</span>.textPathDirection === <span class="hljs-string">'ltr'</span>) ? <span class="hljs-literal">true</span> : <span class="hljs-literal">false</span>,
        pathPos = <span class="hljs-keyword">this</span>.textPathPosition,
        distance, posArray, i, iz, width,
        justify = <span class="hljs-keyword">this</span>.justify,
        loop = <span class="hljs-keyword">this</span>.textPathLoop;

    <span class="hljs-keyword">for</span> (i = <span class="hljs-number">0</span>, iz = textPos.length; i &lt; iz; i++) {

        posArray = textPos[i];
        width = widths[i];</pre></div></div>
            
        </li>
        
        
        <li id="section-85">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-85">&#182;</a>
              </div>
              <p>TODO - using non-left justified text buggers up letter kerning along the line</p>
<ul>
<li>but left-justified makes the letters lean a little to the left</li>
</ul>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">if</span> (justify === <span class="hljs-string">'right'</span>) posArray[<span class="hljs-number">7</span>] = -width;
        <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (justify === <span class="hljs-string">'center'</span>) posArray[<span class="hljs-number">7</span>] = -width / <span class="hljs-number">2</span>;

        posArray[<span class="hljs-number">10</span>] = (pathPos &lt;= <span class="hljs-number">1</span> &amp;&amp; pathPos &gt;= <span class="hljs-number">0</span>) ? path.getPathPositionData(pathPos) : <span class="hljs-literal">false</span>;
        posArray[<span class="hljs-number">9</span>] = width;

        <span class="hljs-keyword">if</span> (direction) pathPos += (width / len);
        <span class="hljs-keyword">else</span> pathPos -= (width / len);

        <span class="hljs-keyword">if</span> (loop &amp;&amp; (pathPos &gt; <span class="hljs-number">1</span> || pathPos &lt; <span class="hljs-number">0</span>)) {

            pathPos = (pathPos &gt; <span class="hljs-number">0.5</span>) ? pathPos - <span class="hljs-number">1</span> : pathPos + <span class="hljs-number">1</span>;
        }
    }
};</pre></div></div>
            
        </li>
        
        
        <li id="section-86">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-86">&#182;</a>
              </div>
              <p>TODO - documentation</p>

            </div>
            
        </li>
        
        
        <li id="section-87">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-87">&#182;</a>
              </div>
              <p>Fonts don’t have accessible paths</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>P.cleanPathObject = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{

    <span class="hljs-keyword">this</span>.dirtyPathObject = <span class="hljs-literal">false</span>;

    <span class="hljs-keyword">if</span> (!<span class="hljs-keyword">this</span>.noPathUpdates || !<span class="hljs-keyword">this</span>.pathObject) {
        
        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.dirtyFont &amp;&amp; <span class="hljs-keyword">this</span>.fontAttributes) {

            <span class="hljs-keyword">this</span>.dirtyFont = <span class="hljs-literal">false</span>;
            <span class="hljs-keyword">this</span>.fontAttributes.buildFont(<span class="hljs-keyword">this</span>.scale);
            <span class="hljs-keyword">this</span>.dirtyText = <span class="hljs-literal">true</span>;
        }
        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.dirtyText) <span class="hljs-keyword">this</span>.buildText();

        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.dirtyHandle) <span class="hljs-keyword">this</span>.cleanHandle();

        <span class="hljs-keyword">let</span> p = <span class="hljs-keyword">this</span>.pathObject = <span class="hljs-keyword">new</span> Path2D();
        
        <span class="hljs-keyword">let</span> handle = <span class="hljs-keyword">this</span>.currentHandle,
            dims = <span class="hljs-keyword">this</span>.currentDimensions,
            scale = <span class="hljs-keyword">this</span>.currentScale,
            x = -handle[<span class="hljs-number">0</span>] * scale,
            y = -handle[<span class="hljs-number">1</span>] * scale,
            w = dims[<span class="hljs-number">0</span>] * scale,
            h = dims[<span class="hljs-number">1</span>] * scale;

        p.rect(x, y, w, h);
    }
};</pre></div></div>
            
        </li>
        
        
        <li id="section-88">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-88">&#182;</a>
              </div>
              <p>TODO - documentation</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>P.regularStampSynchronousActions = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{

    <span class="hljs-keyword">let</span> dest = <span class="hljs-keyword">this</span>.currentHost, 
        method = <span class="hljs-keyword">this</span>.method,
        engine, i, iz, pos, data,
        preStamper = <span class="hljs-keyword">this</span>.preStamper,
        stamper = <span class="hljs-keyword">this</span>.stamper;

    <span class="hljs-keyword">if</span> (dest) {

        engine = dest.engine;

        <span class="hljs-keyword">if</span> (!<span class="hljs-keyword">this</span>.noCanvasEngineUpdates) dest.setEngine(<span class="hljs-keyword">this</span>);

        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.method === <span class="hljs-string">'none'</span>) {

            <span class="hljs-keyword">this</span>.performRotation(engine);
        }

        <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.textPath) {

            <span class="hljs-keyword">this</span>.getTextPath();
            <span class="hljs-keyword">this</span>.calculateGlyphPathPositions();

            pos = <span class="hljs-keyword">this</span>.textPositions;

            <span class="hljs-keyword">let</span> item, pathData,
                addTextPathRoll = <span class="hljs-keyword">this</span>.addTextPathRoll,
                aPR = <span class="hljs-keyword">this</span>.addPathRotation,
                cr = <span class="hljs-keyword">this</span>.currentRotation;

            <span class="hljs-keyword">this</span>.addPathRotation = addTextPathRoll;

            <span class="hljs-keyword">for</span> (i = <span class="hljs-number">0</span>, iz = pos.length; i &lt; iz; i++) {

                item = pos[i];

                pathData = item[<span class="hljs-number">10</span>];

                <span class="hljs-keyword">if</span> (pathData) {

                    <span class="hljs-keyword">this</span>.currentPathData = pathData;
                    <span class="hljs-keyword">if</span> (addTextPathRoll) <span class="hljs-keyword">this</span>.currentRotation = pathData.angle;

                    dest.rotateDestination(engine, pathData.x, pathData.y, <span class="hljs-keyword">this</span>);

                    data = preStamper(engine, <span class="hljs-keyword">this</span>, item);
                    stamper[method](engine, <span class="hljs-keyword">this</span>, data);
                }
            }

            <span class="hljs-keyword">this</span>.addPathRotation = aPR;
            <span class="hljs-keyword">this</span>.currentRotation = cr;
        }

        <span class="hljs-keyword">else</span> {

            pos = <span class="hljs-keyword">this</span>.textPositions;

            <span class="hljs-keyword">this</span>.performRotation(engine);

            <span class="hljs-keyword">for</span> (i = <span class="hljs-number">0</span>, iz = pos.length; i &lt; iz; i++) {

                data = preStamper(engine, <span class="hljs-keyword">this</span>, pos[i]);
                stamper[method](engine, <span class="hljs-keyword">this</span>, data);
            }

            <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.showBoundingBox) <span class="hljs-keyword">this</span>.drawBoundingBox(engine);
        }
    }
};</pre></div></div>
            
        </li>
        
        
        <li id="section-89">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-89">&#182;</a>
              </div>
              <p>TODO - documentation</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>P.preStamper = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">engine, entity, args</span>) </span>{

    <span class="hljs-keyword">let</span> [font, strokeStyle, fillStyle, highlight, underline, overline, ...data] = args;

    <span class="hljs-keyword">if</span> (font) engine.font = font;

    <span class="hljs-keyword">if</span> (highlight || underline || overline) {

        <span class="hljs-keyword">let</span> highlightStyle = entity.highlightStyle,
            height = entity.textHeight,
            halfHeight = height / <span class="hljs-number">2</span>,
            underlineStyle = entity.underlineStyle,
            underlinePosition = entity.underlinePosition,
            overlineStyle = entity.overlineStyle,
            overlinePosition = entity.overlinePosition;

        engine.save();

        <span class="hljs-keyword">if</span> (highlight) {

            engine.fillStyle = highlightStyle;
            engine.fillRect(data[<span class="hljs-number">1</span>], data[<span class="hljs-number">2</span>] - halfHeight, data[<span class="hljs-number">3</span>], height);
        }

        <span class="hljs-keyword">if</span> (underline) {

            engine.strokeStyle = underlineStyle;
            engine.strokeRect(data[<span class="hljs-number">1</span>], data[<span class="hljs-number">2</span>] - halfHeight + (height * underlinePosition), data[<span class="hljs-number">3</span>], <span class="hljs-number">1</span>);
        }

        <span class="hljs-keyword">if</span> (overline) {

            engine.strokeStyle = overlineStyle;
            engine.strokeRect(data[<span class="hljs-number">1</span>], data[<span class="hljs-number">2</span>] - halfHeight + (height * overlinePosition), data[<span class="hljs-number">3</span>], <span class="hljs-number">1</span>);
        }

        engine.restore();
    }

    <span class="hljs-keyword">if</span> (strokeStyle) engine.strokeStyle = strokeStyle;
    <span class="hljs-keyword">if</span> (fillStyle) engine.fillStyle = fillStyle;

    <span class="hljs-keyword">return</span> data;
};</pre></div></div>
            
        </li>
        
        
        <li id="section-90">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-90">&#182;</a>
              </div>
              <p>TODO - documentation</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>P.stamper = {

    <span class="hljs-attr">draw</span>: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">engine, entity, data</span>) </span>{ 

        engine.strokeText(...data);
    },
    <span class="hljs-attr">fill</span>: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">engine, entity, data</span>) </span>{ 

        engine.fillText(...data);
    },
    <span class="hljs-attr">drawAndFill</span>: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">engine, entity, data</span>) </span>{ 

        engine.strokeText(...data);
        entity.currentHost.clearShadow();
        engine.fillText(...data);
        entity.currentHost.restoreShadow(entity);
    },
    <span class="hljs-attr">fillAndDraw</span>: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">engine, entity, data</span>) </span>{ 

        engine.strokeText(...data);
        entity.currentHost.clearShadow();
        engine.fillText(...data);
        engine.strokeText(...data);
        entity.currentHost.restoreShadow(entity);
    },
    <span class="hljs-attr">drawThenFill</span>: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">engine, entity, data</span>) </span>{ 

        engine.strokeText(...data);
        engine.fillText(...data);
    },
    <span class="hljs-attr">fillThenDraw</span>: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">engine, entity, data</span>) </span>{ 

        engine.fillText(...data);
        engine.strokeText(...data);
    },
    <span class="hljs-attr">clear</span>: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">engine, entity, data</span>) </span>{ 

        <span class="hljs-keyword">let</span> gco = engine.globalCompositeOperation;
        engine.globalCompositeOperation = <span class="hljs-string">'destination-out'</span>;
        engine.fillText(...data);
        engine.globalCompositeOperation = gco;
    },    
};</pre></div></div>
            
        </li>
        
        
        <li id="section-91">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-91">&#182;</a>
              </div>
              <p>TODO - documentation</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>P.drawBoundingBox = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">engine</span>) </span>{

    <span class="hljs-keyword">let</span> handle = <span class="hljs-keyword">this</span>.currentHandle,
        dims = <span class="hljs-keyword">this</span>.currentDimensions,
        scale = <span class="hljs-keyword">this</span>.currentScale,
        floor = <span class="hljs-built_in">Math</span>.floor,
        ceil = <span class="hljs-built_in">Math</span>.ceil;

    engine.save();
    engine.strokeStyle = <span class="hljs-keyword">this</span>.boundingBoxColor;
    engine.lineWidth = <span class="hljs-number">1</span>;
    engine.globalCompositeOperation = <span class="hljs-string">'source-over'</span>;
    engine.globalAlpha = <span class="hljs-number">1</span>;
    engine.shadowOffsetX = <span class="hljs-number">0</span>;
    engine.shadowOffsetY = <span class="hljs-number">0</span>;
    engine.shadowBlur = <span class="hljs-number">0</span>;
    engine.strokeRect(floor(-handle[<span class="hljs-number">0</span>] * scale), floor(-handle[<span class="hljs-number">1</span>] * scale), ceil(dims[<span class="hljs-number">0</span>] * scale), ceil(dims[<span class="hljs-number">1</span>] * scale));
    engine.restore();
};</pre></div></div>
            
        </li>
        
        
        <li id="section-92">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-92">&#182;</a>
              </div>
              <p>TODO - documentation</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>P.performRotation = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">engine</span>) </span>{

    <span class="hljs-keyword">let</span> dest = <span class="hljs-keyword">this</span>.currentHost;

    <span class="hljs-keyword">if</span> (dest) {

        <span class="hljs-keyword">let</span> stamp = <span class="hljs-keyword">this</span>.currentStampPosition;

        dest.rotateDestination(engine, stamp[<span class="hljs-number">0</span>], stamp[<span class="hljs-number">1</span>], <span class="hljs-keyword">this</span>);
    }
};</pre></div></div>
            
        </li>
        
        
        <li id="section-93">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-93">&#182;</a>
              </div>
              <h2 id="exported-factory-function">Exported factory function</h2>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">const</span> makePhrase = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">items</span>) </span>{
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> Phrase(items);
};

constructors.Phrase = Phrase;

<span class="hljs-keyword">export</span> {
    makePhrase,
};</pre></div></div>
            
        </li>
        
    </ul>
  </div>
</body>
</html>
