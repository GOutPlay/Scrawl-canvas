<!DOCTYPE html>

<html>
<head>
  <title>Position mixin</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <meta name="viewport" content="width=device-width, target-densitydpi=160dpi, initial-scale=1.0; maximum-scale=1.0; user-scalable=0;">
  <link rel="stylesheet" media="all" href="../../docco.css" />
</head>
<body>
  <div id="container">
    <div id="background"></div>
    
      <ul id="jump_to">
        <li>
          <a class="large" href="javascript:void(0);">Jump To &hellip;</a>
          <a class="small" href="javascript:void(0);">+</a>
          <div id="jump_wrapper">
          <div id="jump_page_wrapper">
            <div id="jump_page">
              
                
                <a class="source" href="../../demo/canvas-001.html">
                  ./demo/canvas-001.js
                </a>
              
                
                <a class="source" href="../../demo/canvas-002.html">
                  ./demo/canvas-002.js
                </a>
              
                
                <a class="source" href="../../demo/canvas-003.html">
                  ./demo/canvas-003.js
                </a>
              
                
                <a class="source" href="../../demo/canvas-004.html">
                  ./demo/canvas-004.js
                </a>
              
                
                <a class="source" href="../../demo/canvas-005.html">
                  ./demo/canvas-005.js
                </a>
              
                
                <a class="source" href="../../demo/canvas-006.html">
                  ./demo/canvas-006.js
                </a>
              
                
                <a class="source" href="../../demo/canvas-007.html">
                  ./demo/canvas-007.js
                </a>
              
                
                <a class="source" href="../../demo/canvas-008.html">
                  ./demo/canvas-008.js
                </a>
              
                
                <a class="source" href="../../demo/canvas-009.html">
                  ./demo/canvas-009.js
                </a>
              
                
                <a class="source" href="../../demo/canvas-010.html">
                  ./demo/canvas-010.js
                </a>
              
                
                <a class="source" href="../../demo/canvas-011.html">
                  ./demo/canvas-011.js
                </a>
              
                
                <a class="source" href="../../demo/canvas-012.html">
                  ./demo/canvas-012.js
                </a>
              
                
                <a class="source" href="../../demo/canvas-013.html">
                  ./demo/canvas-013.js
                </a>
              
                
                <a class="source" href="../../demo/canvas-014.html">
                  ./demo/canvas-014.js
                </a>
              
                
                <a class="source" href="../../demo/canvas-015.html">
                  ./demo/canvas-015.js
                </a>
              
                
                <a class="source" href="../../demo/canvas-016.html">
                  ./demo/canvas-016.js
                </a>
              
                
                <a class="source" href="../../demo/canvas-017.html">
                  ./demo/canvas-017.js
                </a>
              
                
                <a class="source" href="../../demo/canvas-018.html">
                  ./demo/canvas-018.js
                </a>
              
                
                <a class="source" href="../../demo/canvas-019.html">
                  ./demo/canvas-019.js
                </a>
              
                
                <a class="source" href="../../demo/canvas-020.html">
                  ./demo/canvas-020.js
                </a>
              
                
                <a class="source" href="../../demo/canvas-021.html">
                  ./demo/canvas-021.js
                </a>
              
                
                <a class="source" href="../../demo/canvas-022.html">
                  ./demo/canvas-022.js
                </a>
              
                
                <a class="source" href="../../demo/canvas-023.html">
                  ./demo/canvas-023.js
                </a>
              
                
                <a class="source" href="../../demo/canvas-024.html">
                  ./demo/canvas-024.js
                </a>
              
                
                <a class="source" href="../../demo/component-001.html">
                  ./demo/component-001.js
                </a>
              
                
                <a class="source" href="../../demo/component-002.html">
                  ./demo/component-002.js
                </a>
              
                
                <a class="source" href="../../demo/component-003.html">
                  ./demo/component-003.js
                </a>
              
                
                <a class="source" href="../../demo/component-004.html">
                  ./demo/component-004.js
                </a>
              
                
                <a class="source" href="../../demo/components/test-001.html">
                  ./demo/components/test-001.js
                </a>
              
                
                <a class="source" href="../../demo/components/test-002.html">
                  ./demo/components/test-002.js
                </a>
              
                
                <a class="source" href="../../demo/core-001.html">
                  ./demo/core-001.js
                </a>
              
                
                <a class="source" href="../../demo/dom-001.html">
                  ./demo/dom-001.js
                </a>
              
                
                <a class="source" href="../../demo/dom-002.html">
                  ./demo/dom-002.js
                </a>
              
                
                <a class="source" href="../../demo/dom-003.html">
                  ./demo/dom-003.js
                </a>
              
                
                <a class="source" href="../../demo/dom-004.html">
                  ./demo/dom-004.js
                </a>
              
                
                <a class="source" href="../../demo/dom-005.html">
                  ./demo/dom-005.js
                </a>
              
                
                <a class="source" href="../../demo/dom-006.html">
                  ./demo/dom-006.js
                </a>
              
                
                <a class="source" href="../../demo/dom-007.html">
                  ./demo/dom-007.js
                </a>
              
                
                <a class="source" href="../../demo/dom-008.html">
                  ./demo/dom-008.js
                </a>
              
                
                <a class="source" href="../../demo/dom-009.html">
                  ./demo/dom-009.js
                </a>
              
                
                <a class="source" href="../../demo/dom-010.html">
                  ./demo/dom-010.js
                </a>
              
                
                <a class="source" href="../../demo/dom-011.html">
                  ./demo/dom-011.js
                </a>
              
                
                <a class="source" href="../../demo/dom-012.html">
                  ./demo/dom-012.js
                </a>
              
                
                <a class="source" href="../../demo/dom-013.html">
                  ./demo/dom-013.js
                </a>
              
                
                <a class="source" href="../../demo/dom-014a.html">
                  ./demo/dom-014a.js
                </a>
              
                
                <a class="source" href="../../demo/dom-014b.html">
                  ./demo/dom-014b.js
                </a>
              
                
                <a class="source" href="../../demo/dom-014c.html">
                  ./demo/dom-014c.js
                </a>
              
                
                <a class="source" href="../../demo/dom-015.html">
                  ./demo/dom-015.js
                </a>
              
                
                <a class="source" href="../core/animationloop.html">
                  ./source/core/animationloop.js
                </a>
              
                
                <a class="source" href="../core/document.html">
                  ./source/core/document.js
                </a>
              
                
                <a class="source" href="../core/init.html">
                  ./source/core/init.js
                </a>
              
                
                <a class="source" href="../core/library.html">
                  ./source/core/library.js
                </a>
              
                
                <a class="source" href="../core/userInteraction.html">
                  ./source/core/userInteraction.js
                </a>
              
                
                <a class="source" href="../core/utilities.html">
                  ./source/core/utilities.js
                </a>
              
                
                <a class="source" href="../factory/action.html">
                  ./source/factory/action.js
                </a>
              
                
                <a class="source" href="../factory/anchor.html">
                  ./source/factory/anchor.js
                </a>
              
                
                <a class="source" href="../factory/animation.html">
                  ./source/factory/animation.js
                </a>
              
                
                <a class="source" href="../factory/block.html">
                  ./source/factory/block.js
                </a>
              
                
                <a class="source" href="../factory/canvas.html">
                  ./source/factory/canvas.js
                </a>
              
                
                <a class="source" href="../factory/cell.html">
                  ./source/factory/cell.js
                </a>
              
                
                <a class="source" href="../factory/color.html">
                  ./source/factory/color.js
                </a>
              
                
                <a class="source" href="../factory/coordinate.html">
                  ./source/factory/coordinate.js
                </a>
              
                
                <a class="source" href="../factory/element.html">
                  ./source/factory/element.js
                </a>
              
                
                <a class="source" href="../factory/filter.html">
                  ./source/factory/filter.js
                </a>
              
                
                <a class="source" href="../factory/fontAttributes.html">
                  ./source/factory/fontAttributes.js
                </a>
              
                
                <a class="source" href="../factory/gradient.html">
                  ./source/factory/gradient.js
                </a>
              
                
                <a class="source" href="../factory/grid.html">
                  ./source/factory/grid.js
                </a>
              
                
                <a class="source" href="../factory/group.html">
                  ./source/factory/group.js
                </a>
              
                
                <a class="source" href="../factory/imageAsset.html">
                  ./source/factory/imageAsset.js
                </a>
              
                
                <a class="source" href="../factory/loom.html">
                  ./source/factory/loom.js
                </a>
              
                
                <a class="source" href="../factory/palette.html">
                  ./source/factory/palette.js
                </a>
              
                
                <a class="source" href="../factory/pattern.html">
                  ./source/factory/pattern.js
                </a>
              
                
                <a class="source" href="../factory/phrase.html">
                  ./source/factory/phrase.js
                </a>
              
                
                <a class="source" href="../factory/picture.html">
                  ./source/factory/picture.js
                </a>
              
                
                <a class="source" href="../factory/quaternion.html">
                  ./source/factory/quaternion.js
                </a>
              
                
                <a class="source" href="../factory/radialGradient.html">
                  ./source/factory/radialGradient.js
                </a>
              
                
                <a class="source" href="../factory/shape.html">
                  ./source/factory/shape.js
                </a>
              
                
                <a class="source" href="../factory/spriteAsset.html">
                  ./source/factory/spriteAsset.js
                </a>
              
                
                <a class="source" href="../factory/stack.html">
                  ./source/factory/stack.js
                </a>
              
                
                <a class="source" href="../factory/state.html">
                  ./source/factory/state.js
                </a>
              
                
                <a class="source" href="../factory/ticker.html">
                  ./source/factory/ticker.js
                </a>
              
                
                <a class="source" href="../factory/tween.html">
                  ./source/factory/tween.js
                </a>
              
                
                <a class="source" href="../factory/unstackedElement.html">
                  ./source/factory/unstackedElement.js
                </a>
              
                
                <a class="source" href="../factory/userObject.html">
                  ./source/factory/userObject.js
                </a>
              
                
                <a class="source" href="../factory/vector.html">
                  ./source/factory/vector.js
                </a>
              
                
                <a class="source" href="../factory/videoAsset.html">
                  ./source/factory/videoAsset.js
                </a>
              
                
                <a class="source" href="../factory/wheel.html">
                  ./source/factory/wheel.js
                </a>
              
                
                <a class="source" href="anchor.html">
                  ./source/mixin/anchor.js
                </a>
              
                
                <a class="source" href="asset.html">
                  ./source/mixin/asset.js
                </a>
              
                
                <a class="source" href="assetConsumer.html">
                  ./source/mixin/assetConsumer.js
                </a>
              
                
                <a class="source" href="base.html">
                  ./source/mixin/base.js
                </a>
              
                
                <a class="source" href="cascade.html">
                  ./source/mixin/cascade.js
                </a>
              
                
                <a class="source" href="dom.html">
                  ./source/mixin/dom.js
                </a>
              
                
                <a class="source" href="entity.html">
                  ./source/mixin/entity.js
                </a>
              
                
                <a class="source" href="filter.html">
                  ./source/mixin/filter.js
                </a>
              
                
                <a class="source" href="position.html">
                  ./source/mixin/position.js
                </a>
              
                
                <a class="source" href="shapePathCalculation.html">
                  ./source/mixin/shapePathCalculation.js
                </a>
              
                
                <a class="source" href="styles.html">
                  ./source/mixin/styles.js
                </a>
              
                
                <a class="source" href="tween.html">
                  ./source/mixin/tween.js
                </a>
              
                
                <a class="source" href="../scrawl.html">
                  ./source/scrawl.js
                </a>
              
                
                <a class="source" href="../worker/filter.html">
                  ./source/worker/filter.js
                </a>
              
            </div>
          </div>
        </li>
      </ul>
    
    <ul class="sections">
        
        
        
        <li id="section-1">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-1">&#182;</a>
              </div>
              
            </div>
            
        </li>
        
        
        <li id="section-2">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-2">&#182;</a>
              </div>
              <h1 id="position-mixin">Position mixin</h1>

            </div>
            
        </li>
        
        
        <li id="section-3">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-3">&#182;</a>
              </div>
              <p>TODO - document the purpose of the mixin</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">import</span> { artefact, group } <span class="hljs-keyword">from</span> <span class="hljs-string">'../core/library.js'</span>;
<span class="hljs-keyword">import</span> { defaultNonReturnFunction, mergeOver, mergeInto, mergeDiscard, 
    isa_obj, isa_number, xt, xta, xto, xtGet, 
    addStrings, pushUnique, removeItem } <span class="hljs-keyword">from</span> <span class="hljs-string">'../core/utilities.js'</span>;
<span class="hljs-keyword">import</span> { currentCorePosition } <span class="hljs-keyword">from</span> <span class="hljs-string">'../core/userInteraction.js'</span>;

<span class="hljs-keyword">import</span> { makeCoordinate, checkCoordinate } <span class="hljs-keyword">from</span> <span class="hljs-string">'../factory/coordinate.js'</span>;
<span class="hljs-keyword">import</span> { requestCell, releaseCell } <span class="hljs-keyword">from</span> <span class="hljs-string">'../factory/cell.js'</span>;

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">P = {}</span>) </span>{</pre></div></div>
            
        </li>
        
        
        <li id="section-4">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-4">&#182;</a>
              </div>
              <h2 id="define-attributes">Define attributes</h2>

            </div>
            
        </li>
        
        
        <li id="section-5">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-5">&#182;</a>
              </div>
              <p>All factories using the position mixin will add these to their prototype objects</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">let</span> defaultAttributes = {</pre></div></div>
            
        </li>
        
        
        <li id="section-6">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-6">&#182;</a>
              </div>
              <p>Every Scrawl-canvas artefact should belong to at least one group, and can belong to more than one group. Groups can be used for a variety of purposes, and play a major role in the <strong>display cycle</strong> and in <strong>collision detection</strong>.</p>

            </div>
            
        </li>
        
        
        <li id="section-7">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-7">&#182;</a>
              </div>
              <p>Most group-related functionality takes place elsewhere. An artefact’s <strong>group</strong> attribute is used mainly as a ‘convenience handle’, to make moving an artefact from one group to another a bit easier.</p>

            </div>
            
        </li>
        
        
        <li id="section-8">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-8">&#182;</a>
              </div>
              <p>As part of an artefact’s initialization, the code will assign the artefact to a group. We can indicate which group to assign the new artefact to by setting the argument attribute to the group’s name attribute String, or to the group itself - the set code will automatically update this attribute to a reference to the Group object.</p>

            </div>
            
        </li>
        
        
        <li id="section-9">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-9">&#182;</a>
              </div>
              <pre><code><span class="hljs-keyword">let</span> myGroup = scrawl.buildGroup({
    <span class="hljs-attr">name</span>: <span class="hljs-string">'my-first-group'</span>,
});</code></pre>
            </div>
            
        </li>
        
        
        <li id="section-10">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-10">&#182;</a>
              </div>
              <pre><code><span class="hljs-keyword">let</span> myBlock = scrawl.makeBlock({
    <span class="hljs-attr">group</span>: myGroup,
});</code></pre>
            </div>
            
        </li>
        
        
        <li id="section-11">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-11">&#182;</a>
              </div>
              <p>Similarly the <strong>set</strong> function’s object argument can accept a name String, or the new group’s object itself</p>

            </div>
            
        </li>
        
        
        <li id="section-12">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-12">&#182;</a>
              </div>
              <pre><code>myBlock.set({
    <span class="hljs-attr">group</span>: <span class="hljs-string">'my-first-group'</span>,
});</code></pre>
            </div>
            
        </li>
        
        
        <li id="section-13">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-13">&#182;</a>
              </div>
              <p>If no group value is supplied when building a new <strong>entity</strong>, then the ‘current group’ will be assigned as the entity’s group. This is a Scrawl-canvas ‘global’ value which will update whenever the user sets a canvas artefact as the current canvas:</p>

            </div>
            
        </li>
        
        
        <li id="section-14">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-14">&#182;</a>
              </div>
              <pre><code>scrawl.setCurrentCanvas(<span class="hljs-string">'my-other-canvas'</span>);</code></pre>
            </div>
            
        </li>
        
        
        <li id="section-15">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-15">&#182;</a>
              </div>
              <p>For some Canvas and Stack artefacts, the value of their group attribute will be set to “root” - this indicates that the stack or canvas is not contained within another stack.</p>

            </div>
            
        </li>
        
        
        <li id="section-16">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-16">&#182;</a>
              </div>
              <p>TODO: we need to decide whether we want a user-available scrawl.setCurrentStack function and, if yes, how that will impact on the core/document.js <strong>currentGroup</strong> variable exported by that module - given that we will then have both currentStack and currentCanvas variables, but only one currentGroup variable shared between them.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        group: <span class="hljs-literal">null</span>,</pre></div></div>
            
        </li>
        
        
        <li id="section-17">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-17">&#182;</a>
              </div>
              <p>The <strong>visibility</strong> attribute is a boolean flag (default: true); when the flag is set, the display cycle functionality will run on the artefact.</p>

            </div>
            
        </li>
        
        
        <li id="section-18">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-18">&#182;</a>
              </div>
              <p>If the attribute’s value is false, then the display cycle functionality will ignore the artefact. This has the following effects:</p>

            </div>
            
        </li>
        
        
        <li id="section-19">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-19">&#182;</a>
              </div>
              <ul>
<li>for DOM-based artefacts, the dom element will have its CSS tweaked to hide the element (“display: block” switches to “display: none”)</li>
</ul>

            </div>
            
        </li>
        
        
        <li id="section-20">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-20">&#182;</a>
              </div>
              <ul>
<li>for canvas-based entitys, the entity will be ignored during the display cycle’s ‘compile’ step’s action cascade</li>
</ul>

            </div>
            
            <div class="content"><div class='highlight'><pre>        visibility: <span class="hljs-literal">true</span>,</pre></div></div>
            
        </li>
        
        
        <li id="section-21">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-21">&#182;</a>
              </div>
              <p>The <strong>order</strong> attribute - an integer Number (default: 0) - determines the order in which an artefact will be processed as part of a group. </p>

            </div>
            
        </li>
        
        
        <li id="section-22">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-22">&#182;</a>
              </div>
              <p>For instance, entity artefacts with higher order values will be processed after those with lower values, with the effect that the entity will be displayed on top of those other entitys (and stamping over them if they overlap)</p>

            </div>
            
        </li>
        
        
        <li id="section-23">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-23">&#182;</a>
              </div>
              <p>Note that Group objects also have an order attribute: all artefacts in a group with a lower order value will be processed before those with a higher order value.</p>

            </div>
            
        </li>
        
        
        <li id="section-24">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-24">&#182;</a>
              </div>
              <p>Cell assets also have an order attribute, which has a similar effect: groups in cells with a lower order value are processed earlier than those in cells with higher order values.</p>

            </div>
            
        </li>
        
        
        <li id="section-25">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-25">&#182;</a>
              </div>
              <p>Finally, animation objects have order values; the same effect applies.</p>

            </div>
            
        </li>
        
        
        <li id="section-26">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-26">&#182;</a>
              </div>
              <p><strong>If the display of an artefact does not appear to be following the order value it has been given</strong>, the problem may lie in either the order values assigned to that artefact’s group, or host (cell, canvas, stack), or even the animation object that contributes to the display cycle.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        order: <span class="hljs-number">0</span>,</pre></div></div>
            
        </li>
        
        
        <li id="section-27">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-27">&#182;</a>
              </div>
              <p>The start coordinate represents an artefact’s <strong>rotation-reflexion point</strong>, and is held in an [x, y] coordinate array. The default values are [0, 0].</p>

            </div>
            
        </li>
        
        
        <li id="section-28">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-28">&#182;</a>
              </div>
              <p>During the display cycle the start coordinate will be calculated with the results placed in a currentStart coordinate array; this calculation will only happen when an artefact’s <strong>dirtyStart</strong> flag has been set.</p>

            </div>
            
        </li>
        
        
        <li id="section-29">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-29">&#182;</a>
              </div>
              <p>Start coordinates can be <strong>absolute</strong> (represented by a Number), or <strong>relative</strong> (represented by a String):</p>

            </div>
            
        </li>
        
        
        <li id="section-30">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-30">&#182;</a>
              </div>
              <ul>
<li>Absolute values are measured in pixels from the artefact’s host’s top left corner, with positive values moving to the right (x) or downwards (y) from that point. Values can be negative, and can be float values.</li>
</ul>

            </div>
            
        </li>
        
        
        <li id="section-31">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-31">&#182;</a>
              </div>
              <ul>
<li>Relative values represent a percentage (eg: ‘42%’) of the artefact’s current dimensions - width for the x value, height for the y value. Again, values can be negative (‘-12%’) and can represent float values (‘33.333%’). The following string aliases can also be used: ‘top’ or ‘left’ (both ‘0%’); ‘bottom’ or ‘right’ (both ‘100%’); and ‘center’ (‘50%’);</li>
</ul>

            </div>
            
        </li>
        
        
        <li id="section-32">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-32">&#182;</a>
              </div>
              <p>Start coordinates can be set as part of an artefact’s factory function, and updated using both that artefact’s <strong>set</strong> and <strong>setDelta</strong> functions. The values can be presented as either an [x, y] Array, or an {x:value, y:value} Object, or using the pseudo-attributes <strong>startX</strong> and <strong>startY</strong></p>

            </div>
            
        </li>
        
        
        <li id="section-33">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-33">&#182;</a>
              </div>
              <p>NEVER set the start coordinate array directly, as those changes will not be picked up by the code! Directly setting startX or startY will also fail as those pseudo-attributes are not retained by the artefact.</p>

            </div>
            
        </li>
        
        
        <li id="section-34">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-34">&#182;</a>
              </div>
              <pre><code><span class="hljs-keyword">let</span> myBlock = scrawl.makeBlock({
    <span class="hljs-attr">startX</span>: <span class="hljs-number">20</span>,
    <span class="hljs-attr">startY</span>: <span class="hljs-string">'center'</span>,
});</code></pre>
            </div>
            
        </li>
        
        
        <li id="section-35">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-35">&#182;</a>
              </div>
              <pre><code>myBlock.set({
    <span class="hljs-attr">start</span>: [<span class="hljs-number">-100</span>, <span class="hljs-string">'-12%'</span>],
});</code></pre>
            </div>
            
        </li>
        
        
        <li id="section-36">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-36">&#182;</a>
              </div>
              <pre><code>myBlock.set({
    <span class="hljs-attr">start</span>: {
        <span class="hljs-attr">x</span>: <span class="hljs-string">'left'</span>,
        <span class="hljs-attr">y</span>: <span class="hljs-number">388.5</span>,
    },
});</code></pre>
            </div>
            
        </li>
        
        
        <li id="section-37">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-37">&#182;</a>
              </div>
              <pre><code><span class="hljs-comment">// Don't use string labels ('top', 'left', etc) when delta setting</span>
myBlock.setDelta({
    <span class="hljs-attr">startX</span>: <span class="hljs-string">'-0.05%'</span>
});</code></pre>
            </div>
            
        </li>
        
        
        <li id="section-38">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-38">&#182;</a>
              </div>
              <pre><code>myBlock.setDelta({
    <span class="hljs-attr">start</span>: [<span class="hljs-number">1</span>, <span class="hljs-string">'0.5%'</span>],
});</code></pre>
            </div>
            
        </li>
        
        
        <li id="section-39">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-39">&#182;</a>
              </div>
              <p>The start attribute can also be included in an artefact’s <strong>delta</strong> object. These values will be added to the start coordinate (and recalculated into the currentStart coordinate) on every iteration of the display cycle:</p>

            </div>
            
        </li>
        
        
        <li id="section-40">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-40">&#182;</a>
              </div>
              <pre><code><span class="hljs-keyword">let</span> myBlock = scrawl.makeBlock({
    <span class="hljs-attr">start</span>: [<span class="hljs-string">'left'</span>, <span class="hljs-number">500</span>],
    <span class="hljs-attr">delta</span>: {
        <span class="hljs-attr">startX</span>: <span class="hljs-number">0.5</span>,
        <span class="hljs-attr">startY</span>: <span class="hljs-string">'-0.3'</span>,
    },
});</code></pre>
            </div>
            
            <div class="content"><div class='highlight'><pre>        start: <span class="hljs-literal">null</span>,</pre></div></div>
            
        </li>
        
        
        <li id="section-41">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-41">&#182;</a>
              </div>
              <p>The handle coordinate represents an offset from the artefact’s <strong>rotation-reflexion</strong> point, and is held in an [x, y] coordinate array. The default values are [0, 0].</p>

            </div>
            
        </li>
        
        
        <li id="section-42">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-42">&#182;</a>
              </div>
              <p>During the display cycle the handle coordinate will be calculated with the results placed in a currentHandle coordinate array; this calculation will only happen when an artefact’s <strong>dirtyHandle</strong> flag has been set.</p>

            </div>
            
        </li>
        
        
        <li id="section-43">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-43">&#182;</a>
              </div>
              <p>Unlike the start attribute, <strong>relative</strong> handle values (‘20%’, ‘bottom’) use the attribute’s own dimensions to calculate their values. Setting the handle attribute to [‘center’, ‘center’] will have the apparent effect of moving the artefact’s display so that it’s rotation-reflection point appears to be centered.</p>

            </div>
            
        </li>
        
        
        <li id="section-44">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-44">&#182;</a>
              </div>
              <p>Handle offsets are applied to the artefact after rotation; animating a handle value will move the artefact along its local x/y axes, not the host’s axes!</p>

            </div>
            
        </li>
        
        
        <li id="section-45">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-45">&#182;</a>
              </div>
              <p>Everything that applies to the start attribute also applies to the handle attribute, except:</p>
<ul>
<li>We can set/update the attribute using the <strong>handleX</strong> and <strong>handleY</strong> pseudo-attributes.</li>
<li>Handle values DO take an artefact’s <strong>scale</strong> attribute into account when calculating current values.</li>
</ul>

            </div>
            
            <div class="content"><div class='highlight'><pre>        handle: <span class="hljs-literal">null</span>,</pre></div></div>
            
        </li>
        
        
        <li id="section-46">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-46">&#182;</a>
              </div>
              <p>The offset coordinate represents an offset from the artefact’s <strong>rotation-reflexion</strong> point, and is held in an [x, y] coordinate array. The default values are [0, 0]. Offsets, unlike handles, shift the artefact along the horizontal (x) and vertical (y), ignoring the artefact’s rotation.</p>

            </div>
            
        </li>
        
        
        <li id="section-47">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-47">&#182;</a>
              </div>
              <p>During the display cycle the offset coordinate will be calculated with the results placed in a currentOffset coordinate array; this calculation will only happen when an artefact’s <strong>dirtyOffset</strong> flag has been set.</p>

            </div>
            
        </li>
        
        
        <li id="section-48">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-48">&#182;</a>
              </div>
              <p>Everything that applies to the start attribute also applies to the offset attribute, except:</p>
<ul>
<li>We can set/update the attribute using the <strong>offsetX</strong> and <strong>offsetY</strong> pseudo-attributes.</li>
<li>Offset values DO NOT take an artefact’s <strong>scale</strong> attribute into account when calculating current values.</li>
<li>Using label strings (‘top’, ‘center’, etc) may have unexpected consequences - stick to Number or String% values instead.</li>
</ul>

            </div>
            
            <div class="content"><div class='highlight'><pre>        offset: <span class="hljs-literal">null</span>,</pre></div></div>
            
        </li>
        
        
        <li id="section-49">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-49">&#182;</a>
              </div>
              <p>TODO - documentation</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        dimensions: <span class="hljs-literal">null</span>,</pre></div></div>
            
        </li>
        
        
        <li id="section-50">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-50">&#182;</a>
              </div>
              <p>TODO - documentation</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        delta: <span class="hljs-literal">null</span>,</pre></div></div>
            
        </li>
        
        
        <li id="section-51">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-51">&#182;</a>
              </div>
              <p>TODO - documentation</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        pivot: <span class="hljs-string">''</span>,</pre></div></div>
            
        </li>
        
        
        <li id="section-52">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-52">&#182;</a>
              </div>
              <p>DOM elements will use this to return either start or one of their corners</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        pivotCorner: <span class="hljs-string">''</span>,         
        <span class="hljs-attr">pivoted</span>: <span class="hljs-literal">null</span>,

        <span class="hljs-attr">addPivotHandle</span>: <span class="hljs-literal">false</span>,
        <span class="hljs-attr">addPivotOffset</span>: <span class="hljs-literal">true</span>,
        <span class="hljs-attr">addPivotRotation</span>: <span class="hljs-literal">false</span>,</pre></div></div>
            
        </li>
        
        
        <li id="section-53">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-53">&#182;</a>
              </div>
              <p>TODO - documentation</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        path: <span class="hljs-string">''</span>,

        <span class="hljs-attr">pathPosition</span>: <span class="hljs-number">0</span>,

        <span class="hljs-attr">addPathHandle</span>: <span class="hljs-literal">false</span>,
        <span class="hljs-attr">addPathOffset</span>: <span class="hljs-literal">true</span>,
        <span class="hljs-attr">addPathRotation</span>: <span class="hljs-literal">false</span>,</pre></div></div>
            
        </li>
        
        
        <li id="section-54">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-54">&#182;</a>
              </div>
              <p>TODO: do these need to be in the defs object?</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        controlSubscriber: <span class="hljs-literal">null</span>,
        <span class="hljs-attr">startControlSubscriber</span>: <span class="hljs-literal">null</span>,
        <span class="hljs-attr">endControlSubscriber</span>: <span class="hljs-literal">null</span>,
        <span class="hljs-attr">endSubscriber</span>: <span class="hljs-literal">null</span>,</pre></div></div>
            
        </li>
        
        
        <li id="section-55">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-55">&#182;</a>
              </div>
              <p>TODO - documentation</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        mimic: <span class="hljs-string">''</span>,
        <span class="hljs-attr">mimicked</span>: <span class="hljs-literal">null</span>,

        <span class="hljs-attr">useMimicDimensions</span>: <span class="hljs-literal">false</span>,
        <span class="hljs-attr">useMimicScale</span>: <span class="hljs-literal">false</span>,
        <span class="hljs-attr">useMimicStart</span>: <span class="hljs-literal">false</span>,
        <span class="hljs-attr">useMimicHandle</span>: <span class="hljs-literal">false</span>,
        <span class="hljs-attr">useMimicOffset</span>: <span class="hljs-literal">false</span>,
        <span class="hljs-attr">useMimicRotation</span>: <span class="hljs-literal">false</span>,
        <span class="hljs-attr">useMimicFlip</span>: <span class="hljs-literal">false</span>,

        <span class="hljs-attr">addOwnDimensionsToMimic</span>: <span class="hljs-literal">false</span>,
        <span class="hljs-attr">addOwnScaleToMimic</span>: <span class="hljs-literal">false</span>,
        <span class="hljs-attr">addOwnStartToMimic</span>: <span class="hljs-literal">false</span>,
        <span class="hljs-attr">addOwnHandleToMimic</span>: <span class="hljs-literal">false</span>,
        <span class="hljs-attr">addOwnOffsetToMimic</span>: <span class="hljs-literal">false</span>,
        <span class="hljs-attr">addOwnRotationToMimic</span>: <span class="hljs-literal">false</span>,</pre></div></div>
            
        </li>
        
        
        <li id="section-56">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-56">&#182;</a>
              </div>
              <p>The <strong>lockTo</strong> attribute is an [x-lock, y-lock] Array which determines where the artefact will look for its x and y start coordinates.</p>

            </div>
            
        </li>
        
        
        <li id="section-57">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-57">&#182;</a>
              </div>
              <p>Scrawl-canvas allows an artefact to use different sources - ‘start’ (the default), ‘pivot’, ‘path’, ‘mimic’, or ‘mouse’</p>

            </div>
            
        </li>
        
        
        <li id="section-58">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-58">&#182;</a>
              </div>
              <p>Note: <strong>setting an artefact’s pivot, path or mimic attribute to another artefact</strong> is not enough to make the artefact start using that pivot as its source for positioning data. <strong>The lockTo attribute must also be set!</strong> </p>

            </div>
            
        </li>
        
        
        <li id="section-59">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-59">&#182;</a>
              </div>
              <p>This approach allows an artefact to keep references to up to three different artifacts (in the pivot, path and mimic attributes), dynamically swapping between them as and when required. It also allows the x coordinate to be calculated separately from the y coordinate, using a different source.</p>

            </div>
            
        </li>
        
        
        <li id="section-60">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-60">&#182;</a>
              </div>
              <p>The <strong>mouse</strong> value will make the artefact use the current host’s ‘here’ coordinates. Stack, element and canvas artefacts will include mouse coordinates localized to their top-left corner as part of there ‘here’ attribute, thus allowing any artefact locked to the mouse to update its start position every time the mouse (or touch) cursor moves.</p>

            </div>
            
        </li>
        
        
        <li id="section-61">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-61">&#182;</a>
              </div>
              <p>The lock values can be set as part of an artefact’s factory function, and updated using that artefact’s <strong>set</strong> function. The values can be presented as either an [x, y] Array, or using the pseudo-attributes <strong>lockXTo</strong> and <strong>lockYTo</strong>.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        lockTo: <span class="hljs-literal">null</span>,</pre></div></div>
            
        </li>
        
        
        <li id="section-62">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-62">&#182;</a>
              </div>
              <p>All artefacts (except compound entities such as Loom) can be scaled by setting their <strong>scale</strong> attribute to an appropriate integer or float Number value.</p>

            </div>
            
        </li>
        
        
        <li id="section-63">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-63">&#182;</a>
              </div>
              <ul>
<li>a value of <strong>0</strong> effectively makes the artefact disappear from the display (though setting the artefact’s <strong>visibility</strong> flag to false is a more efficient approach)</li>
<li>scale value <strong>less than 1</strong> will shrink the artefact around its rotation-reflection point</li>
<li>setting the value to <em>1</em> (the default) removes all scaling effects on the artefact</li>
<li>values <strong>greater than 1</strong> will expand the artefact around its rotation-reflection point</li>
</ul>

            </div>
            
            <div class="content"><div class='highlight'><pre>        scale: <span class="hljs-number">1</span>,</pre></div></div>
            
        </li>
        
        
        <li id="section-64">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-64">&#182;</a>
              </div>
              <p>TODO - documentation</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        roll: <span class="hljs-number">0</span>,</pre></div></div>
            
        </li>
        
        
        <li id="section-65">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-65">&#182;</a>
              </div>
              <p>TODO - documentation</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        collides: <span class="hljs-literal">false</span>,
        <span class="hljs-attr">sensorSpacing</span>: <span class="hljs-number">50</span>,</pre></div></div>
            
        </li>
        
        
        <li id="section-66">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-66">&#182;</a>
              </div>
              <h4 id="animation-speed">Animation speed</h4>

            </div>
            
        </li>
        
        
        <li id="section-67">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-67">&#182;</a>
              </div>
              <p>Scrawl-canvas assumes that an artefact will be “ready for anything”. However if we know beforehand that an artefact will not be requiring certain functionalities, we can switch them off; this will help make the artefact render more quickly. These <strong>noXXX</strong> flags include:</p>

            </div>
            
        </li>
        
        
        <li id="section-68">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-68">&#182;</a>
              </div>
              <ul>
<li><strong>noUserInteraction</strong> - switch off basic collision functionality (used by ‘drag-and-drop’) and ongoing update calculations</li>
</ul>

            </div>
            
        </li>
        
        
        <li id="section-69">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-69">&#182;</a>
              </div>
              <ul>
<li><strong>noDeltaUpdates</strong> - switch off the automatic application of delta attribute values as part of each iteration of the Display cycle</li>
</ul>

            </div>
            
        </li>
        
        
        <li id="section-70">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-70">&#182;</a>
              </div>
              <ul>
<li><strong>noPositionDependencies</strong> - short-circuit the position calculations associated with pivot, mimic, path and mouse positioning</li>
</ul>

            </div>
            
        </li>
        
        
        <li id="section-71">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-71">&#182;</a>
              </div>
              <ul>
<li><strong>noCanvasEngineUpdates</strong> - specifically for canvas entity artefacts, skip updating the CanvasRenderingContext2D with the entity’s styling attributes - meaning that the entity will use the previously rendered entity’s styling</li>
</ul>

            </div>
            
        </li>
        
        
        <li id="section-72">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-72">&#182;</a>
              </div>
              <ul>
<li><strong>noFilters</strong> - skip the checks for, and application of, filters to the entity artefact - even if filters have been added to the entity</li>
</ul>

            </div>
            
        </li>
        
        
        <li id="section-73">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-73">&#182;</a>
              </div>
              <ul>
<li><strong>noPathUpdates</strong> - only calculate the artefact’s path once - this disables updates to the artefact’s handle and scale attributes </li>
</ul>

            </div>
            
            <div class="content"><div class='highlight'><pre>        noUserInteraction: <span class="hljs-literal">false</span>,
        <span class="hljs-attr">noDeltaUpdates</span>: <span class="hljs-literal">false</span>,
        <span class="hljs-attr">noPositionDependencies</span>: <span class="hljs-literal">false</span>,
        <span class="hljs-attr">noCanvasEngineUpdates</span>: <span class="hljs-literal">false</span>,
        <span class="hljs-attr">noFilters</span>: <span class="hljs-literal">false</span>,
        <span class="hljs-attr">noPathUpdates</span>: <span class="hljs-literal">false</span>,
    };
    P.defs = mergeOver(P.defs, defaultAttributes);</pre></div></div>
            
        </li>
        
        
        <li id="section-74">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-74">&#182;</a>
              </div>
              <h2 id="packet-management">Packet management</h2>

            </div>
            
            <div class="content"><div class='highlight'><pre>    P.packetExclusions = pushUnique(P.packetExclusions, [<span class="hljs-string">'pathObject'</span>, <span class="hljs-string">'mimicked'</span>, <span class="hljs-string">'pivoted'</span>]);
    P.packetExclusionsByRegex = pushUnique(P.packetExclusionsByRegex, [<span class="hljs-string">'^(local|dirty|current)'</span>, <span class="hljs-string">'Subscriber$'</span>]);
    P.packetCoordinates = pushUnique(P.packetCoordinates, [<span class="hljs-string">'start'</span>, <span class="hljs-string">'handle'</span>, <span class="hljs-string">'offset'</span>]);
    P.packetObjects = pushUnique(P.packetObjects, [<span class="hljs-string">'group'</span>, <span class="hljs-string">'pivot'</span>, <span class="hljs-string">'path'</span>, <span class="hljs-string">'mimic'</span>]);
    P.packetFunctions = pushUnique(P.packetFunctions, []);

    P.processPacketOut = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">key, value, includes</span>) </span>{

        <span class="hljs-keyword">let</span> result = <span class="hljs-literal">true</span>;

        <span class="hljs-keyword">switch</span> (key) {

            <span class="hljs-keyword">case</span> <span class="hljs-string">'lockTo'</span> :

                <span class="hljs-keyword">if</span> (value[<span class="hljs-number">0</span>] === <span class="hljs-string">'start'</span> &amp;&amp; value[<span class="hljs-number">1</span>] === <span class="hljs-string">'start'</span>) {

                    result = (includes.indexOf(<span class="hljs-string">'lockTo'</span>) &gt;= <span class="hljs-number">0</span>) ? <span class="hljs-literal">true</span> : <span class="hljs-literal">false</span>;
                }
                <span class="hljs-keyword">break</span>;

            <span class="hljs-keyword">default</span> :

                <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.lib === <span class="hljs-string">'entity'</span>) result = <span class="hljs-keyword">this</span>.processEntityPacketOut(key, value, includes);
                <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.isArtefact) result = <span class="hljs-keyword">this</span>.processDOMPacketOut(key, value, includes);
        }

        <span class="hljs-keyword">return</span> result;
    };

    P.handlePacketAnchor = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">copy, items</span>) </span>{

        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.anchor) {

            <span class="hljs-keyword">let</span> a = <span class="hljs-built_in">JSON</span>.parse(<span class="hljs-keyword">this</span>.anchor.saveAsPacket(items))[<span class="hljs-number">3</span>];
            copy.anchor = a;
        }
        <span class="hljs-keyword">return</span> copy;
    }</pre></div></div>
            
        </li>
        
        
        <li id="section-75">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-75">&#182;</a>
              </div>
              <h2 id="define-getter-setter-and-deltasetter-functions">Define getter, setter and deltaSetter functions</h2>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">let</span> G = P.getters,
        S = P.setters,
        D = P.deltaSetters;</pre></div></div>
            
        </li>
        
        
        <li id="section-76">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-76">&#182;</a>
              </div>
              <p>These getter functions return the <strong>current, pixel-based values</strong> for the pseudo-attributes associated with the ‘start’, ‘handle’, ‘offset’ and ‘dimensions’ attribute Arrays. These values will be different from those returned from the real attributes:</p>

            </div>
            
        </li>
        
        
        <li id="section-77">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-77">&#182;</a>
              </div>
              <pre><code><span class="hljs-comment">// for a block entity in a 100px x 100px canvas</span></code></pre>
            </div>
            
        </li>
        
        
        <li id="section-78">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-78">&#182;</a>
              </div>
              <pre><code><span class="hljs-keyword">let</span> myBlock = scrawl.makeBlock({
    <span class="hljs-attr">startX</span>: <span class="hljs-string">'10%'</span>,
    <span class="hljs-attr">startY</span>: <span class="hljs-string">'center'</span>,
    <span class="hljs-attr">width</span>: <span class="hljs-string">'40%'</span>,
    <span class="hljs-attr">height</span>: <span class="hljs-number">20</span>,
});</code></pre>
            </div>
            
        </li>
        
        
        <li id="section-79">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-79">&#182;</a>
              </div>
              <pre><code>myBlock.get(<span class="hljs-string">'startX'</span>);          <span class="hljs-comment">// 10</span>
myBlock.get(<span class="hljs-string">'startY'</span>);          <span class="hljs-comment">// 50</span>
myBlock.get(<span class="hljs-string">'start'</span>);           <span class="hljs-comment">// [10, 50]</span></code></pre>
            </div>
            
        </li>
        
        
        <li id="section-80">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-80">&#182;</a>
              </div>
              <pre><code>myBlock.start                     <span class="hljs-comment">// ['10%', 'center']</span></code></pre>
            </div>
            
        </li>
        
        
        <li id="section-81">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-81">&#182;</a>
              </div>
              <pre><code>myBlock.get(<span class="hljs-string">'width'</span>);           <span class="hljs-comment">// 40</span>
myBlock.get(<span class="hljs-string">'height'</span>);          <span class="hljs-comment">// 20</span>
myBlock.get(<span class="hljs-string">'dimensions'</span>);      <span class="hljs-comment">// [40, 20]</span></code></pre>
            </div>
            
        </li>
        
        
        <li id="section-82">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-82">&#182;</a>
              </div>
              <pre><code>myBlock.dimensions;              <span class="hljs-comment">// ['40%', 20]</span></code></pre>
            </div>
            
            <div class="content"><div class='highlight'><pre>    G.startX = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{

        <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.currentStart[<span class="hljs-number">0</span>];
    };
    G.startY = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{

        <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.currentStart[<span class="hljs-number">1</span>];
    };
    G.start = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{

        <span class="hljs-keyword">return</span> [].concat(<span class="hljs-keyword">this</span>.currentStart);
    };
    G.handleX = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{

        <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.currentHandle[<span class="hljs-number">0</span>];
    };
    G.handleY = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{

        <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.currentHandle[<span class="hljs-number">1</span>];
    };
    G.handle = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{

        <span class="hljs-keyword">return</span> [].concat(<span class="hljs-keyword">this</span>.currentHandle);
    };
    G.offsetX = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{

        <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.currentOffset[<span class="hljs-number">0</span>];
    };
    G.offsetY = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{

        <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.currentOffset[<span class="hljs-number">1</span>];
    };
    G.offset = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{

        <span class="hljs-keyword">return</span> [].concat(<span class="hljs-keyword">this</span>.currentOffset);
    };
    G.width = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{

        <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.currentDimensions[<span class="hljs-number">0</span>];
    };
    G.height = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{

        <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.currentDimensions[<span class="hljs-number">1</span>];
    };
    G.dimensions = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{

        <span class="hljs-keyword">return</span> [].concat(<span class="hljs-keyword">this</span>.currentDimensions);
    };</pre></div></div>
            
        </li>
        
        
        <li id="section-83">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-83">&#182;</a>
              </div>
              <p>Changes to an artefact’s dimensions attribute Array will set the <strong>dirtyDimensions</strong> flag, which will cause the currentDimensions Array to be recalculated and cascaded to other artefacts.</p>

            </div>
            
        </li>
        
        
        <li id="section-84">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-84">&#182;</a>
              </div>
              <p>The pseudo-attributes <strong>width</strong> and <strong>height</strong> can also be used for setting an artefact’s dimensions values.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    S.width = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">val</span>) </span>{

        <span class="hljs-keyword">if</span> (val != <span class="hljs-literal">null</span>) {

            <span class="hljs-keyword">this</span>.dimensions[<span class="hljs-number">0</span>] = val;
            <span class="hljs-keyword">this</span>.dirtyDimensions = <span class="hljs-literal">true</span>;
        }
    };
    S.height = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">val</span>) </span>{

        <span class="hljs-keyword">if</span> (val != <span class="hljs-literal">null</span>) {

            <span class="hljs-keyword">this</span>.dimensions[<span class="hljs-number">1</span>] = val;
            <span class="hljs-keyword">this</span>.dirtyDimensions = <span class="hljs-literal">true</span>;
        }
    };
    S.dimensions = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">w, h</span>) </span>{

        <span class="hljs-keyword">this</span>.setCoordinateHelper(<span class="hljs-string">'dimensions'</span>, w, h);
        <span class="hljs-keyword">this</span>.dirtyDimensions = <span class="hljs-literal">true</span>;
    };
    D.width = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">val</span>) </span>{

        <span class="hljs-keyword">let</span> c = <span class="hljs-keyword">this</span>.dimensions;
        c[<span class="hljs-number">0</span>] = addStrings(c[<span class="hljs-number">0</span>], val);
        <span class="hljs-keyword">this</span>.dirtyDimensions = <span class="hljs-literal">true</span>;
    };
    D.height = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">val</span>) </span>{

        <span class="hljs-keyword">let</span> c = <span class="hljs-keyword">this</span>.dimensions;
        c[<span class="hljs-number">1</span>] = addStrings(c[<span class="hljs-number">1</span>], val);
        <span class="hljs-keyword">this</span>.dirtyDimensions = <span class="hljs-literal">true</span>;
    };
    D.dimensions = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">w, h</span>) </span>{

        <span class="hljs-keyword">this</span>.setDeltaCoordinateHelper(<span class="hljs-string">'dimensions'</span>, w, h);
        <span class="hljs-keyword">this</span>.dirtyDimensions = <span class="hljs-literal">true</span>;
    }</pre></div></div>
            
        </li>
        
        
        <li id="section-85">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-85">&#182;</a>
              </div>
              <p>Changes to an artefact’s start attribute Array will set the <strong>dirtyStart</strong> flag, which will cause the currentStart Array to be recalculated and cascaded to other artefacts.</p>

            </div>
            
        </li>
        
        
        <li id="section-86">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-86">&#182;</a>
              </div>
              <p>The pseudo-attributes <strong>startX</strong> and <strong>startY</strong> can also be used for setting an artefact’s start values.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    S.startX = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">coord</span>) </span>{

        <span class="hljs-keyword">if</span> (coord != <span class="hljs-literal">null</span>) {

            <span class="hljs-keyword">this</span>.start[<span class="hljs-number">0</span>] = coord;
            <span class="hljs-keyword">this</span>.dirtyStart = <span class="hljs-literal">true</span>;
        }
    };
    S.startY = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">coord</span>) </span>{

        <span class="hljs-keyword">if</span> (coord != <span class="hljs-literal">null</span>) {

            <span class="hljs-keyword">this</span>.start[<span class="hljs-number">1</span>] = coord;
            <span class="hljs-keyword">this</span>.dirtyStart = <span class="hljs-literal">true</span>;
        }
    };
    S.start = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">x, y</span>) </span>{

        <span class="hljs-keyword">this</span>.setCoordinateHelper(<span class="hljs-string">'start'</span>, x, y);
        <span class="hljs-keyword">this</span>.dirtyStart = <span class="hljs-literal">true</span>;
    };
    D.startX = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">coord</span>) </span>{

        <span class="hljs-keyword">let</span> c = <span class="hljs-keyword">this</span>.start;
        c[<span class="hljs-number">0</span>] = addStrings(c[<span class="hljs-number">0</span>], coord);
        <span class="hljs-keyword">this</span>.dirtyStart = <span class="hljs-literal">true</span>;
    };
    D.startY = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">coord</span>) </span>{

        <span class="hljs-keyword">let</span> c = <span class="hljs-keyword">this</span>.start;
        c[<span class="hljs-number">1</span>] = addStrings(c[<span class="hljs-number">1</span>], coord);
        <span class="hljs-keyword">this</span>.dirtyStart = <span class="hljs-literal">true</span>;
    };
    D.start = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">x, y</span>) </span>{

        <span class="hljs-keyword">this</span>.setDeltaCoordinateHelper(<span class="hljs-string">'start'</span>, x, y);
        <span class="hljs-keyword">this</span>.dirtyStart = <span class="hljs-literal">true</span>;
    };</pre></div></div>
            
        </li>
        
        
        <li id="section-87">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-87">&#182;</a>
              </div>
              <p>Changes to an artefact’s handle attribute Array will set the <strong>dirtyHandle</strong> flag, which will cause the currentHandle Array to be recalculated and cascaded to other artefacts.</p>

            </div>
            
        </li>
        
        
        <li id="section-88">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-88">&#182;</a>
              </div>
              <p>The pseudo-attributes <strong>handleX</strong> and <strong>handleY</strong> can also be used for setting an artefact’s handle values.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    S.handleX = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">coord</span>) </span>{

        <span class="hljs-keyword">if</span> (coord != <span class="hljs-literal">null</span>) {

            <span class="hljs-keyword">this</span>.handle[<span class="hljs-number">0</span>] = coord;
            <span class="hljs-keyword">this</span>.dirtyHandle = <span class="hljs-literal">true</span>;
        }
    };

    S.handleY = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">coord</span>) </span>{

        <span class="hljs-keyword">if</span> (coord != <span class="hljs-literal">null</span>) {

            <span class="hljs-keyword">this</span>.handle[<span class="hljs-number">1</span>] = coord;
            <span class="hljs-keyword">this</span>.dirtyHandle = <span class="hljs-literal">true</span>;
        }
    };

    S.handle = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">x, y</span>) </span>{

        <span class="hljs-keyword">this</span>.setCoordinateHelper(<span class="hljs-string">'handle'</span>, x, y);
        <span class="hljs-keyword">this</span>.dirtyHandle = <span class="hljs-literal">true</span>;
    };

    D.handleX = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">coord</span>) </span>{

        <span class="hljs-keyword">let</span> c = <span class="hljs-keyword">this</span>.handle;
        c[<span class="hljs-number">0</span>] = addStrings(c[<span class="hljs-number">0</span>], coord);
        <span class="hljs-keyword">this</span>.dirtyHandle = <span class="hljs-literal">true</span>;
    };

    D.handleY = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">coord</span>) </span>{

        <span class="hljs-keyword">let</span> c = <span class="hljs-keyword">this</span>.handle;
        c[<span class="hljs-number">1</span>] = addStrings(c[<span class="hljs-number">1</span>], coord);
        <span class="hljs-keyword">this</span>.dirtyHandle = <span class="hljs-literal">true</span>;
    };

    D.handle = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">x, y</span>) </span>{

        <span class="hljs-keyword">this</span>.setDeltaCoordinateHelper(<span class="hljs-string">'handle'</span>, x, y);
        <span class="hljs-keyword">this</span>.dirtyHandle = <span class="hljs-literal">true</span>;
    };</pre></div></div>
            
        </li>
        
        
        <li id="section-89">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-89">&#182;</a>
              </div>
              <p>Changes to an artefact’s offset attribute Array will set the <strong>dirtyOffset</strong> flag, which will cause the currentOffset Array to be recalculated and cascaded to other artefacts.</p>

            </div>
            
        </li>
        
        
        <li id="section-90">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-90">&#182;</a>
              </div>
              <p>The pseudo-attributes <strong>offsetX</strong> and <strong>offsetY</strong> can also be used for setting an artefact’s offset values.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    S.offsetX = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">coord</span>) </span>{

        <span class="hljs-keyword">if</span> (coord != <span class="hljs-literal">null</span>) {

            <span class="hljs-keyword">this</span>.offset[<span class="hljs-number">0</span>] = coord;
            <span class="hljs-keyword">this</span>.dirtyOffset = <span class="hljs-literal">true</span>;
        }
    };
    S.offsetY = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">coord</span>) </span>{

        <span class="hljs-keyword">if</span> (coord != <span class="hljs-literal">null</span>) {

            <span class="hljs-keyword">this</span>.offset[<span class="hljs-number">1</span>] = coord;
            <span class="hljs-keyword">this</span>.dirtyOffset = <span class="hljs-literal">true</span>;
        }
    };
    S.offset = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">x, y</span>) </span>{

        <span class="hljs-keyword">this</span>.setCoordinateHelper(<span class="hljs-string">'offset'</span>, x, y);
        <span class="hljs-keyword">this</span>.dirtyOffset = <span class="hljs-literal">true</span>;
    };
    D.offsetX = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">coord</span>) </span>{

        <span class="hljs-keyword">let</span> c = <span class="hljs-keyword">this</span>.offset;
        c[<span class="hljs-number">0</span>] = addStrings(c[<span class="hljs-number">0</span>], coord);
        <span class="hljs-keyword">this</span>.dirtyOffset = <span class="hljs-literal">true</span>;
    };
    D.offsetY = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">coord</span>) </span>{

        <span class="hljs-keyword">let</span> c = <span class="hljs-keyword">this</span>.offset;
        c[<span class="hljs-number">1</span>] = addStrings(c[<span class="hljs-number">1</span>], coord);
        <span class="hljs-keyword">this</span>.dirtyOffset = <span class="hljs-literal">true</span>;
    };
    D.offset = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">x, y</span>) </span>{

        <span class="hljs-keyword">this</span>.setDeltaCoordinateHelper(<span class="hljs-string">'offset'</span>, x, y);
        <span class="hljs-keyword">this</span>.dirtyOffset = <span class="hljs-literal">true</span>;
    };</pre></div></div>
            
        </li>
        
        
        <li id="section-91">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-91">&#182;</a>
              </div>
              <p>The <strong>dragOffset</strong> Array is internal. We use it to store local offsets established as part of an artefact’s dynamic drag/drop functionality.</p>

            </div>
            
        </li>
        
        
        <li id="section-92">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-92">&#182;</a>
              </div>
              <p>TODO: check whether any code is using artefact.get(‘dragOffset’) - if not, we can delete these functions
    - dragOffset is purely internal, and should be of no interest to the user - thus no need to keep related getter/setter functions??</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    G.dragOffsetX = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{

        <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.dragOffset[<span class="hljs-number">0</span>];
    };
    G.dragOffsetY = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{

        <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.dragOffset[<span class="hljs-number">1</span>];
    };
    S.dragOffsetX = defaultNonReturnFunction;
    S.dragOffsetY = defaultNonReturnFunction;
    S.dragOffset = defaultNonReturnFunction;
    D.dragOffsetX = defaultNonReturnFunction;
    D.dragOffsetY = defaultNonReturnFunction;
    D.dragOffset = defaultNonReturnFunction;</pre></div></div>
            
        </li>
        
        
        <li id="section-93">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-93">&#182;</a>
              </div>
              <p>The sensorSpacing attribute can be set/deltaSet. Value changes trigger the setting of the <strong>dirtyCollision</strong> flag which eventually leads to the recalculation of sensor coordinates within and around the artefact’s border.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    S.sensorSpacing = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">val</span>) </span>{

        <span class="hljs-keyword">this</span>.sensorSpacing = val;
        <span class="hljs-keyword">this</span>.dirtyCollision = <span class="hljs-literal">true</span>;
    };
    D.sensorSpacing = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">val</span>) </span>{

        <span class="hljs-keyword">this</span>.sensorSpacing += val;
        <span class="hljs-keyword">this</span>.dirtyCollision = <span class="hljs-literal">true</span>;
    };</pre></div></div>
            
        </li>
        
        
        <li id="section-94">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-94">&#182;</a>
              </div>
              <p>The <strong>pivot</strong> setter function can accept either a pivot’s ‘name’ attribute string, or the pivot object itself.</p>

            </div>
            
        </li>
        
        
        <li id="section-95">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-95">&#182;</a>
              </div>
              <p>Changing the pivot will set the <strong>dirtyStampPositions</strong> and <strong>dirtyStampHandlePositions</strong> flags.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    S.pivot = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">item</span>) </span>{

        <span class="hljs-keyword">let</span> oldPivot = <span class="hljs-keyword">this</span>.pivot,
            newPivot = (item.substring) ? artefact[item] : item,
            name = <span class="hljs-keyword">this</span>.name;

        <span class="hljs-keyword">if</span> (newPivot &amp;&amp; newPivot.name) {

            <span class="hljs-keyword">if</span> (oldPivot &amp;&amp; oldPivot.name !== newPivot.name) removeItem(oldPivot.pivoted, name);

            pushUnique(newPivot.pivoted, name);

            <span class="hljs-keyword">this</span>.pivot = newPivot;
            <span class="hljs-keyword">this</span>.dirtyStampPositions = <span class="hljs-literal">true</span>;
            <span class="hljs-keyword">this</span>.dirtyStampHandlePositions = <span class="hljs-literal">true</span>;
        }
    };</pre></div></div>
            
        </li>
        
        
        <li id="section-96">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-96">&#182;</a>
              </div>
              <p>DOM-based artefacts (‘stack’, ‘canvas’[1], ‘element’) supply <strong>corner pivots</strong> in addition to the common <strong>start pivot</strong>. When an artefact pivots to a DOM-based artefact it can choose whether to pivot to that artefact’s start coordinate (default: ‘’), or to one of the corner coordinates. The choice of corner is kept, as a string value, in the <strong>pivotCorner</strong> attribute.</p>

            </div>
            
        </li>
        
        
        <li id="section-97">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-97">&#182;</a>
              </div>
              <p>The pivotCorner attribute can be one of: ‘topLeft’, ‘topRight’, ‘bottomRight’ or ‘bottomLeft’</p>

            </div>
            
        </li>
        
        
        <li id="section-98">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-98">&#182;</a>
              </div>
              <p>[1] Canvas artefact corner marker &lt;div&gt; elements routinely report their coordinates as [0, 0] - this is expected behaviour.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    P.pivotCorners = [<span class="hljs-string">'topLeft'</span>, <span class="hljs-string">'topRight'</span>, <span class="hljs-string">'bottomRight'</span>, <span class="hljs-string">'bottomLeft'</span>];
    S.pivotCorner = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">item</span>) </span>{

        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.pivotCorners.indexOf(item) &gt;= <span class="hljs-number">0</span>) <span class="hljs-keyword">this</span>.pivotCorner = item;
    };</pre></div></div>
            
        </li>
        
        
        <li id="section-99">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-99">&#182;</a>
              </div>
              <p>Boolean flags to tweak pivot-tracking behaviour. Each setter will also set the appropriate dirty flag for each tweaked attribute</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    S.addPivotHandle = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">item</span>) </span>{

        <span class="hljs-keyword">this</span>.addPivotHandle = item;
        <span class="hljs-keyword">this</span>.dirtyHandle = <span class="hljs-literal">true</span>;
    };
    S.addPivotOffset = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">item</span>) </span>{

        <span class="hljs-keyword">this</span>.addPivotOffset = item;
        <span class="hljs-keyword">this</span>.dirtyOffset = <span class="hljs-literal">true</span>;
    };
    S.addPivotRotation = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">item</span>) </span>{

        <span class="hljs-keyword">this</span>.addPivotRotation = item;
        <span class="hljs-keyword">this</span>.dirtyRotation = <span class="hljs-literal">true</span>;
    };</pre></div></div>
            
        </li>
        
        
        <li id="section-100">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-100">&#182;</a>
              </div>
              <p>The <strong>path</strong> setter function can accept either a path’ ‘name’ attribute string, or the path’s object itself.</p>

            </div>
            
        </li>
        
        
        <li id="section-101">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-101">&#182;</a>
              </div>
              <p>The <strong>pathPosition</strong> setter accepts a positive float Number between the values of 0 and 1. The deltaSetter will check whether the resulting addition takes the pathPosition value beyond those values and correct accordingly.</p>

            </div>
            
        </li>
        
        
        <li id="section-102">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-102">&#182;</a>
              </div>
              <p>TODO: current functionality is for pathPosition to loop - is there a case for adding a pathPosition loop flag? If yes, then when that flag is false values &lt; 0 would be corrected back to 0, and vals &gt; 1 would be corrected back to 1.</p>

            </div>
            
        </li>
        
        
        <li id="section-103">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-103">&#182;</a>
              </div>
              <p>Changing the path or the pathPosition attributes will set the <strong>dirtyStampPositions</strong> and <strong>dirtyStampHandlePositions</strong> flags.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    S.path = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">item</span>) </span>{

        <span class="hljs-keyword">let</span> oldPath = <span class="hljs-keyword">this</span>.path,
            newPath = (item.substring) ? artefact[item] : item,
            name = <span class="hljs-keyword">this</span>.name;

        <span class="hljs-keyword">if</span> (newPath &amp;&amp; newPath.name &amp;&amp; newPath.useAsPath) {

            <span class="hljs-keyword">if</span> (oldPath &amp;&amp; oldPath.name !== newPath.name) removeItem(oldPath.pathed, name);

            pushUnique(newPath.pathed, name);

            <span class="hljs-keyword">this</span>.path = newPath;
            <span class="hljs-keyword">this</span>.dirtyStampPositions = <span class="hljs-literal">true</span>;
            <span class="hljs-keyword">this</span>.dirtyStampHandlePositions = <span class="hljs-literal">true</span>;
        }
    };
    S.pathPosition = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">item</span>) </span>{

        <span class="hljs-keyword">if</span> (item &lt; <span class="hljs-number">0</span>) item = <span class="hljs-built_in">Math</span>.abs(item);
        <span class="hljs-keyword">if</span> (item &gt; <span class="hljs-number">1</span>) item = item % <span class="hljs-number">1</span>;

        <span class="hljs-keyword">this</span>.pathPosition = <span class="hljs-built_in">parseFloat</span>(item.toFixed(<span class="hljs-number">6</span>));
        <span class="hljs-keyword">this</span>.dirtyStampPositions = <span class="hljs-literal">true</span>;
        <span class="hljs-keyword">this</span>.dirtyStampHandlePositions = <span class="hljs-literal">true</span>;
    };
    D.pathPosition = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">item</span>) </span>{

        <span class="hljs-keyword">let</span> pos = <span class="hljs-keyword">this</span>.pathPosition + item

        <span class="hljs-keyword">if</span> (pos &lt; <span class="hljs-number">0</span>) pos += <span class="hljs-number">1</span>;
        <span class="hljs-keyword">if</span> (pos &gt; <span class="hljs-number">1</span>) pos = pos % <span class="hljs-number">1</span>;

        <span class="hljs-keyword">this</span>.pathPosition = <span class="hljs-built_in">parseFloat</span>(pos.toFixed(<span class="hljs-number">6</span>));
        <span class="hljs-keyword">this</span>.dirtyStampPositions = <span class="hljs-literal">true</span>;
        <span class="hljs-keyword">this</span>.dirtyStampHandlePositions = <span class="hljs-literal">true</span>;
    };</pre></div></div>
            
        </li>
        
        
        <li id="section-104">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-104">&#182;</a>
              </div>
              <p>Boolean flags to tweak path-following behaviour. Each setter will also set the appropriate dirty flag for each tweaked attribute</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    S.addPathHandle = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">item</span>) </span>{

        <span class="hljs-keyword">this</span>.addPathHandle = item;
        <span class="hljs-keyword">this</span>.dirtyHandle = <span class="hljs-literal">true</span>;
    };
    S.addPathOffset = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">item</span>) </span>{

        <span class="hljs-keyword">this</span>.addPathOffset = item;
        <span class="hljs-keyword">this</span>.dirtyOffset = <span class="hljs-literal">true</span>;
    };
    S.addPathRotation = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">item</span>) </span>{

        <span class="hljs-keyword">this</span>.addPathRotation = item;
        <span class="hljs-keyword">this</span>.dirtyRotation = <span class="hljs-literal">true</span>;
    };</pre></div></div>
            
        </li>
        
        
        <li id="section-105">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-105">&#182;</a>
              </div>
              <p>The <strong>mimic</strong> setter function can accept either a mimic artefact’s ‘name’ attribute string, or the mimic object itself.</p>

            </div>
            
        </li>
        
        
        <li id="section-106">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-106">&#182;</a>
              </div>
              <p>Changing the mimic will set the <strong>dirtyStampPositions</strong> and <strong>dirtyStampHandlePositions</strong> flags.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    S.mimic = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">item</span>) </span>{

        <span class="hljs-keyword">let</span> oldMimic = <span class="hljs-keyword">this</span>.mimic,
            newMimic = (item.substring) ? artefact[item] : item,
            name = <span class="hljs-keyword">this</span>.name;

        <span class="hljs-keyword">if</span> (newMimic &amp;&amp; newMimic.name) {

            <span class="hljs-keyword">if</span> (oldMimic &amp;&amp; oldMimic.name !== newMimic.name) removeItem(oldMimic.mimicked, name);

            pushUnique(newMimic.mimicked, name);

            <span class="hljs-keyword">this</span>.mimic = newMimic;
            <span class="hljs-keyword">this</span>.dirtyStampPositions = <span class="hljs-literal">true</span>;
            <span class="hljs-keyword">this</span>.dirtyStampHandlePositions = <span class="hljs-literal">true</span>;
        }
    };</pre></div></div>
            
        </li>
        
        
        <li id="section-107">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-107">&#182;</a>
              </div>
              <p>Boolean flags to tweak mimic-tracking behaviour. Each setter will also set the appropriate dirty flag for each tweaked attribute</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    S.useMimicDimensions = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">item</span>) </span>{

        <span class="hljs-keyword">this</span>.useMimicDimensions = item;
        <span class="hljs-keyword">this</span>.dirtyDimensions = <span class="hljs-literal">true</span>;
    };
    S.useMimicScale = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">item</span>) </span>{

        <span class="hljs-keyword">this</span>.useMimicScale = item;
        <span class="hljs-keyword">this</span>.dirtyScale = <span class="hljs-literal">true</span>;
    };
    S.useMimicStart = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">item</span>) </span>{

        <span class="hljs-keyword">this</span>.useMimicStart = item;
        <span class="hljs-keyword">this</span>.dirtyStart = <span class="hljs-literal">true</span>;
    };
    S.useMimicHandle = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">item</span>) </span>{

        <span class="hljs-keyword">this</span>.useMimicHandle = item;
        <span class="hljs-keyword">this</span>.dirtyHandle = <span class="hljs-literal">true</span>;
    };
    S.useMimicOffset = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">item</span>) </span>{

        <span class="hljs-keyword">this</span>.useMimicOffset = item;
        <span class="hljs-keyword">this</span>.dirtyOffset = <span class="hljs-literal">true</span>;
    };
    S.useMimicRotation = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">item</span>) </span>{

        <span class="hljs-keyword">this</span>.useMimicRotation = item;
        <span class="hljs-keyword">this</span>.dirtyRotation = <span class="hljs-literal">true</span>;
    };
    S.addOwnDimensionsToMimic = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">item</span>) </span>{

        <span class="hljs-keyword">this</span>.addOwnDimensionsToMimic = item;
        <span class="hljs-keyword">this</span>.dirtyDimensions = <span class="hljs-literal">true</span>;
    };
    S.addOwnScaleToMimic = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">item</span>) </span>{

        <span class="hljs-keyword">this</span>.addOwnScaleToMimic = item;
        <span class="hljs-keyword">this</span>.dirtyScale = <span class="hljs-literal">true</span>;
    };
    S.addOwnStartToMimic = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">item</span>) </span>{

        <span class="hljs-keyword">this</span>.addOwnStartToMimic = item;
        <span class="hljs-keyword">this</span>.dirtyStart = <span class="hljs-literal">true</span>;
    };
    S.addOwnHandleToMimic = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">item</span>) </span>{

        <span class="hljs-keyword">this</span>.addOwnHandleToMimic = item;
        <span class="hljs-keyword">this</span>.dirtyHandle = <span class="hljs-literal">true</span>;
    };
    S.addOwnOffsetToMimic = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">item</span>) </span>{

        <span class="hljs-keyword">this</span>.addOwnOffsetToMimic = item;
        <span class="hljs-keyword">this</span>.dirtyOffset = <span class="hljs-literal">true</span>;
    };
    S.addOwnRotationToMimic = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">item</span>) </span>{

        <span class="hljs-keyword">this</span>.addOwnRotationToMimic = item;
        <span class="hljs-keyword">this</span>.dirtyRotation = <span class="hljs-literal">true</span>;
    };</pre></div></div>
            
        </li>
        
        
        <li id="section-108">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-108">&#182;</a>
              </div>
              <p>For ease of use, we supply the user with 3 functions for setting <strong>positioning locks</strong> on the lockTo array:</p>

            </div>
            
        </li>
        
        
        <li id="section-109">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-109">&#182;</a>
              </div>
              <ul>
<li>The <strong>lockXTo</strong> pseudo-attribute will update the x coordinate lock value.</li>
<li>The <strong>lockYTo</strong> pseudo-attribute will update the y coordinate lock value.</li>
<li>the <strong>lockTo</strong> attribute will update both the x and y coordinates. It can accept: either an [x, y] Array; or a String value, in which case both x and y lock values are updated to that value.</li>
</ul>

            </div>
            
        </li>
        
        
        <li id="section-110">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-110">&#182;</a>
              </div>
              <p>Valid lock String values are: ‘start’ (the default), ‘pivot’, ‘path’, ‘mimic’, and ‘mouse’.</p>

            </div>
            
        </li>
        
        
        <li id="section-111">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-111">&#182;</a>
              </div>
              <pre><code>Example: create a block entity that follows mouse movements <span class="hljs-keyword">in</span> the horizontal plane only</code></pre>
            </div>
            
        </li>
        
        
        <li id="section-112">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-112">&#182;</a>
              </div>
              <pre><code><span class="hljs-keyword">let</span> myBlock = scrawl.makeBlock({
    [... etc]
    <span class="hljs-attr">lockXTo</span>: <span class="hljs-string">'mouse'</span>,
    <span class="hljs-attr">lockYTo</span>: <span class="hljs-string">'start'</span>,
});</code></pre>
            </div>
            
        </li>
        
        
        <li id="section-113">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-113">&#182;</a>
              </div>
              <pre><code>... update the block so that it acts like the mouse<span class="hljs-string">'s cursor</span></code></pre>
            </div>
            
        </li>
        
        
        <li id="section-114">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-114">&#182;</a>
              </div>
              <pre><code>myBlock.set({
    <span class="hljs-attr">lockTo</span>: <span class="hljs-string">'mouse'</span>,
});</code></pre>
            </div>
            
            <div class="content"><div class='highlight'><pre>    S.lockTo = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">item</span>) </span>{

        <span class="hljs-keyword">if</span> (<span class="hljs-built_in">Array</span>.isArray(item)) {

            <span class="hljs-keyword">this</span>.lockTo[<span class="hljs-number">0</span>] = item[<span class="hljs-number">0</span>];
            <span class="hljs-keyword">this</span>.lockTo[<span class="hljs-number">1</span>] = item[<span class="hljs-number">1</span>];
        }
        <span class="hljs-keyword">else</span> {

            <span class="hljs-keyword">this</span>.lockTo[<span class="hljs-number">0</span>] = item;
            <span class="hljs-keyword">this</span>.lockTo[<span class="hljs-number">1</span>] = item;
        }
        <span class="hljs-keyword">this</span>.dirtyLock = <span class="hljs-literal">true</span>;
    };
    S.lockXTo = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">item</span>) </span>{

        <span class="hljs-keyword">this</span>.lockTo[<span class="hljs-number">0</span>] = item;
        <span class="hljs-keyword">this</span>.dirtyLock = <span class="hljs-literal">true</span>;
    };
    S.lockYTo = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">item</span>) </span>{

        <span class="hljs-keyword">this</span>.lockTo[<span class="hljs-number">1</span>] = item;
        <span class="hljs-keyword">this</span>.dirtyLock = <span class="hljs-literal">true</span>;
    };</pre></div></div>
            
        </li>
        
        
        <li id="section-115">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-115">&#182;</a>
              </div>
              <p>TODO - documentation</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    S.roll = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">item</span>) </span>{

        <span class="hljs-keyword">if</span> (!isa_number(item)) <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(<span class="hljs-string">`mixin/position error - S.roll() argument not a number: <span class="hljs-subst">${item}</span>`</span>);

        <span class="hljs-keyword">this</span>.roll = item;
        <span class="hljs-keyword">this</span>.dirtyRotation = <span class="hljs-literal">true</span>;
    };
    D.roll = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">item</span>) </span>{

        <span class="hljs-keyword">if</span> (!isa_number(item)) <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(<span class="hljs-string">`mixin/position error - D.roll() argument not a number: <span class="hljs-subst">${item}</span>`</span>);
        
        <span class="hljs-keyword">this</span>.roll += item;
        <span class="hljs-keyword">this</span>.dirtyRotation = <span class="hljs-literal">true</span>;
    };</pre></div></div>
            
        </li>
        
        
        <li id="section-116">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-116">&#182;</a>
              </div>
              <p>TODO - check to see what happens when we apply a negative scale to an artefact
    - adapt one of the demos so that the scale value can be set to a negative value
    - decide if the results are something we want to keep as functionality
        - if negative scales leads to unwelcome effects, adapt function to only accept +ve values</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    S.scale = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">item</span>) </span>{

        <span class="hljs-keyword">if</span> (!isa_number(item)) <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(<span class="hljs-string">`mixin/position error - S.scale() argument not a number: <span class="hljs-subst">${item}</span>`</span>);
        
        <span class="hljs-keyword">this</span>.scale = item;
        <span class="hljs-keyword">this</span>.dirtyScale = <span class="hljs-literal">true</span>;
    };
    D.scale = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">item</span>) </span>{

        <span class="hljs-keyword">if</span> (!isa_number(item)) <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(<span class="hljs-string">`mixin/position error - D.scale() argument not a number: <span class="hljs-subst">${item}</span>`</span>);
        
        <span class="hljs-keyword">this</span>.scale += item;
        <span class="hljs-keyword">this</span>.dirtyScale = <span class="hljs-literal">true</span>;
    };</pre></div></div>
            
        </li>
        
        
        <li id="section-117">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-117">&#182;</a>
              </div>
              <p>TODO - documentation</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    S.delta = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">items = {}</span>) </span>{

        <span class="hljs-keyword">if</span> (items) <span class="hljs-keyword">this</span>.delta = mergeDiscard(<span class="hljs-keyword">this</span>.delta, items);
    };</pre></div></div>
            
        </li>
        
        
        <li id="section-118">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-118">&#182;</a>
              </div>
              <p>TODO - documentation</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    S.host = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">item</span>) </span>{

        <span class="hljs-keyword">if</span> (item) {

            <span class="hljs-keyword">let</span> host = artefact[item];

            <span class="hljs-keyword">if</span> (host &amp;&amp; host.here) <span class="hljs-keyword">this</span>.host = host.name;
            <span class="hljs-keyword">else</span> <span class="hljs-keyword">this</span>.host = item;
        }
        <span class="hljs-keyword">else</span> <span class="hljs-keyword">this</span>.host = <span class="hljs-string">''</span>;

        <span class="hljs-keyword">this</span>.dirtyDimensions = <span class="hljs-literal">true</span>;
        <span class="hljs-keyword">this</span>.dirtyHandle = <span class="hljs-literal">true</span>;
        <span class="hljs-keyword">this</span>.dirtyStart = <span class="hljs-literal">true</span>;
        <span class="hljs-keyword">this</span>.dirtyOffset = <span class="hljs-literal">true</span>;
    };</pre></div></div>
            
        </li>
        
        
        <li id="section-119">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-119">&#182;</a>
              </div>
              <p>TODO - documentation</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    S.group = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">item</span>) </span>{

        <span class="hljs-keyword">let</span> g;

        <span class="hljs-keyword">if</span> (item) {

            <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.group &amp;&amp; <span class="hljs-keyword">this</span>.group.type === <span class="hljs-string">'Group'</span>) <span class="hljs-keyword">this</span>.group.removeArtefacts(<span class="hljs-keyword">this</span>.name);

            <span class="hljs-keyword">if</span> (item.substring) {

                g = group[item];

                <span class="hljs-keyword">if</span> (g) <span class="hljs-keyword">this</span>.group = g;
                <span class="hljs-keyword">else</span> <span class="hljs-keyword">this</span>.group = item;
            }
            <span class="hljs-keyword">else</span> <span class="hljs-keyword">this</span>.group = item;
        }

        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.group &amp;&amp; <span class="hljs-keyword">this</span>.group.type === <span class="hljs-string">'Group'</span>) <span class="hljs-keyword">this</span>.group.addArtefacts(<span class="hljs-keyword">this</span>.name);
    };</pre></div></div>
            
        </li>
        
        
        <li id="section-120">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-120">&#182;</a>
              </div>
              <h2 id="define-functions-to-be-added-to-the-factory-prototype">Define functions to be added to the factory prototype</h2>

            </div>
            
        </li>
        
        
        <li id="section-121">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-121">&#182;</a>
              </div>
              <p>Internal function to setup initial Arrays and Objects, including ‘current…’ and ‘…Subscriber’ Arrays.</p>

            </div>
            
        </li>
        
        
        <li id="section-122">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-122">&#182;</a>
              </div>
              <p>It also creates a group ‘dirty…’ flags and sets them all to true. </p>

            </div>
            
        </li>
        
        
        <li id="section-123">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-123">&#182;</a>
              </div>
              <p>Scrawl-canvas depends heavily on dirty flags. </p>

            </div>
            
        </li>
        
        
        <li id="section-124">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-124">&#182;</a>
              </div>
              <ul>
<li>Changes to a Scrawl-canvas object via the <strong>set()</strong> and <strong>setDelta()</strong> functions will set relevant flags to true. </li>
<li>Then, during the compile stage of the display cycle, we will recalculate and update only those attributes tagged for cleaning by the dirty flags. </li>
<li>If nothing has happened to set any dirty flags to true since the last RequestAnimationFrame tick, then there’s nothing new to calculate and we can proceed to displaying the object in the canvas (or stack) using existing calculated values.</li>
<li>most calculated values are kept in attributes starting with ‘current…’ eg currentHandle, currentStampPosition, etc.</li>
</ul>

            </div>
            
            <div class="content"><div class='highlight'><pre>    P.initializePositions = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{

        <span class="hljs-keyword">this</span>.dimensions = makeCoordinate();
        <span class="hljs-keyword">this</span>.start = makeCoordinate();
        <span class="hljs-keyword">this</span>.handle = makeCoordinate();
        <span class="hljs-keyword">this</span>.offset = makeCoordinate();

        <span class="hljs-keyword">this</span>.currentDimensions = makeCoordinate();
        <span class="hljs-keyword">this</span>.currentStart = makeCoordinate();
        <span class="hljs-keyword">this</span>.currentHandle = makeCoordinate();
        <span class="hljs-keyword">this</span>.currentOffset = makeCoordinate();

        <span class="hljs-keyword">this</span>.currentDragOffset = makeCoordinate();
        <span class="hljs-keyword">this</span>.currentDragCache = makeCoordinate();
        <span class="hljs-keyword">this</span>.currentStartCache = makeCoordinate();

        <span class="hljs-keyword">this</span>.currentStampPosition = makeCoordinate();
        <span class="hljs-keyword">this</span>.currentStampHandlePosition = makeCoordinate();

        <span class="hljs-keyword">this</span>.delta = {};

        <span class="hljs-keyword">this</span>.lockTo = [<span class="hljs-string">'start'</span>, <span class="hljs-string">'start'</span>];

        <span class="hljs-keyword">this</span>.pivoted = [];
        <span class="hljs-keyword">this</span>.mimicked = [];

        <span class="hljs-keyword">this</span>.controlSubscriber = [];
        <span class="hljs-keyword">this</span>.startControlSubscriber = [];
        <span class="hljs-keyword">this</span>.endControlSubscriber = [];
        <span class="hljs-keyword">this</span>.endSubscriber = [];

        <span class="hljs-keyword">this</span>.dirtyScale = <span class="hljs-literal">true</span>;
        <span class="hljs-keyword">this</span>.dirtyDimensions = <span class="hljs-literal">true</span>;
        <span class="hljs-keyword">this</span>.dirtyLock = <span class="hljs-literal">true</span>;
        <span class="hljs-keyword">this</span>.dirtyStart = <span class="hljs-literal">true</span>;
        <span class="hljs-keyword">this</span>.dirtyOffset = <span class="hljs-literal">true</span>;
        <span class="hljs-keyword">this</span>.dirtyHandle = <span class="hljs-literal">true</span>;
        <span class="hljs-keyword">this</span>.dirtyRotation = <span class="hljs-literal">true</span>;

        <span class="hljs-keyword">this</span>.isBeingDragged = <span class="hljs-literal">false</span>;

        <span class="hljs-keyword">this</span>.initializeDomPositions();
    };

    P.initializeDomPositions = defaultNonReturnFunction;</pre></div></div>
            
        </li>
        
        
        <li id="section-125">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-125">&#182;</a>
              </div>
              <p>TODO - documentation - ‘kill’ functionality needs to be reconsidered and recoded across the whole code base</p>

            </div>
            
        </li>
        
        
        <li id="section-126">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-126">&#182;</a>
              </div>
              <p>Overwrites mixin/base.js function</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>
    P.kill = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{

        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.group &amp;&amp; <span class="hljs-keyword">this</span>.group.name) <span class="hljs-keyword">this</span>.group.removeArtefacts(<span class="hljs-keyword">this</span>.name);
        <span class="hljs-keyword">this</span>.demolishAnchor();
        <span class="hljs-keyword">this</span>.deregister();
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>;
    };</pre></div></div>
            
        </li>
        
        
        <li id="section-127">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-127">&#182;</a>
              </div>
              <p>Helper function used by the ‘dimensions’, ‘start’, ‘handle’ and ‘offset’ setter functions. Arguments are:</p>

            </div>
            
        </li>
        
        
        <li id="section-128">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-128">&#182;</a>
              </div>
              <ul>
<li><strong>label</strong> - either ‘dimensions’, ‘start’, ‘handle’ or ‘offset’</li>
<li><strong>x</strong> - this can be either an [x, y] array, or an {x: val, y: val} object, or a Number or %String value</li>
<li><strong>y</strong> - if x is a number or string, then y should also be a number or string</li>
</ul>

            </div>
            
        </li>
        
        
        <li id="section-129">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-129">&#182;</a>
              </div>
              <p>(The array and object versions can also be [w, h], or {w:val, h:val}, or {width:val, height:val})</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    P.setCoordinateHelper = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">label, x, y</span>) </span>{

        <span class="hljs-keyword">let</span> c = <span class="hljs-keyword">this</span>[label];

        <span class="hljs-keyword">if</span> (<span class="hljs-built_in">Array</span>.isArray(x)) {

            c[<span class="hljs-number">0</span>] = x[<span class="hljs-number">0</span>];
            c[<span class="hljs-number">1</span>] = x[<span class="hljs-number">1</span>];
        }
        <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (isa_obj(x)) {

            <span class="hljs-keyword">if</span> (xto(x.x, x.y)) {

                c[<span class="hljs-number">0</span>] = xtGet(x.x, c[<span class="hljs-number">0</span>]);
                c[<span class="hljs-number">1</span>] = xtGet(x.y, c[<span class="hljs-number">1</span>]);
            }
            <span class="hljs-keyword">else</span> {

                c[<span class="hljs-number">0</span>] = xtGet(x.width, x.w, c[<span class="hljs-number">0</span>]);
                c[<span class="hljs-number">1</span>] = xtGet(x.height, x.h, c[<span class="hljs-number">1</span>]);
            }
        }
        <span class="hljs-keyword">else</span> {

            c[<span class="hljs-number">0</span>] = x;
            c[<span class="hljs-number">1</span>] = y;
        }
    };</pre></div></div>
            
        </li>
        
        
        <li id="section-130">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-130">&#182;</a>
              </div>
              <p>Helper function used by the ‘dimensions’, ‘start’, ‘handle’ and ‘offset’ delta-setter functions. Arguments are:</p>

            </div>
            
        </li>
        
        
        <li id="section-131">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-131">&#182;</a>
              </div>
              <ul>
<li><strong>label</strong> - either ‘dimensions’, ‘start’, ‘handle’ or ‘offset’</li>
<li><strong>x</strong> - this can be either an [x, y] array, or an {x: val, y: val} object, or a Number or %String value</li>
<li><strong>y</strong> - if x is a number or string, then y should also be a number or string</li>
</ul>

            </div>
            
        </li>
        
        
        <li id="section-132">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-132">&#182;</a>
              </div>
              <p>(The array and object versions can also be [w, h], or {w:val, h:val}, or {width:val, height:val})</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    P.setDeltaCoordinateHelper = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">label, x, y</span>) </span>{

        <span class="hljs-keyword">let</span> c = <span class="hljs-keyword">this</span>[label],
            myX = c[<span class="hljs-number">0</span>],
            myY = c[<span class="hljs-number">1</span>];

        <span class="hljs-keyword">if</span> (<span class="hljs-built_in">Array</span>.isArray(x)) {

            c[<span class="hljs-number">0</span>] = addStrings(myX, x[<span class="hljs-number">0</span>]);
            c[<span class="hljs-number">1</span>] = addStrings(myY, x[<span class="hljs-number">1</span>]);
        }
        <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (isa_obj(x)) {

            <span class="hljs-keyword">if</span> (xto(x.x, x.y)) {

                c[<span class="hljs-number">0</span>] = addStrings(myX, xtGet(x.x, <span class="hljs-number">0</span>));
                c[<span class="hljs-number">1</span>] = addStrings(myY, xtGet(x.y, <span class="hljs-number">0</span>));
            }
            <span class="hljs-keyword">else</span> {

                c[<span class="hljs-number">0</span>] = addStrings(myX, xtGet(x.width, x.w, <span class="hljs-number">0</span>));
                c[<span class="hljs-number">1</span>] = addStrings(myY, xtGet(x.height, x.h, <span class="hljs-number">0</span>));
            }
        }
        <span class="hljs-keyword">else</span> {

            c[<span class="hljs-number">0</span>] = addStrings(myX, x);
            c[<span class="hljs-number">1</span>] = addStrings(myY, y);
        }
    };</pre></div></div>
            
        </li>
        
        
        <li id="section-133">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-133">&#182;</a>
              </div>
              <p>This function gets called as part of every display cycle iteration, meaning that if an attribute is set to a non-zero value in the <strong>delta</strong> attribute object then those <strong>delta animations</strong> will start playing immediately.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    P.updateByDelta = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{

        <span class="hljs-keyword">this</span>.setDelta(<span class="hljs-keyword">this</span>.delta);

        <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>;
    };</pre></div></div>
            
        </li>
        
        
        <li id="section-134">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-134">&#182;</a>
              </div>
              <p>The opposite action to ‘updateByDelta’; values in the <strong>delta</strong> attribute object will be subtracted from the current value for that Scrawl-canvas object.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    P.reverseByDelta = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{

        <span class="hljs-keyword">let</span> temp = {};
        
        <span class="hljs-built_in">Object</span>.entries(<span class="hljs-keyword">this</span>.delta).forEach(<span class="hljs-function">(<span class="hljs-params">[key, val]</span>) =&gt;</span> {

            <span class="hljs-keyword">if</span> (val.substring) val = -(<span class="hljs-built_in">parseFloat</span>(val)) + <span class="hljs-string">'%'</span>;
            <span class="hljs-keyword">else</span> val = -val;

            temp[key] = val;
        });

        <span class="hljs-keyword">this</span>.setDelta(temp);

        <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>;
    };</pre></div></div>
            
        </li>
        
        
        <li id="section-135">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-135">&#182;</a>
              </div>
              <p>TODO - documentation</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    P.setDeltaValues = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">items = {}</span>) </span>{

        <span class="hljs-keyword">let</span> delta = <span class="hljs-keyword">this</span>.delta, 
            oldVal, action;

        <span class="hljs-built_in">Object</span>.entries(items).forEach(<span class="hljs-function">(<span class="hljs-params">[key, requirement]</span>) =&gt;</span> {

            <span class="hljs-keyword">if</span> (xt(delta[key])) {</pre></div></div>
            
        </li>
        
        
        <li id="section-136">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-136">&#182;</a>
              </div>
              <p>TODO - the idea is that we can do things like ‘add:1’, ‘subtract:5’, ‘multiply:6’, ‘divide:3.4’, etc</p>
<ul>
<li>for this to work, we need to do do work here to split the val string on the ‘:’</li>
<li>for now, just do reverse and zero numbers</li>
</ul>

            </div>
            
            <div class="content"><div class='highlight'><pre>
                action = requirement;

                oldVal = delta[key];

                <span class="hljs-keyword">switch</span> (action) {

                    <span class="hljs-keyword">case</span> <span class="hljs-string">'reverse'</span> :
                        <span class="hljs-keyword">if</span> (oldVal.toFixed) delta[key] = -oldVal;</pre></div></div>
            
        </li>
        
        
        <li id="section-137">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-137">&#182;</a>
              </div>
              <p>TODO: reverse String% (and em, etc) values</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                        <span class="hljs-keyword">break</span>;

                    <span class="hljs-keyword">case</span> <span class="hljs-string">'zero'</span> :
                        <span class="hljs-keyword">if</span> (oldVal.toFixed) delta[key] = <span class="hljs-number">0</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-138">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-138">&#182;</a>
              </div>
              <p>TODO: zero String% (and em, etc) values</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                        <span class="hljs-keyword">break</span>;

                    <span class="hljs-keyword">case</span> <span class="hljs-string">'add'</span> :
                        <span class="hljs-keyword">break</span>;

                    <span class="hljs-keyword">case</span> <span class="hljs-string">'subtract'</span> :
                        <span class="hljs-keyword">break</span>;

                    <span class="hljs-keyword">case</span> <span class="hljs-string">'multiply'</span> :
                        <span class="hljs-keyword">break</span>;

                    <span class="hljs-keyword">case</span> <span class="hljs-string">'divide'</span> :
                        <span class="hljs-keyword">break</span>;
                }
            }
        })
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>;
    };</pre></div></div>
            
        </li>
        
        
        <li id="section-139">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-139">&#182;</a>
              </div>
              <p>Internal function - return the ‘host’ object. Hosts can be various things, for instance:</p>

            </div>
            
        </li>
        
        
        <li id="section-140">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-140">&#182;</a>
              </div>
              <ul>
<li>Element artefacts will have a stack artefact as its host</li>
<li>Stack and Canvas artifacts can also have a Stack host</li>
<li>Cells will have either a canvas, or another cell, as their host</li>
<li>Entity artefacts will use a Cell as their host</li>
</ul>

            </div>
            
        </li>
        
        
        <li id="section-141">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-141">&#182;</a>
              </div>
              <p>All of the above can exist without a host (though in many cases this means they don’t do much). Stack and Canvas artefacts will often be unhosted, sitting as root artefacts in the web page DOM</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    P.getHost = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{

        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.currentHost) <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.currentHost;
        <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.host) {

            <span class="hljs-keyword">let</span> host = artefact[<span class="hljs-keyword">this</span>.host];

            <span class="hljs-keyword">if</span> (host) {

                <span class="hljs-keyword">this</span>.currentHost = host;
                <span class="hljs-keyword">this</span>.dirtyHost = <span class="hljs-literal">true</span>;
                <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.currentHost;
            }
        }
        <span class="hljs-keyword">return</span> currentCorePosition;
    };</pre></div></div>
            
        </li>
        
        
        <li id="section-142">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-142">&#182;</a>
              </div>
              <p>The <strong>here</strong> parameter is owned by Canvas, Stack and (if enabled) Element artefacts and is set on them by calling the core/userInteraction.js updateUiSubscribedElement() function - thus not defined or updated by the artefact itself.</p>

            </div>
            
        </li>
        
        
        <li id="section-143">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-143">&#182;</a>
              </div>
              <pre><code>here {x, y, w, h, normX, normY, offsetX, offsetY, type, active}</code></pre>
            </div>
            
        </li>
        
        
        <li id="section-144">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-144">&#182;</a>
              </div>
              <p>Cell assets also have a <strong>here</strong> parameter, defined and updated by themselves with reference to their current Canvas host</p>

            </div>
            
        </li>
        
        
        <li id="section-145">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-145">&#182;</a>
              </div>
              <pre><code>here {x, y, w, h, xRatio, yRatio}</code></pre>
            </div>
            
        </li>
        
        
        <li id="section-146">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-146">&#182;</a>
              </div>
              <p>NOTE: Canvas, Stack, Element (if enabled) and Cell all need to create their .here attribute immediately after they first calculate their currentDimensions Coordinate, which needs to happen as part of the constructor!</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    P.getHere = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{

        <span class="hljs-keyword">let</span> host = <span class="hljs-keyword">this</span>.getHost();

        <span class="hljs-keyword">if</span> (host) {

            <span class="hljs-keyword">if</span> (host.here) <span class="hljs-keyword">return</span> host.here;
            <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (host.currentDimensions) {

                <span class="hljs-keyword">let</span> dims = host.currentDimensions;

                <span class="hljs-keyword">if</span> (dims) {

                    <span class="hljs-keyword">return</span> {
                        <span class="hljs-attr">w</span>: dims[<span class="hljs-number">0</span>],
                        <span class="hljs-attr">h</span>: dims[<span class="hljs-number">1</span>]
                    }
                }
            }
        }
        <span class="hljs-keyword">return</span> currentCorePosition;
    };</pre></div></div>
            
        </li>
        
        
        <li id="section-147">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-147">&#182;</a>
              </div>
              <p>Helper function used by cleanStart, cleanHandle and cleanOffset functions</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    P.cleanPosition = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">current, source, dimensions</span>) </span>{

        <span class="hljs-keyword">let</span> val, dim;

        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">2</span>; i++) {

            val = source[i];
            dim = dimensions[i];

            <span class="hljs-keyword">if</span> (val.toFixed) current[i] = val;
            <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (val === <span class="hljs-string">'left'</span> || val === <span class="hljs-string">'top'</span>) current[i] = <span class="hljs-number">0</span>;
            <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (val === <span class="hljs-string">'right'</span> || val === <span class="hljs-string">'bottom'</span>) current[i] = dim;
            <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (val === <span class="hljs-string">'center'</span>) current[i] = dim / <span class="hljs-number">2</span>;
            <span class="hljs-keyword">else</span> current[i] = (<span class="hljs-built_in">parseFloat</span>(val) / <span class="hljs-number">100</span>) * dim;
        }
    };</pre></div></div>
            
        </li>
        
        
        <li id="section-148">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-148">&#182;</a>
              </div>
              <p>Set the artefact’s currentScale value. Scaling has widespread effects across a range of the artefact’s other positional and display attributes. Artefacts may use other artefacts to set their own scale values (mimicking)</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    P.cleanScale = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{

        <span class="hljs-keyword">this</span>.dirtyScale = <span class="hljs-literal">false</span>;

        <span class="hljs-keyword">let</span> scale,
            myscale = <span class="hljs-keyword">this</span>.scale,
            mimic = <span class="hljs-keyword">this</span>.mimic,
            oldScale = <span class="hljs-keyword">this</span>.currentScale;

        <span class="hljs-keyword">if</span>(mimic &amp;&amp; <span class="hljs-keyword">this</span>.useMimicScale) {

            <span class="hljs-keyword">if</span> (mimic.currentScale) {

                scale = mimic.currentScale;

                <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.addOwnScaleToMimic) scale += myscale;
            }
            <span class="hljs-keyword">else</span> {

                scale = myscale;
                <span class="hljs-keyword">this</span>.dirtyMimicScale = <span class="hljs-literal">true</span>;
            }
        }
        <span class="hljs-keyword">else</span> scale = myscale;

        <span class="hljs-keyword">this</span>.currentScale = scale;

        <span class="hljs-keyword">this</span>.dirtyDimensions = <span class="hljs-literal">true</span>;
        <span class="hljs-keyword">this</span>.dirtyHandle = <span class="hljs-literal">true</span>;

        <span class="hljs-keyword">if</span> (oldScale !== <span class="hljs-keyword">this</span>.currentScale) <span class="hljs-keyword">this</span>.dirtyPositionSubscribers = <span class="hljs-literal">true</span>;

        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.mimicked &amp;&amp; <span class="hljs-keyword">this</span>.mimicked.length) <span class="hljs-keyword">this</span>.dirtyMimicScale = <span class="hljs-literal">true</span>;
    };</pre></div></div>
            
        </li>
        
        
        <li id="section-149">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-149">&#182;</a>
              </div>
              <p>Set the artefact’s currentDimensions values, depending on: </p>

            </div>
            
        </li>
        
        
        <li id="section-150">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-150">&#182;</a>
              </div>
              <ul>
<li>Their width and height - if these are set to absolute (Number) values</li>
<li>Their host’s width and height - if their own dimensions are set to %String values</li>
<li>Another artefact’s width and height - if they are mimicking that artefact’s dimensions</li>
</ul>

            </div>
            
        </li>
        
        
        <li id="section-151">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-151">&#182;</a>
              </div>
              <p>Dimensions DO scale - but scaling happens elsewhere</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    P.cleanDimensions = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{

        <span class="hljs-keyword">this</span>.dirtyDimensions = <span class="hljs-literal">false</span>;

        <span class="hljs-keyword">let</span> host = <span class="hljs-keyword">this</span>.getHost(),
            dims = <span class="hljs-keyword">this</span>.dimensions,
            curDims = <span class="hljs-keyword">this</span>.currentDimensions;

        <span class="hljs-keyword">if</span> (host) {

            <span class="hljs-keyword">let</span> hostDims = (host.currentDimensions) ? host.currentDimensions : [host.w, host.h];

            <span class="hljs-keyword">let</span> [w, h] = dims,
                oldW = curDims[<span class="hljs-number">0</span>],
                oldH = curDims[<span class="hljs-number">1</span>];

            <span class="hljs-keyword">if</span> (w.substring) w = (<span class="hljs-built_in">parseFloat</span>(w) / <span class="hljs-number">100</span>) * hostDims[<span class="hljs-number">0</span>];

            <span class="hljs-keyword">if</span> (h.substring) {

                <span class="hljs-keyword">if</span> (h === <span class="hljs-string">'auto'</span>) h = <span class="hljs-number">0</span>;
                <span class="hljs-keyword">else</span> h = (<span class="hljs-built_in">parseFloat</span>(h) / <span class="hljs-number">100</span>) * hostDims[<span class="hljs-number">1</span>];
            }

            <span class="hljs-keyword">let</span> mimic = <span class="hljs-keyword">this</span>.mimic,
                mimicDims;

            <span class="hljs-keyword">if</span> (mimic &amp;&amp; mimic.name &amp;&amp; <span class="hljs-keyword">this</span>.useMimicDimensions) mimicDims = mimic.currentDimensions;

            <span class="hljs-keyword">if</span> (mimicDims) {

                curDims[<span class="hljs-number">0</span>] = (<span class="hljs-keyword">this</span>.addOwnDimensionsToMimic) ? mimicDims[<span class="hljs-number">0</span>] + w : mimicDims[<span class="hljs-number">0</span>];
                curDims[<span class="hljs-number">1</span>] = (<span class="hljs-keyword">this</span>.addOwnDimensionsToMimic) ? mimicDims[<span class="hljs-number">1</span>] + h : mimicDims[<span class="hljs-number">1</span>];
            }
            <span class="hljs-keyword">else</span> {

                curDims[<span class="hljs-number">0</span>] = w;
                curDims[<span class="hljs-number">1</span>] = h;
            }

            <span class="hljs-keyword">this</span>.cleanDimensionsAdditionalActions();

            <span class="hljs-keyword">this</span>.dirtyStart = <span class="hljs-literal">true</span>;
            <span class="hljs-keyword">this</span>.dirtyHandle = <span class="hljs-literal">true</span>;
            <span class="hljs-keyword">this</span>.dirtyOffset = <span class="hljs-literal">true</span>;

            <span class="hljs-keyword">if</span> (oldW !== curDims[<span class="hljs-number">0</span>] || oldH !== curDims[<span class="hljs-number">1</span>]) <span class="hljs-keyword">this</span>.dirtyPositionSubscribers = <span class="hljs-literal">true</span>;

            <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.mimicked &amp;&amp; <span class="hljs-keyword">this</span>.mimicked.length) <span class="hljs-keyword">this</span>.dirtyMimicDimensions = <span class="hljs-literal">true</span>;
        }
        <span class="hljs-keyword">else</span> <span class="hljs-keyword">this</span>.dirtyDimensions = <span class="hljs-literal">true</span>;
    };</pre></div></div>
            
        </li>
        
        
        <li id="section-152">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-152">&#182;</a>
              </div>
              <p>This function gets overwritten by various (but not all) relevant factory files</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    P.cleanDimensionsAdditionalActions = defaultNonReturnFunction;</pre></div></div>
            
        </li>
        
        
        <li id="section-153">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-153">&#182;</a>
              </div>
              <p>Clean function for <strong>lock</strong> array - unsets the dirtyLock flag; sets the dirtyStart and dirtyHandle flags</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    P.cleanLock = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{

        <span class="hljs-keyword">this</span>.dirtyLock = <span class="hljs-literal">false</span>;

        <span class="hljs-keyword">this</span>.dirtyStart = <span class="hljs-literal">true</span>;
        <span class="hljs-keyword">this</span>.dirtyHandle = <span class="hljs-literal">true</span>;
    };</pre></div></div>
            
        </li>
        
        
        <li id="section-154">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-154">&#182;</a>
              </div>
              <p>Clean function for <strong>start</strong> arrays - if local ‘here’ tests pass, invokes cleanPosition() and unsets the dirtyStart flag</p>

            </div>
            
        </li>
        
        
        <li id="section-155">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-155">&#182;</a>
              </div>
              <p>Start values do NOT scale</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    P.cleanStart = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{

        <span class="hljs-keyword">this</span>.dirtyStart = <span class="hljs-literal">false</span>;

        <span class="hljs-keyword">let</span> here = <span class="hljs-keyword">this</span>.getHere();

        <span class="hljs-keyword">if</span> (xt(here)) {

            <span class="hljs-keyword">if</span> (xta(here.w, here.h)) {

                <span class="hljs-keyword">this</span>.cleanPosition(<span class="hljs-keyword">this</span>.currentStart, <span class="hljs-keyword">this</span>.start, [here.w, here.h]);
                <span class="hljs-keyword">this</span>.dirtyStampPositions = <span class="hljs-literal">true</span>;
            }
            <span class="hljs-keyword">else</span> <span class="hljs-keyword">this</span>.dirtyStart = <span class="hljs-literal">true</span>;
        }
        <span class="hljs-keyword">else</span> <span class="hljs-keyword">this</span>.dirtyStart = <span class="hljs-literal">true</span>;
    };</pre></div></div>
            
        </li>
        
        
        <li id="section-156">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-156">&#182;</a>
              </div>
              <p>Clean function for <strong>offset</strong> arrays - if local ‘here’ tests pass, invokes cleanPosition() and unsets the dirtyOffset flag; sets the dirtyStampPositions and, if needed, the dirtyMimicOffset flags</p>

            </div>
            
        </li>
        
        
        <li id="section-157">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-157">&#182;</a>
              </div>
              <p>Offset values do NOT scale</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    P.cleanOffset = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{

        <span class="hljs-keyword">this</span>.dirtyOffset = <span class="hljs-literal">false</span>;

        <span class="hljs-keyword">let</span> here = <span class="hljs-keyword">this</span>.getHere();

        <span class="hljs-keyword">if</span> (xt(here)) {

            <span class="hljs-keyword">if</span> (xta(here.w, here.h)) {

                <span class="hljs-keyword">this</span>.cleanPosition(<span class="hljs-keyword">this</span>.currentOffset, <span class="hljs-keyword">this</span>.offset, [here.w, here.h]);
                <span class="hljs-keyword">this</span>.dirtyStampPositions = <span class="hljs-literal">true</span>;

                <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.mimicked &amp;&amp; <span class="hljs-keyword">this</span>.mimicked.length) <span class="hljs-keyword">this</span>.dirtyMimicOffset = <span class="hljs-literal">true</span>;
            }
            <span class="hljs-keyword">else</span> <span class="hljs-keyword">this</span>.dirtyOffset = <span class="hljs-literal">true</span>;
        }
        <span class="hljs-keyword">else</span> <span class="hljs-keyword">this</span>.dirtyOffset = <span class="hljs-literal">true</span>;
    };</pre></div></div>
            
        </li>
        
        
        <li id="section-158">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-158">&#182;</a>
              </div>
              <p>Clean function for <strong>handle</strong> arrays - invokes cleanPosition() and unsets the dirtyHandle flag; sets the dirtyStampHandlePositions and, if needed, the dirtyMimicHandle flags</p>

            </div>
            
        </li>
        
        
        <li id="section-159">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-159">&#182;</a>
              </div>
              <p>Handle values DO scale - but scaling happens elsewhere:</p>

            </div>
            
        </li>
        
        
        <li id="section-160">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-160">&#182;</a>
              </div>
              <ul>
<li>DOM elements (stack, element, canvas) manage handle offset in their CSS transform string</li>
<li>Entities manage it as part of each entity’s ‘path’ calculation</li>
</ul>

            </div>
            
            <div class="content"><div class='highlight'><pre>    P.cleanHandle = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{

        <span class="hljs-keyword">this</span>.dirtyHandle = <span class="hljs-literal">false</span>;

        <span class="hljs-keyword">let</span> current = <span class="hljs-keyword">this</span>.currentHandle;

        <span class="hljs-keyword">this</span>.cleanPosition(current, <span class="hljs-keyword">this</span>.handle, <span class="hljs-keyword">this</span>.currentDimensions);
        <span class="hljs-keyword">this</span>.dirtyStampHandlePositions = <span class="hljs-literal">true</span>;

        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.mimicked &amp;&amp; <span class="hljs-keyword">this</span>.mimicked.length) <span class="hljs-keyword">this</span>.dirtyMimicHandle = <span class="hljs-literal">true</span>;
    };</pre></div></div>
            
        </li>
        
        
        <li id="section-161">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-161">&#182;</a>
              </div>
              <p>Clean function for the various <strong>rotation</strong> attributes (roll, pitch, yaw). This function only handles <strong>currentRoll</strong> recalculations; the function is overridden in the mixin/dom.js module to deal with DOM element 3D rotations.</p>

            </div>
            
        </li>
        
        
        <li id="section-162">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-162">&#182;</a>
              </div>
              <p>Rotation calculations vary according to the object’s ‘lockTo’, ‘pivot’, ‘mimic’ and ‘path’ attributes, as an artefact can be set to use other artefacts’ rotation values instead of its own values.</p>

            </div>
            
        </li>
        
        
        <li id="section-163">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-163">&#182;</a>
              </div>
              <p>Artefacts to which this artefact has subscribed for pivot and mimic purposes will set dirty flags (dirtyPivotRotation, dirtyMimicRotation) in this artefact when their rotation values change; these flags will be unset if the appropriate local tests pass.</p>

            </div>
            
        </li>
        
        
        <li id="section-164">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-164">&#182;</a>
              </div>
              <p>If this artefact’s rotation values change as a result of cleaning, it will set the dirtyPositionSubscribers flag so the update can cascade through to other artefacts using it as a pivot or mimic </p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    P.cleanRotation = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{

        <span class="hljs-keyword">this</span>.dirtyRotation = <span class="hljs-literal">false</span>;

        <span class="hljs-keyword">let</span> roll,
            myroll = <span class="hljs-keyword">this</span>.roll,
            oldRoll = <span class="hljs-keyword">this</span>.currentRotation,
            path = <span class="hljs-keyword">this</span>.path,
            mimic = <span class="hljs-keyword">this</span>.mimic,
            pivot = <span class="hljs-keyword">this</span>.pivot,
            lock = <span class="hljs-keyword">this</span>.lockTo;

        <span class="hljs-keyword">if</span> (path &amp;&amp; lock.indexOf(<span class="hljs-string">'path'</span>) &gt;= <span class="hljs-number">0</span>) {

            roll = myroll;

            <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.addPathRotation) {

                <span class="hljs-keyword">let</span> pathData = <span class="hljs-keyword">this</span>.getPathData();

                <span class="hljs-keyword">if</span> (pathData) roll += pathData.angle;
            }

        }
        <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (mimic &amp;&amp; <span class="hljs-keyword">this</span>.useMimicRotation &amp;&amp; lock.indexOf(<span class="hljs-string">'mimic'</span>) &gt;= <span class="hljs-number">0</span>) {

            <span class="hljs-keyword">if</span> (xt(mimic.currentRotation)) {

                roll = mimic.currentRotation;

                <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.addOwnRotationToMimic) roll += myroll;
            }
            <span class="hljs-keyword">else</span> <span class="hljs-keyword">this</span>.dirtyMimicRotation = <span class="hljs-literal">true</span>;
        } 
        <span class="hljs-keyword">else</span> {

            roll = myroll;

            <span class="hljs-keyword">if</span> (pivot &amp;&amp; <span class="hljs-keyword">this</span>.addPivotRotation &amp;&amp; lock.indexOf(<span class="hljs-string">'pivot'</span>) &gt;= <span class="hljs-number">0</span>) {

                <span class="hljs-keyword">if</span> (xt(pivot.currentRotation)) roll += pivot.currentRotation;
                <span class="hljs-keyword">else</span> <span class="hljs-keyword">this</span>.dirtyPivotRotation = <span class="hljs-literal">true</span>;
            }
            
        }

        <span class="hljs-keyword">this</span>.currentRotation = roll;

        <span class="hljs-keyword">if</span> (roll !== oldRoll) <span class="hljs-keyword">this</span>.dirtyPositionSubscribers = <span class="hljs-literal">true</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-165">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-165">&#182;</a>
              </div>
              <p>If this artefact is being mimicked by other artefacts, it needs to check its rotation values on every iteration of the display cycle</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.mimicked &amp;&amp; <span class="hljs-keyword">this</span>.mimicked.length) <span class="hljs-keyword">this</span>.dirtyMimicRotation = <span class="hljs-literal">true</span>;
    };</pre></div></div>
            
        </li>
        
        
        <li id="section-166">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-166">&#182;</a>
              </div>
              <p><strong>stampPosition</strong> represents the combination of start and offset positions to determine where the top left corner of any artefact should be placed. It represents the real <strong>rotation-reflection point</strong> around which the artefact will display.</p>

            </div>
            
        </li>
        
        
        <li id="section-167">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-167">&#182;</a>
              </div>
              <p>Note that the calculation does not take into account <em>handle</em> values, which get applied after the canvas grid is setup for the stamp operation</p>

            </div>
            
        </li>
        
        
        <li id="section-168">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-168">&#182;</a>
              </div>
              <p>DOM artefacts will also take handle values into consideration after the fact</p>

            </div>
            
        </li>
        
        
        <li id="section-169">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-169">&#182;</a>
              </div>
              <p>The X and Y coordinates are handled separately, and are dependant on the the lock set for each in the ‘lockTo’ array. Lock values can be: ‘start’ (the default for each coordinate), ‘mouse’ (to lock the coordinate to the mouse cursor), and ‘pivot’, ‘path’ or ‘mimic’ to use other artefacts for positioning.</p>

            </div>
            
        </li>
        
        
        <li id="section-170">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-170">&#182;</a>
              </div>
              <p>Artefacts that are currently in ‘drag’ mode (whose lock values are temporarily overridden) also need to take into account the drag offset values.</p>

            </div>
            
        </li>
        
        
        <li id="section-171">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-171">&#182;</a>
              </div>
              <p>Rotation and flip attributes are handled separately, alongside handle values, as part of the actual stamp operation.</p>

            </div>
            
        </li>
        
        
        <li id="section-172">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-172">&#182;</a>
              </div>
              <p>If either currentStampPosition coordinate changes as a result of this function, the dirtyPositionSubscribers flag will be set so that the change can be cascaded to any artefacts using this one as a pivot or mimic for their start or offset values.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    P.cleanStampPositions = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{

        <span class="hljs-keyword">this</span>.dirtyStampPositions = <span class="hljs-literal">false</span>;

        <span class="hljs-keyword">let</span> stamp = <span class="hljs-keyword">this</span>.currentStampPosition,
            start = <span class="hljs-keyword">this</span>.currentStart,
            oldX = stamp[<span class="hljs-number">0</span>],
            oldY = stamp[<span class="hljs-number">1</span>];

        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.noPositionDependencies) {

            stamp[<span class="hljs-number">0</span>] = start[<span class="hljs-number">0</span>];
            stamp[<span class="hljs-number">1</span>] = start[<span class="hljs-number">1</span>];
        }
        <span class="hljs-keyword">else</span> {

            <span class="hljs-keyword">let</span> lockArray = <span class="hljs-keyword">this</span>.lockTo,
                localLockArray = [],
                lock, i, coord, here, pathData,
                hereFlag = <span class="hljs-literal">false</span>,
                stamp = <span class="hljs-keyword">this</span>.currentStampPosition,
                oldX = stamp[<span class="hljs-number">0</span>],
                oldY = stamp[<span class="hljs-number">1</span>],
                offset = <span class="hljs-keyword">this</span>.currentOffset,
                isBeingDragged = <span class="hljs-keyword">this</span>.isBeingDragged,
                drag = <span class="hljs-keyword">this</span>.currentDragOffset,
                cache = <span class="hljs-keyword">this</span>.currentStartCache,
                pivot = <span class="hljs-keyword">this</span>.pivot,
                path = <span class="hljs-keyword">this</span>.path,
                mimic = <span class="hljs-keyword">this</span>.mimic;

            <span class="hljs-keyword">if</span> (isBeingDragged) {

                localLockArray = [<span class="hljs-string">'mouse'</span>, <span class="hljs-string">'mouse'</span>];
                hereFlag = <span class="hljs-literal">true</span>;

                <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.getCornerCoordinate) <span class="hljs-keyword">this</span>.cleanPathObject();
            }
            <span class="hljs-keyword">else</span> {</pre></div></div>
            
        </li>
        
        
        <li id="section-173">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-173">&#182;</a>
              </div>
              <p>x and y coordinates can have different lockTo values</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                <span class="hljs-keyword">for</span> (i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">2</span>; i++) {

                    lock = lockArray[i];

                    <span class="hljs-keyword">if</span> (lock === <span class="hljs-string">'pivot'</span> &amp;&amp; !pivot) lock = <span class="hljs-string">'start'</span>;
                    <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (lock === <span class="hljs-string">'path'</span> &amp;&amp; !path) lock = <span class="hljs-string">'start'</span>;
                    <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (lock === <span class="hljs-string">'mimic'</span> &amp;&amp; !mimic) lock = <span class="hljs-string">'start'</span>;

                    <span class="hljs-keyword">if</span> (lock === <span class="hljs-string">'mouse'</span>) hereFlag = <span class="hljs-literal">true</span>;

                    localLockArray[i] = lock;
                }
            }

            <span class="hljs-keyword">if</span> (hereFlag) here = <span class="hljs-keyword">this</span>.getHere();</pre></div></div>
            
        </li>
        
        
        <li id="section-174">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-174">&#182;</a>
              </div>
              <p>We loop twice - once for each coordinate: x is calculated on the first loop (i === 0); y on the second (i === 1)</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            <span class="hljs-keyword">for</span> (i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">2</span>; i++) {

                lock = localLockArray[i];

                <span class="hljs-keyword">switch</span> (lock) {

                    <span class="hljs-keyword">case</span> <span class="hljs-string">'pivot'</span> :

                        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.pivotCorner &amp;&amp; pivot.getCornerCoordinate) {

                            coord = pivot.getCornerCoordinate(<span class="hljs-keyword">this</span>.pivotCorner, (i) ? <span class="hljs-string">'y'</span> : <span class="hljs-string">'x'</span>);
                        }
                        <span class="hljs-keyword">else</span> coord = pivot.currentStampPosition[i];

                        <span class="hljs-keyword">if</span> (!<span class="hljs-keyword">this</span>.addPivotOffset) coord -= pivot.currentOffset[i];

                        coord += offset[i];

                        <span class="hljs-keyword">break</span>;

                    <span class="hljs-keyword">case</span> <span class="hljs-string">'path'</span> :
                        pathData = <span class="hljs-keyword">this</span>.getPathData();

                        <span class="hljs-keyword">if</span> (pathData) {

                            coord = (i) ? pathData.y : pathData.x;

                            <span class="hljs-keyword">if</span> (!<span class="hljs-keyword">this</span>.addPathOffset) coord -= path.currentOffset[i];
                        }
                        <span class="hljs-keyword">else</span> coord = start[i] + offset[i];

                        <span class="hljs-keyword">break</span>;

                    <span class="hljs-keyword">case</span> <span class="hljs-string">'mimic'</span> :
                        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.useMimicStart || <span class="hljs-keyword">this</span>.useMimicOffset) {

                            coord = mimic.currentStampPosition[i];

                            <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.useMimicStart &amp;&amp; <span class="hljs-keyword">this</span>.addOwnStartToMimic) coord += start[i];
                            <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.useMimicOffset &amp;&amp; <span class="hljs-keyword">this</span>.addOwnOffsetToMimic) coord += offset[i];

                            <span class="hljs-keyword">if</span> (!<span class="hljs-keyword">this</span>.useMimicStart) coord = coord - mimic.currentStart[i] + start[i];
                            <span class="hljs-keyword">if</span> (!<span class="hljs-keyword">this</span>.useMimicOffset) coord = coord - mimic.currentOffset[i] + offset[i];
                        }
                        <span class="hljs-keyword">else</span> coord = start[i] + offset[i];

                        <span class="hljs-keyword">break</span>;

                    <span class="hljs-keyword">case</span> <span class="hljs-string">'mouse'</span> :
                        coord = (i === <span class="hljs-number">0</span>) ? here.x : here.y;

                        <span class="hljs-keyword">if</span> (isBeingDragged) {

                            cache[i] = coord;
                            coord += drag[i];
                            <span class="hljs-keyword">this</span>.dirtyCollision = <span class="hljs-literal">true</span>;
                        }
                        coord += offset[i];

                        <span class="hljs-keyword">break</span>;

                    <span class="hljs-keyword">default</span> :
                        coord = start[i] + offset[i];
                }
                stamp[i] = coord;
            }
        }
        <span class="hljs-keyword">this</span>.cleanStampPositionsAdditionalActions()

        <span class="hljs-keyword">if</span> (oldX !== stamp[<span class="hljs-number">0</span>] || oldY !== stamp[<span class="hljs-number">1</span>]) <span class="hljs-keyword">this</span>.dirtyPositionSubscribers = <span class="hljs-literal">true</span>;
    };</pre></div></div>
            
        </li>
        
        
        <li id="section-175">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-175">&#182;</a>
              </div>
              <p>Some artefact types need to perform additional calculations to finalize the values in the currentStampPosition array. Those factory functions will overwrite this function as required.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    P.cleanStampPositionsAdditionalActions = defaultNonReturnFunction;</pre></div></div>
            
        </li>
        
        
        <li id="section-176">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-176">&#182;</a>
              </div>
              <p>An artefact’s currentHandle values get applied after the canvas grid has been set up for the stamp operation (by translating the grid to the currentStampPosition coordinates). </p>

            </div>
            
        </li>
        
        
        <li id="section-177">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-177">&#182;</a>
              </div>
              <ul>
<li>DOM elements (stack, element, canvas) include handle values as part of their CSS transform string</li>
<li>Entities include handle values as part of their ‘path’ calculation</li>
</ul>

            </div>
            
        </li>
        
        
        <li id="section-178">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-178">&#182;</a>
              </div>
              <p>Handle values DO scale, but not here; that happens when the transform/path is recalculated</p>

            </div>
            
        </li>
        
        
        <li id="section-179">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-179">&#182;</a>
              </div>
              <p>This function takes into account whether the artefact is pivoting on, or mimicking, another artefact.</p>

            </div>
            
        </li>
        
        
        <li id="section-180">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-180">&#182;</a>
              </div>
              <p>If either currentStampHandlePosition coordinate changes as a result of this function, the dirtyPositionSubscribers flag will be set so that the change can be cascaded to any artefacts using this one as a pivot or mimic for their start, handle or offset values.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    P.cleanStampHandlePositions = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{

        <span class="hljs-keyword">this</span>.dirtyStampHandlePositions = <span class="hljs-literal">false</span>;

        <span class="hljs-keyword">let</span> stampHandle = <span class="hljs-keyword">this</span>.currentStampHandlePosition,
            handle = <span class="hljs-keyword">this</span>.currentHandle,
            oldX = stampHandle[<span class="hljs-number">0</span>],
            oldY = stampHandle[<span class="hljs-number">1</span>];

        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.noPositionDependencies) {

            stampHandle[<span class="hljs-number">0</span>] = handle[<span class="hljs-number">0</span>];
            stampHandle[<span class="hljs-number">1</span>] = handle[<span class="hljs-number">1</span>];
        }
        <span class="hljs-keyword">else</span> {

            <span class="hljs-keyword">let</span> lockArray = <span class="hljs-keyword">this</span>.lockTo,
                lock, i, coord, here, myscale,
                pivot = <span class="hljs-keyword">this</span>.pivot,
                path = <span class="hljs-keyword">this</span>.path,
                mimic = <span class="hljs-keyword">this</span>.mimic;</pre></div></div>
            
        </li>
        
        
        <li id="section-181">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-181">&#182;</a>
              </div>
              <p>We loop twice - once for each coordinate: x is calculated on the first loop (i === 0); y on the second (i === 1)</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            <span class="hljs-keyword">for</span> (i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">2</span>; i++) {

                lock = lockArray[i];

                <span class="hljs-keyword">if</span> (lock === <span class="hljs-string">'pivot'</span> &amp;&amp; !pivot) lock = <span class="hljs-string">'start'</span>;
                <span class="hljs-keyword">if</span> (lock === <span class="hljs-string">'path'</span> &amp;&amp; !path) lock = <span class="hljs-string">'start'</span>;
                <span class="hljs-keyword">if</span> (lock === <span class="hljs-string">'mimic'</span> &amp;&amp; !mimic) lock = <span class="hljs-string">'start'</span>;

                coord = handle[i];

                <span class="hljs-keyword">switch</span> (lock) {

                    <span class="hljs-keyword">case</span> <span class="hljs-string">'pivot'</span> :
                        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.addPivotHandle) coord += pivot.currentHandle[i];
                        <span class="hljs-keyword">break</span>;

                    <span class="hljs-keyword">case</span> <span class="hljs-string">'path'</span> :
                        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.addPathHandle) coord += path.currentHandle[i];
                        <span class="hljs-keyword">break</span>;

                    <span class="hljs-keyword">case</span> <span class="hljs-string">'mimic'</span> :
                        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.useMimicHandle) {

                            coord = mimic.currentHandle[i];

                            <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.addOwnHandleToMimic) coord += handle[i];
                        }
                        <span class="hljs-keyword">break</span>;
                }
                stampHandle[i] = coord;
            }
        }</pre></div></div>
            
        </li>
        
        
        <li id="section-182">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-182">&#182;</a>
              </div>
              <p>At the moment only Shape type artefacts require additional calculations to complete the cleanHandle functionality. If this changes, then we should amend code so that we pass code flow to a cleanStampHandlePositionsAdditionalActions function, then move this ‘if’ statement into an override of that function in the mixin/shape.js module file</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.type === <span class="hljs-string">'Shape'</span>) {

            <span class="hljs-keyword">let</span> box = <span class="hljs-keyword">this</span>.localBox;
            stampHandle[<span class="hljs-number">0</span>] += box[<span class="hljs-number">0</span>];
            stampHandle[<span class="hljs-number">1</span>] += box[<span class="hljs-number">1</span>];
        }

        <span class="hljs-keyword">if</span> (oldX !== stampHandle[<span class="hljs-number">0</span>] || oldY !== stampHandle[<span class="hljs-number">1</span>]) <span class="hljs-keyword">this</span>.dirtyPositionSubscribers = <span class="hljs-literal">true</span>;

        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.domElement &amp;&amp; <span class="hljs-keyword">this</span>.collides) <span class="hljs-keyword">this</span>.dirtyPathObject = <span class="hljs-literal">true</span>;
    };</pre></div></div>
            
        </li>
        
        
        <li id="section-183">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-183">&#182;</a>
              </div>
              <p>TODO - documentation</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    P.cleanCollisionData = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{

        <span class="hljs-keyword">if</span> (!<span class="hljs-keyword">this</span>.currentCollisionRadius) <span class="hljs-keyword">this</span>.currentCollisionRadius = <span class="hljs-number">0</span>;
        <span class="hljs-keyword">if</span> (!<span class="hljs-keyword">this</span>.currentSensors) <span class="hljs-keyword">this</span>.currentSensors = [];

        <span class="hljs-keyword">if</span> (!<span class="hljs-keyword">this</span>.noUserInteraction) {

            <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.dirtyCollision) {

                <span class="hljs-keyword">this</span>.dirtyCollision = <span class="hljs-literal">false</span>;

                <span class="hljs-keyword">this</span>.calculateCollisionRadius();

                <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.collides) <span class="hljs-keyword">this</span>.calculateSensors();
            }
        }

        <span class="hljs-keyword">return</span> [<span class="hljs-keyword">this</span>.currentCollisionRadius, <span class="hljs-keyword">this</span>.currentSensors];
    };</pre></div></div>
            
        </li>
        
        
        <li id="section-184">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-184">&#182;</a>
              </div>
              <p>TODO - documentation</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    P.calculateCollisionRadius = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{

        <span class="hljs-keyword">if</span> (!<span class="hljs-keyword">this</span>.noUserInteraction) {

            <span class="hljs-keyword">let</span> stamp = <span class="hljs-keyword">this</span>.currentStampPosition,
                handle = <span class="hljs-keyword">this</span>.currentStampHandlePosition,
                dims = <span class="hljs-keyword">this</span>.currentDimensions,
                scale = <span class="hljs-keyword">this</span>.currentScale;

            <span class="hljs-keyword">let</span> radii = [],
                sx = stamp[<span class="hljs-number">0</span>],
                sy = stamp[<span class="hljs-number">1</span>],
                lx = (sx - (handle[<span class="hljs-number">0</span>] * scale)),
                ty = (sy - (handle[<span class="hljs-number">1</span>] * scale)),
                rx = lx + (dims[<span class="hljs-number">0</span>] * scale),
                by = ty + (dims[<span class="hljs-number">1</span>] * scale);</pre></div></div>
            
        </li>
        
        
        <li id="section-185">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-185">&#182;</a>
              </div>
              <p>BUG: fails for DOM artefact types (stack, canvas, element) whose computed height is 0 - because: ‘auto’?</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            radii.push(<span class="hljs-built_in">Math</span>.sqrt(((sx - lx) * (sx - lx)) + ((sy - ty) * (sy - ty))));
            radii.push(<span class="hljs-built_in">Math</span>.sqrt(((sx - rx) * (sx - rx)) + ((sy - by) * (sy - by))));
            radii.push(<span class="hljs-built_in">Math</span>.sqrt(((sx - lx) * (sx - lx)) + ((sy - by) * (sy - by))));
            radii.push(<span class="hljs-built_in">Math</span>.sqrt(((sx - rx) * (sx - rx)) + ((sy - ty) * (sy - ty))));</pre></div></div>
            
        </li>
        
        
        <li id="section-186">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-186">&#182;</a>
              </div>
              <p>We can use the currentCollisionRadius attribute to quickly calculate whether two given artefacts are capable of intersecting, before proceeding to check if they do intersect (assuming they can)</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            <span class="hljs-keyword">this</span>.currentCollisionRadius = <span class="hljs-built_in">Math</span>.ceil(<span class="hljs-built_in">Math</span>.max(...radii));
        }
    };</pre></div></div>
            
        </li>
        
        
        <li id="section-187">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-187">&#182;</a>
              </div>
              <p>TODO - documentation</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    P.calculateSensors = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{

        <span class="hljs-keyword">if</span> (!<span class="hljs-keyword">this</span>.noUserInteraction) {

            <span class="hljs-keyword">let</span> stamp = <span class="hljs-keyword">this</span>.currentStampPosition,
                handle = <span class="hljs-keyword">this</span>.currentStampHandlePosition,
                dims = <span class="hljs-keyword">this</span>.currentDimensions,
                scale = <span class="hljs-keyword">this</span>.currentScale,
                upend = <span class="hljs-keyword">this</span>.flipUpend,
                reverse = <span class="hljs-keyword">this</span>.flipReverse;

            <span class="hljs-keyword">let</span> rotate = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">x, y, angle, sx, sy</span>) </span>{

                <span class="hljs-keyword">let</span> arr = [<span class="hljs-number">0</span>, <span class="hljs-number">0</span>];

                arr[<span class="hljs-number">0</span>] = <span class="hljs-built_in">Math</span>.atan2(y, x);
                arr[<span class="hljs-number">0</span>] += (angle * <span class="hljs-number">0.01745329251</span>);
                arr[<span class="hljs-number">1</span>] = <span class="hljs-built_in">Math</span>.sqrt((x * x) + (y * y));

                <span class="hljs-keyword">return</span> [<span class="hljs-built_in">Math</span>.round(arr[<span class="hljs-number">1</span>] * <span class="hljs-built_in">Math</span>.cos(arr[<span class="hljs-number">0</span>])) + sx, <span class="hljs-built_in">Math</span>.round(arr[<span class="hljs-number">1</span>] * <span class="hljs-built_in">Math</span>.sin(arr[<span class="hljs-number">0</span>])) + sy];
            };

            <span class="hljs-keyword">let</span> sensors = <span class="hljs-keyword">this</span>.currentSensors;
            sensors.length = <span class="hljs-number">0</span>;

            <span class="hljs-keyword">let</span> roll = <span class="hljs-keyword">this</span>.roll,
                sx = stamp[<span class="hljs-number">0</span>],
                sy = stamp[<span class="hljs-number">1</span>],
                handleX = (reverse) ? -handle[<span class="hljs-number">0</span>] * scale : handle[<span class="hljs-number">0</span>] * scale,
                handleY = (upend) ? -handle[<span class="hljs-number">1</span>] * scale : handle[<span class="hljs-number">1</span>] * scale,
                lx = -handleX,
                ty = -handleY,
                width = dims[<span class="hljs-number">0</span>] * scale,
                height = dims[<span class="hljs-number">1</span>] * scale,
                rx = (reverse) ? lx - width : lx + width,
                by = (upend) ? ty - height : ty + height;

            sensors.push(rotate(lx, ty, roll, sx, sy));
            sensors.push(rotate(rx, ty, roll, sx, sy));
            sensors.push(rotate(rx, by, roll, sx, sy));
            sensors.push(rotate(lx, by, roll, sx, sy));

            <span class="hljs-keyword">let</span> sensorSpacing = <span class="hljs-keyword">this</span>.sensorSpacing || <span class="hljs-number">50</span>,
                widthSensors = <span class="hljs-built_in">parseInt</span>(width / sensorSpacing, <span class="hljs-number">10</span>),
                heightSensors = <span class="hljs-built_in">parseInt</span>(height / sensorSpacing, <span class="hljs-number">10</span>),
                partial, place, i, iz;

            <span class="hljs-keyword">if</span> (widthSensors) {

                <span class="hljs-keyword">let</span> partial = width / (widthSensors + <span class="hljs-number">1</span>),
                    place = lx;

                <span class="hljs-keyword">for</span> (i = <span class="hljs-number">0</span>; i &lt; widthSensors; i++) {

                    place += (reverse) ? -partial : partial;
                    sensors.push(rotate(place, ty, roll, sx, sy));
                    sensors.push(rotate(place, by, roll, sx, sy));
                }
            }

            <span class="hljs-keyword">if</span> (heightSensors) {

                <span class="hljs-keyword">let</span> partial = height / (heightSensors + <span class="hljs-number">1</span>),
                    place = ty;

                <span class="hljs-keyword">for</span> (i = <span class="hljs-number">0</span>; i &lt; heightSensors; i++) {

                    place += (upend) ? -partial : partial;
                    sensors.push(rotate(lx, place, roll, sx, sy));
                    sensors.push(rotate(rx, place, roll, sx, sy));
                }
            }
        }
    };</pre></div></div>
            
        </li>
        
        
        <li id="section-188">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-188">&#182;</a>
              </div>
              <p>TODO - documentation</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    P.getSensors = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{

        <span class="hljs-keyword">let</span> [entityRadius, entitySensors] = <span class="hljs-keyword">this</span>.cleanCollisionData();
        <span class="hljs-keyword">return</span> entitySensors;
    }</pre></div></div>
            
        </li>
        
        
        <li id="section-189">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-189">&#182;</a>
              </div>
              <p>TODO - documentation</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    P.checkHit = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">items = [], mycell</span>) </span>{

        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.noUserInteraction) <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;

        <span class="hljs-keyword">if</span> (!<span class="hljs-keyword">this</span>.pathObject || <span class="hljs-keyword">this</span>.dirtyPathObject) {

            <span class="hljs-keyword">this</span>.cleanPathObject();
        }

        <span class="hljs-keyword">let</span> tests = (!<span class="hljs-built_in">Array</span>.isArray(items)) ?  [items] : items,
            poolCellFlag = <span class="hljs-literal">false</span>;

        <span class="hljs-keyword">if</span> (!mycell) {

            mycell = requestCell();
            poolCellFlag = <span class="hljs-literal">true</span>;
        }

        <span class="hljs-keyword">let</span> engine = mycell.engine,
            stamp = <span class="hljs-keyword">this</span>.currentStampPosition,
            x = stamp[<span class="hljs-number">0</span>],
            y = stamp[<span class="hljs-number">1</span>],
            tx, ty;

        <span class="hljs-keyword">if</span> (tests.some(<span class="hljs-function"><span class="hljs-params">test</span> =&gt;</span> {

            <span class="hljs-keyword">if</span> (<span class="hljs-built_in">Array</span>.isArray(test)) {

                tx = test[<span class="hljs-number">0</span>];
                ty = test[<span class="hljs-number">1</span>];
            }
            <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (xta(test, test.x, test.y)) {

                tx = test.x;
                ty = test.y;
            }
            <span class="hljs-keyword">else</span> <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;

            <span class="hljs-keyword">if</span> (!tx.toFixed || !ty.toFixed || <span class="hljs-built_in">isNaN</span>(tx) || <span class="hljs-built_in">isNaN</span>(ty)) <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;

            mycell.rotateDestination(engine, x, y, <span class="hljs-keyword">this</span>);

            <span class="hljs-keyword">return</span> engine.isPointInPath(<span class="hljs-keyword">this</span>.pathObject, tx, ty, <span class="hljs-keyword">this</span>.winding);

        }, <span class="hljs-keyword">this</span>)) {

            <span class="hljs-keyword">if</span> (poolCellFlag) releaseCell(mycell);

            <span class="hljs-keyword">return</span> {
                <span class="hljs-attr">x</span>: tx,
                <span class="hljs-attr">y</span>: ty,
                <span class="hljs-attr">artefact</span>: <span class="hljs-keyword">this</span>
            };
        }
        
        <span class="hljs-keyword">if</span> (poolCellFlag) releaseCell(mycell);
        
        <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
    };</pre></div></div>
            
        </li>
        
        
        <li id="section-190">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-190">&#182;</a>
              </div>
              <p>TODO - documentation</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    P.updatePositionSubscribers = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{

        <span class="hljs-keyword">this</span>.dirtyPositionSubscribers = <span class="hljs-literal">false</span>;

        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.pivoted &amp;&amp; <span class="hljs-keyword">this</span>.pivoted.length) <span class="hljs-keyword">this</span>.updatePivotSubscribers();
        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.mimicked &amp;&amp; <span class="hljs-keyword">this</span>.mimicked.length) <span class="hljs-keyword">this</span>.updateMimicSubscribers();
        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.pathed &amp;&amp; <span class="hljs-keyword">this</span>.pathed.length) <span class="hljs-keyword">this</span>.updatePathSubscribers();
        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.controlSubscriber &amp;&amp; <span class="hljs-keyword">this</span>.controlSubscriber.length) <span class="hljs-keyword">this</span>.updateControlSubscribers();
        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.startControlSubscriber &amp;&amp; <span class="hljs-keyword">this</span>.startControlSubscriber.length) <span class="hljs-keyword">this</span>.updateStartControlSubscribers();
        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.endControlSubscriber &amp;&amp; <span class="hljs-keyword">this</span>.endControlSubscriber.length) <span class="hljs-keyword">this</span>.updateEndControlSubscribers();
        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.endSubscriber &amp;&amp; <span class="hljs-keyword">this</span>.endSubscriber.length) <span class="hljs-keyword">this</span>.updateEndSubscribers();

    };

    P.updateControlSubscribers = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{

        <span class="hljs-keyword">this</span>.controlSubscriber.forEach(<span class="hljs-function"><span class="hljs-params">name</span> =&gt;</span> {

            <span class="hljs-keyword">let</span> instance = artefact[name];

            <span class="hljs-keyword">if</span> (instance) instance.dirtyControl = <span class="hljs-literal">true</span>;
        });
    };

    P.updateStartControlSubscribers = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{

        <span class="hljs-keyword">this</span>.startControlSubscriber.forEach(<span class="hljs-function"><span class="hljs-params">name</span> =&gt;</span> {

            <span class="hljs-keyword">let</span> instance = artefact[name];

            <span class="hljs-keyword">if</span> (instance) instance.dirtyStartControl = <span class="hljs-literal">true</span>;
        });
    };

    P.updateEndControlSubscribers = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{

        <span class="hljs-keyword">this</span>.endControlSubscriber.forEach(<span class="hljs-function"><span class="hljs-params">name</span> =&gt;</span> {

            <span class="hljs-keyword">let</span> instance = artefact[name];

            <span class="hljs-keyword">if</span> (instance) instance.dirtyEndControl = <span class="hljs-literal">true</span>;
        });
    };

    P.updateEndSubscribers = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{

        <span class="hljs-keyword">this</span>.endSubscriber.forEach(<span class="hljs-function"><span class="hljs-params">name</span> =&gt;</span> {

            <span class="hljs-keyword">let</span> instance = artefact[name];

            <span class="hljs-keyword">if</span> (instance) instance.dirtyEnd = <span class="hljs-literal">true</span>;
        });
    };

    P.updatePivotSubscribers = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{

        <span class="hljs-keyword">this</span>.pivoted.forEach(<span class="hljs-function"><span class="hljs-params">name</span> =&gt;</span> {

            <span class="hljs-keyword">let</span> instance = artefact[name];

            <span class="hljs-keyword">if</span> (instance) {

                instance.dirtyStart = <span class="hljs-literal">true</span>;
                <span class="hljs-keyword">if</span> (instance.addPivotHandle) instance.dirtyHandle = <span class="hljs-literal">true</span>;
                <span class="hljs-keyword">if</span> (instance.addPivotOffset) instance.dirtyOffset = <span class="hljs-literal">true</span>;
                <span class="hljs-keyword">if</span> (instance.addPivotRotation) instance.dirtyRotation = <span class="hljs-literal">true</span>;
            }
        });
    };

    P.updateMimicSubscribers = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{

        <span class="hljs-keyword">let</span> DMH = <span class="hljs-keyword">this</span>.dirtyMimicHandle;
        <span class="hljs-keyword">let</span> DMO = <span class="hljs-keyword">this</span>.dirtyMimicOffset;
        <span class="hljs-keyword">let</span> DMR = <span class="hljs-keyword">this</span>.dirtyMimicRotation;
        <span class="hljs-keyword">let</span> DMS = <span class="hljs-keyword">this</span>.dirtyMimicScale;
        <span class="hljs-keyword">let</span> DMD = <span class="hljs-keyword">this</span>.dirtyMimicDimensions;

        <span class="hljs-keyword">this</span>.mimicked.forEach(<span class="hljs-function"><span class="hljs-params">name</span> =&gt;</span> {

            <span class="hljs-keyword">let</span> instance = artefact[name];

            <span class="hljs-keyword">if</span> (instance) {

                <span class="hljs-keyword">if</span> (instance.useMimicStart) instance.dirtyStart = <span class="hljs-literal">true</span>;
                <span class="hljs-keyword">if</span> (DMH &amp;&amp; instance.useMimicHandle) instance.dirtyHandle = <span class="hljs-literal">true</span>;
                <span class="hljs-keyword">if</span> (DMO &amp;&amp; instance.useMimicOffset) instance.dirtyOffset = <span class="hljs-literal">true</span>;
                <span class="hljs-keyword">if</span> (DMR &amp;&amp; instance.useMimicRotation) instance.dirtyRotation = <span class="hljs-literal">true</span>;
                <span class="hljs-keyword">if</span> (DMS &amp;&amp; instance.useMimicScale) instance.dirtyScale = <span class="hljs-literal">true</span>;
                <span class="hljs-keyword">if</span> (DMD &amp;&amp; instance.useMimicDimensions) instance.dirtyDimensions = <span class="hljs-literal">true</span>;
            }
        });

        <span class="hljs-keyword">this</span>.dirtyMimicHandle = <span class="hljs-literal">false</span>;
        <span class="hljs-keyword">this</span>.dirtyMimicOffset = <span class="hljs-literal">false</span>;
        <span class="hljs-keyword">this</span>.dirtyMimicRotation = <span class="hljs-literal">false</span>;
        <span class="hljs-keyword">this</span>.dirtyMimicScale = <span class="hljs-literal">false</span>;
        <span class="hljs-keyword">this</span>.dirtyMimicDimensions = <span class="hljs-literal">false</span>;
    };</pre></div></div>
            
        </li>
        
        
        <li id="section-191">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-191">&#182;</a>
              </div>
              <p>This is a holding function. The real function is in factory/shape.js as only shapes have to worry about updating their path subscribers</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    P.updatePathSubscribers = defaultNonReturnFunction;</pre></div></div>
            
        </li>
        
        
        <li id="section-192">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-192">&#182;</a>
              </div>
              <p>This is a holding function. The real function is in factory/picture.js as only pictures need to deal with telling subscribers about image update issues</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    P.updateImageSubscribers = defaultNonReturnFunction;</pre></div></div>
            
        </li>
        
        
        <li id="section-193">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-193">&#182;</a>
              </div>
              <p>TODO - documentation</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    P.getPathData = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{

        <span class="hljs-keyword">let</span> pathPos = <span class="hljs-keyword">this</span>.pathPosition,
            path = <span class="hljs-keyword">this</span>.path,
            currentPathData;

        <span class="hljs-keyword">if</span> (path) {

            currentPathData = path.getPathPositionData(pathPos);

            <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.addPathRotation) <span class="hljs-keyword">this</span>.dirtyRotation = <span class="hljs-literal">true</span>;

            <span class="hljs-keyword">return</span> currentPathData;
        }
        <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
    };</pre></div></div>
            
        </li>
        
        
        <li id="section-194">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-194">&#182;</a>
              </div>
              <p>TODO - documentation</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    P.pickupArtefact = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">items = {}</span>) </span>{

        <span class="hljs-keyword">let</span> {x, y} = items;

        <span class="hljs-keyword">if</span> (xta(x, y)) {

            <span class="hljs-keyword">this</span>.isBeingDragged = <span class="hljs-literal">true</span>;
            <span class="hljs-keyword">this</span>.currentDragCache.set(<span class="hljs-keyword">this</span>.currentDragOffset);
            <span class="hljs-keyword">this</span>.currentDragOffset.set(<span class="hljs-keyword">this</span>.currentStart).subtract([x, y]);

            <span class="hljs-keyword">this</span>.order += <span class="hljs-number">9999</span>;

            <span class="hljs-keyword">this</span>.group.batchResort = <span class="hljs-literal">true</span>;

            <span class="hljs-keyword">if</span> (xt(<span class="hljs-keyword">this</span>.dirtyPathObject)) <span class="hljs-keyword">this</span>.dirtyPathObject = <span class="hljs-literal">true</span>;

        }

        <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>;
    };</pre></div></div>
            
        </li>
        
        
        <li id="section-195">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-195">&#182;</a>
              </div>
              <p>TODO - documentation</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    P.dropArtefact = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{

        <span class="hljs-keyword">this</span>.start.set(<span class="hljs-keyword">this</span>.currentStartCache).add(<span class="hljs-keyword">this</span>.currentDragOffset);
        <span class="hljs-keyword">this</span>.dirtyStart = <span class="hljs-literal">true</span>;

        <span class="hljs-keyword">this</span>.currentDragOffset.set(<span class="hljs-keyword">this</span>.currentDragCache);

        <span class="hljs-keyword">this</span>.order = (<span class="hljs-keyword">this</span>.order &gt;= <span class="hljs-number">9999</span>) ? <span class="hljs-keyword">this</span>.order - <span class="hljs-number">9999</span> : <span class="hljs-number">0</span>;

        <span class="hljs-keyword">this</span>.group.batchResort = <span class="hljs-literal">true</span>;

        <span class="hljs-keyword">if</span> (xt(<span class="hljs-keyword">this</span>.dirtyPathObject)) <span class="hljs-keyword">this</span>.dirtyPathObject = <span class="hljs-literal">true</span>;

        <span class="hljs-keyword">this</span>.isBeingDragged = <span class="hljs-literal">false</span>;

        <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>;
    };</pre></div></div>
            
        </li>
        
        
        <li id="section-196">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-196">&#182;</a>
              </div>
              <p>Return the prototype</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">return</span> P;
};</pre></div></div>
            
        </li>
        
    </ul>
  </div>
</body>
</html>
