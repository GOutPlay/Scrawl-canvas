<!DOCTYPE html>

<html>
<head>
  <title>Shape-curve mixin</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <meta name="viewport" content="width=device-width, target-densitydpi=160dpi, initial-scale=1.0; maximum-scale=1.0; user-scalable=0;">
  <link rel="stylesheet" media="all" href="../../docco.css" />
</head>
<body>
  <div id="container">
    <div id="background"></div>
    
      <ul id="jump_to">
        <li>
          <a class="large" href="javascript:void(0);">Jump To &hellip;</a>
          <a class="small" href="javascript:void(0);">+</a>
          <div id="jump_wrapper">
          <div id="jump_page_wrapper">
            <div id="jump_page">
              
                
                <a class="source" href="../core/animationloop.html">
                  ./source/core/animationloop.js
                </a>
              
                
                <a class="source" href="../core/component.html">
                  ./source/core/component.js
                </a>
              
                
                <a class="source" href="../core/document.html">
                  ./source/core/document.js
                </a>
              
                
                <a class="source" href="../core/init.html">
                  ./source/core/init.js
                </a>
              
                
                <a class="source" href="../core/library.html">
                  ./source/core/library.js
                </a>
              
                
                <a class="source" href="../core/userInteraction.html">
                  ./source/core/userInteraction.js
                </a>
              
                
                <a class="source" href="../core/utilities.html">
                  ./source/core/utilities.js
                </a>
              
                
                <a class="source" href="../factory/action.html">
                  ./source/factory/action.js
                </a>
              
                
                <a class="source" href="../factory/anchor.html">
                  ./source/factory/anchor.js
                </a>
              
                
                <a class="source" href="../factory/animation.html">
                  ./source/factory/animation.js
                </a>
              
                
                <a class="source" href="../factory/bezier.html">
                  ./source/factory/bezier.js
                </a>
              
                
                <a class="source" href="../factory/block.html">
                  ./source/factory/block.js
                </a>
              
                
                <a class="source" href="../factory/canvas.html">
                  ./source/factory/canvas.js
                </a>
              
                
                <a class="source" href="../factory/cell.html">
                  ./source/factory/cell.js
                </a>
              
                
                <a class="source" href="../factory/color.html">
                  ./source/factory/color.js
                </a>
              
                
                <a class="source" href="../factory/coordinate.html">
                  ./source/factory/coordinate.js
                </a>
              
                
                <a class="source" href="../factory/element.html">
                  ./source/factory/element.js
                </a>
              
                
                <a class="source" href="../factory/filter.html">
                  ./source/factory/filter.js
                </a>
              
                
                <a class="source" href="../factory/fontAttributes.html">
                  ./source/factory/fontAttributes.js
                </a>
              
                
                <a class="source" href="../factory/gradient.html">
                  ./source/factory/gradient.js
                </a>
              
                
                <a class="source" href="../factory/grid.html">
                  ./source/factory/grid.js
                </a>
              
                
                <a class="source" href="../factory/group.html">
                  ./source/factory/group.js
                </a>
              
                
                <a class="source" href="../factory/imageAsset.html">
                  ./source/factory/imageAsset.js
                </a>
              
                
                <a class="source" href="../factory/line.html">
                  ./source/factory/line.js
                </a>
              
                
                <a class="source" href="../factory/loom.html">
                  ./source/factory/loom.js
                </a>
              
                
                <a class="source" href="../factory/oval.html">
                  ./source/factory/oval.js
                </a>
              
                
                <a class="source" href="../factory/palette.html">
                  ./source/factory/palette.js
                </a>
              
                
                <a class="source" href="../factory/pattern.html">
                  ./source/factory/pattern.js
                </a>
              
                
                <a class="source" href="../factory/phrase.html">
                  ./source/factory/phrase.js
                </a>
              
                
                <a class="source" href="../factory/picture.html">
                  ./source/factory/picture.js
                </a>
              
                
                <a class="source" href="../factory/polygon.html">
                  ./source/factory/polygon.js
                </a>
              
                
                <a class="source" href="../factory/polyline.html">
                  ./source/factory/polyline.js
                </a>
              
                
                <a class="source" href="../factory/quadratic.html">
                  ./source/factory/quadratic.js
                </a>
              
                
                <a class="source" href="../factory/quaternion.html">
                  ./source/factory/quaternion.js
                </a>
              
                
                <a class="source" href="../factory/radialGradient.html">
                  ./source/factory/radialGradient.js
                </a>
              
                
                <a class="source" href="../factory/rectangle.html">
                  ./source/factory/rectangle.js
                </a>
              
                
                <a class="source" href="../factory/renderAnimation.html">
                  ./source/factory/renderAnimation.js
                </a>
              
                
                <a class="source" href="../factory/shape.html">
                  ./source/factory/shape.js
                </a>
              
                
                <a class="source" href="../factory/spiral.html">
                  ./source/factory/spiral.js
                </a>
              
                
                <a class="source" href="../factory/spriteAsset.html">
                  ./source/factory/spriteAsset.js
                </a>
              
                
                <a class="source" href="../factory/stack.html">
                  ./source/factory/stack.js
                </a>
              
                
                <a class="source" href="../factory/star.html">
                  ./source/factory/star.js
                </a>
              
                
                <a class="source" href="../factory/state.html">
                  ./source/factory/state.js
                </a>
              
                
                <a class="source" href="../factory/tetragon.html">
                  ./source/factory/tetragon.js
                </a>
              
                
                <a class="source" href="../factory/ticker.html">
                  ./source/factory/ticker.js
                </a>
              
                
                <a class="source" href="../factory/tween.html">
                  ./source/factory/tween.js
                </a>
              
                
                <a class="source" href="../factory/unstackedElement.html">
                  ./source/factory/unstackedElement.js
                </a>
              
                
                <a class="source" href="../factory/vector.html">
                  ./source/factory/vector.js
                </a>
              
                
                <a class="source" href="../factory/videoAsset.html">
                  ./source/factory/videoAsset.js
                </a>
              
                
                <a class="source" href="../factory/wheel.html">
                  ./source/factory/wheel.js
                </a>
              
                
                <a class="source" href="anchor.html">
                  ./source/mixin/anchor.js
                </a>
              
                
                <a class="source" href="asset.html">
                  ./source/mixin/asset.js
                </a>
              
                
                <a class="source" href="assetConsumer.html">
                  ./source/mixin/assetConsumer.js
                </a>
              
                
                <a class="source" href="base.html">
                  ./source/mixin/base.js
                </a>
              
                
                <a class="source" href="cascade.html">
                  ./source/mixin/cascade.js
                </a>
              
                
                <a class="source" href="dom.html">
                  ./source/mixin/dom.js
                </a>
              
                
                <a class="source" href="entity.html">
                  ./source/mixin/entity.js
                </a>
              
                
                <a class="source" href="filter.html">
                  ./source/mixin/filter.js
                </a>
              
                
                <a class="source" href="position.html">
                  ./source/mixin/position.js
                </a>
              
                
                <a class="source" href="shapeBasic.html">
                  ./source/mixin/shapeBasic.js
                </a>
              
                
                <a class="source" href="shapeCurve.html">
                  ./source/mixin/shapeCurve.js
                </a>
              
                
                <a class="source" href="shapePathCalculation.html">
                  ./source/mixin/shapePathCalculation.js
                </a>
              
                
                <a class="source" href="styles.html">
                  ./source/mixin/styles.js
                </a>
              
                
                <a class="source" href="tween.html">
                  ./source/mixin/tween.js
                </a>
              
                
                <a class="source" href="../worker/filter.html">
                  ./source/worker/filter.js
                </a>
              
            </div>
          </div>
        </li>
      </ul>
    
    <ul class="sections">
        
        
        
        <li id="section-1">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-1">&#182;</a>
              </div>
              <h1 id="shape-curve-mixin">Shape-curve mixin</h1>
<p>This mixin defines additional attributes and functionality used byScrawl-canvas <strong>line</strong>, <strong>quadratic</strong> and <strong>bezier</strong> path-defined entitys. </p>
<p>These entitys have additional positioning coordinates (<code>startControl</code> and <code>endControl</code> for Bezier entitys; <code>control</code> for Quadratic entitys; all three entity types use the <code>end</code> coordinate) which we use to construct and position them. Other artefacts can pivot themselves to these coordinates, and path-defined entitys can pivot the coordinates to other artefacts.</p>

            </div>
            
        </li>
        
        
        <li id="section-2">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-2">&#182;</a>
              </div>
              <h4 id="imports">Imports</h4>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">import</span> { artefact } <span class="hljs-keyword">from</span> <span class="hljs-string">'../core/library.js'</span>;
<span class="hljs-keyword">import</span> { mergeOver, isa_boolean, xt, xta, addStrings, capitalize, removeItem, pushUnique } <span class="hljs-keyword">from</span> <span class="hljs-string">'../core/utilities.js'</span>;

<span class="hljs-keyword">import</span> { makeCoordinate } <span class="hljs-keyword">from</span> <span class="hljs-string">'../factory/coordinate.js'</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-3">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-3">&#182;</a>
              </div>
              <h4 id="export-function">Export function</h4>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">P = {}</span>) </span>{</pre></div></div>
            
        </li>
        
        
        <li id="section-4">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-4">&#182;</a>
              </div>
              <h4 id="shared-attributes">Shared attributes</h4>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">let</span> defaultAttributes = {

        <span class="hljs-attr">end</span>: <span class="hljs-literal">null</span>,
        <span class="hljs-attr">currentEnd</span>: <span class="hljs-literal">null</span>,

        <span class="hljs-attr">endPivot</span>: <span class="hljs-string">''</span>,
        <span class="hljs-attr">endPivotCorner</span>: <span class="hljs-string">''</span>,
        <span class="hljs-attr">addEndPivotHandle</span>: <span class="hljs-literal">false</span>,
        <span class="hljs-attr">addEndPivotOffset</span>: <span class="hljs-literal">false</span>,

        <span class="hljs-attr">endPath</span>: <span class="hljs-string">''</span>,
        <span class="hljs-attr">endPathPosition</span>: <span class="hljs-number">0</span>,
        <span class="hljs-attr">addEndPathHandle</span>: <span class="hljs-literal">false</span>,
        <span class="hljs-attr">addEndPathOffset</span>: <span class="hljs-literal">true</span>,

        <span class="hljs-attr">endLockTo</span>: <span class="hljs-string">''</span>,

        <span class="hljs-attr">useStartAsControlPoint</span>: <span class="hljs-literal">false</span>,
    };
    P.defs = mergeOver(P.defs, defaultAttributes);</pre></div></div>
            
        </li>
        
        
        <li id="section-5">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-5">&#182;</a>
              </div>
              <h4 id="packet-management">Packet management</h4>

            </div>
            
            <div class="content"><div class='highlight'><pre>    P.packetExclusions = pushUnique(P.packetExclusions, [<span class="hljs-string">'controlledLineOffset'</span>]);
    P.packetExclusionsByRegex = pushUnique(P.packetExclusionsByRegex, []);
    P.packetCoordinates = pushUnique(P.packetCoordinates, [<span class="hljs-string">'end'</span>]);
    P.packetObjects = pushUnique(P.packetObjects, [<span class="hljs-string">'endPivot'</span>, <span class="hljs-string">'endPath'</span>]);
    P.packetFunctions = pushUnique(P.packetFunctions, []);</pre></div></div>
            
        </li>
        
        
        <li id="section-6">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-6">&#182;</a>
              </div>
              <h4 id="clone-management">Clone management</h4>
<p>No additional clone functionality defined here</p>

            </div>
            
        </li>
        
        
        <li id="section-7">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-7">&#182;</a>
              </div>
              <h4 id="kill-management">Kill management</h4>

            </div>
            
            <div class="content"><div class='highlight'><pre>P.factoryKill = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{

    <span class="hljs-built_in">Object</span>.entries(artefact).forEach(<span class="hljs-function">(<span class="hljs-params">[name, art]</span>) =&gt;</span> {

        <span class="hljs-keyword">if</span> (art.name !== <span class="hljs-keyword">this</span>.name) {

            <span class="hljs-keyword">if</span> (art.startControlPivot &amp;&amp; art.startControlPivot.name === <span class="hljs-keyword">this</span>.name) art.set({ <span class="hljs-attr">startControlPivot</span>: <span class="hljs-literal">false</span>});
            <span class="hljs-keyword">if</span> (art.controlPivot &amp;&amp; art.controlPivot.name === <span class="hljs-keyword">this</span>.name) art.set({ <span class="hljs-attr">controlPivot</span>: <span class="hljs-literal">false</span>});
            <span class="hljs-keyword">if</span> (art.endControlPivot &amp;&amp; art.endControlPivot.name === <span class="hljs-keyword">this</span>.name) art.set({ <span class="hljs-attr">endControlPivot</span>: <span class="hljs-literal">false</span>});
            <span class="hljs-keyword">if</span> (art.endPivot &amp;&amp; art.endPivot.name === <span class="hljs-keyword">this</span>.name) art.set({ <span class="hljs-attr">endPivot</span>: <span class="hljs-literal">false</span>});

            <span class="hljs-keyword">if</span> (art.startControlPath &amp;&amp; art.startControlPath.name === <span class="hljs-keyword">this</span>.name) art.set({ <span class="hljs-attr">startControlPath</span>: <span class="hljs-literal">false</span>});
            <span class="hljs-keyword">if</span> (art.controlPath &amp;&amp; art.controlPath.name === <span class="hljs-keyword">this</span>.name) art.set({ <span class="hljs-attr">controlPath</span>: <span class="hljs-literal">false</span>});
            <span class="hljs-keyword">if</span> (art.endControlPath &amp;&amp; art.endControlPath.name === <span class="hljs-keyword">this</span>.name) art.set({ <span class="hljs-attr">endControlPath</span>: <span class="hljs-literal">false</span>});
            <span class="hljs-keyword">if</span> (art.endPath &amp;&amp; art.endPath.name === <span class="hljs-keyword">this</span>.name) art.set({ <span class="hljs-attr">endPath</span>: <span class="hljs-literal">false</span>});
        }
    });
};</pre></div></div>
            
        </li>
        
        
        <li id="section-8">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-8">&#182;</a>
              </div>
              <h4 id="get-set-deltaset">Get, Set, deltaSet</h4>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">let</span> G = P.getters,
        S = P.setters,
        D = P.deltaSetters;</pre></div></div>
            
        </li>
        
        
        <li id="section-9">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-9">&#182;</a>
              </div>
              <p><strong>useStartAsControlPoint</strong></p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    S.useStartAsControlPoint = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">item</span>) </span>{

        <span class="hljs-keyword">this</span>.useStartAsControlPoint = item;

        <span class="hljs-keyword">if</span> (!item) {

            <span class="hljs-keyword">let</span> controlledLine = <span class="hljs-keyword">this</span>.controlledLineOffset;
            controlledLine[<span class="hljs-number">0</span>] = <span class="hljs-number">0</span>;
            controlledLine[<span class="hljs-number">1</span>] = <span class="hljs-number">0</span>;
        }

        <span class="hljs-keyword">this</span>.updateDirty();
    };</pre></div></div>
            
        </li>
        
        
        <li id="section-10">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-10">&#182;</a>
              </div>
              <p><strong>endPivot</strong></p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    S.endPivot = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">item</span>) </span>{

        <span class="hljs-keyword">this</span>.setControlHelper(item, <span class="hljs-string">'endPivot'</span>, <span class="hljs-string">'end'</span>);
        <span class="hljs-keyword">this</span>.updateDirty();
        <span class="hljs-keyword">this</span>.dirtyEnd = <span class="hljs-literal">true</span>;
    };</pre></div></div>
            
        </li>
        
        
        <li id="section-11">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-11">&#182;</a>
              </div>
              <p><strong>endPath</strong></p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    S.endPath = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">item</span>) </span>{

        <span class="hljs-keyword">this</span>.setControlHelper(item, <span class="hljs-string">'endPath'</span>, <span class="hljs-string">'end'</span>);
        <span class="hljs-keyword">this</span>.updateDirty();
        <span class="hljs-keyword">this</span>.dirtyEnd = <span class="hljs-literal">true</span>;
    };</pre></div></div>
            
        </li>
        
        
        <li id="section-12">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-12">&#182;</a>
              </div>
              <p><strong>endPathPosition</strong></p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    S.endPathPosition = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">item</span>) </span>{

        <span class="hljs-keyword">this</span>.endPathPosition = item;
        <span class="hljs-keyword">this</span>.dirtyEnd = <span class="hljs-literal">true</span>;
        <span class="hljs-keyword">this</span>.currentEndPathData = <span class="hljs-literal">false</span>;
    };
    D.endPathPosition = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">item</span>) </span>{

        <span class="hljs-keyword">this</span>.endPathPosition += item;
        <span class="hljs-keyword">this</span>.dirtyEnd = <span class="hljs-literal">true</span>;
        <span class="hljs-keyword">this</span>.currentEndPathData = <span class="hljs-literal">false</span>;
    };</pre></div></div>
            
        </li>
        
        
        <li id="section-13">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-13">&#182;</a>
              </div>
              <p><strong>end</strong></p>
<ul>
<li>pseudo-attributes <strong>endX</strong>, <strong>endY</strong></li>
</ul>

            </div>
            
            <div class="content"><div class='highlight'><pre>    S.endX = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">coord</span>) </span>{

        <span class="hljs-keyword">if</span> (coord != <span class="hljs-literal">null</span>) {

            <span class="hljs-keyword">this</span>.end[<span class="hljs-number">0</span>] = coord;
            <span class="hljs-keyword">this</span>.updateDirty();
            <span class="hljs-keyword">this</span>.dirtyEnd = <span class="hljs-literal">true</span>;
            <span class="hljs-keyword">this</span>.currentEndPathData = <span class="hljs-literal">false</span>;
        }
    };
    S.endY = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">coord</span>) </span>{

        <span class="hljs-keyword">if</span> (coord != <span class="hljs-literal">null</span>) {

            <span class="hljs-keyword">this</span>.end[<span class="hljs-number">1</span>] = coord;
            <span class="hljs-keyword">this</span>.updateDirty();
            <span class="hljs-keyword">this</span>.dirtyEnd = <span class="hljs-literal">true</span>;
            <span class="hljs-keyword">this</span>.currentEndPathData = <span class="hljs-literal">false</span>;
        }
    };
    S.end = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">x, y</span>) </span>{

        <span class="hljs-keyword">this</span>.setCoordinateHelper(<span class="hljs-string">'end'</span>, x, y);
        <span class="hljs-keyword">this</span>.updateDirty();
        <span class="hljs-keyword">this</span>.dirtyEnd = <span class="hljs-literal">true</span>;
        <span class="hljs-keyword">this</span>.currentEndPathData = <span class="hljs-literal">false</span>;
    };
    D.endX = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">coord</span>) </span>{

        <span class="hljs-keyword">let</span> c = <span class="hljs-keyword">this</span>.end;
        c[<span class="hljs-number">0</span>] = addStrings(c[<span class="hljs-number">0</span>], coord);
        <span class="hljs-keyword">this</span>.updateDirty();
        <span class="hljs-keyword">this</span>.dirtyEnd = <span class="hljs-literal">true</span>;
        <span class="hljs-keyword">this</span>.currentEndPathData = <span class="hljs-literal">false</span>;
    };
    D.endY = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">coord</span>) </span>{

        <span class="hljs-keyword">let</span> c = <span class="hljs-keyword">this</span>.end;
        c[<span class="hljs-number">1</span>] = addStrings(c[<span class="hljs-number">1</span>], coord);
        <span class="hljs-keyword">this</span>.updateDirty();
        <span class="hljs-keyword">this</span>.dirtyEnd = <span class="hljs-literal">true</span>;
        <span class="hljs-keyword">this</span>.currentEndPathData = <span class="hljs-literal">false</span>;
    };
    D.end = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">x, y</span>) </span>{

        <span class="hljs-keyword">this</span>.setDeltaCoordinateHelper(<span class="hljs-string">'end'</span>, x, y);
        <span class="hljs-keyword">this</span>.updateDirty();
        <span class="hljs-keyword">this</span>.dirtyEnd = <span class="hljs-literal">true</span>;
        <span class="hljs-keyword">this</span>.currentEndPathData = <span class="hljs-literal">false</span>;
    };</pre></div></div>
            
        </li>
        
        
        <li id="section-14">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-14">&#182;</a>
              </div>
              <p><strong>endLockTo</strong></p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    S.endLockTo = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">item</span>) </span>{

        <span class="hljs-keyword">this</span>.endLockTo = item;
        <span class="hljs-keyword">this</span>.updateDirty();
        <span class="hljs-keyword">this</span>.dirtyEndLock = <span class="hljs-literal">true</span>;
        <span class="hljs-keyword">this</span>.currentEndPathData = <span class="hljs-literal">false</span>;
    };</pre></div></div>
            
        </li>
        
        
        <li id="section-15">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-15">&#182;</a>
              </div>
              <h4 id="prototype-functions">Prototype functions</h4>

            </div>
            
        </li>
        
        
        <li id="section-16">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-16">&#182;</a>
              </div>
              <p><code>curveInit</code> - internal constructor helper function</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    P.curveInit = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">items</span>) </span>{

        <span class="hljs-keyword">this</span>.end = makeCoordinate();
        <span class="hljs-keyword">this</span>.currentEnd = makeCoordinate();
        <span class="hljs-keyword">this</span>.endLockTo = <span class="hljs-string">'coord'</span>;
        <span class="hljs-keyword">this</span>.dirtyEnd = <span class="hljs-literal">true</span>;

        <span class="hljs-keyword">this</span>.dirtyPins = [];

        <span class="hljs-keyword">this</span>.controlledLineOffset = makeCoordinate();
    };</pre></div></div>
            
        </li>
        
        
        <li id="section-17">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-17">&#182;</a>
              </div>
              <p><code>setControlHelper</code> - internal setter helper function</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    P.setControlHelper = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">item, attr, label</span>) </span>{

        <span class="hljs-keyword">let</span> isPivot = (attr.indexOf(<span class="hljs-string">'Pivot'</span>) &gt; <span class="hljs-number">0</span>) ? <span class="hljs-literal">true</span> : <span class="hljs-literal">false</span>;

        <span class="hljs-keyword">if</span> (isa_boolean(item) &amp;&amp; !item) {

            <span class="hljs-keyword">this</span>[attr] = <span class="hljs-literal">null</span>;

            <span class="hljs-keyword">if</span> (isPivot) {

                <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>[<span class="hljs-string">`<span class="hljs-subst">${label}</span>LockTo`</span>] === <span class="hljs-string">'pivot'</span>) {

                    <span class="hljs-keyword">this</span>[<span class="hljs-string">`<span class="hljs-subst">${label}</span>LockTo`</span>] = <span class="hljs-string">'start'</span>;

                    <span class="hljs-keyword">if</span> (label === <span class="hljs-string">'startControl'</span>) <span class="hljs-keyword">this</span>.dirtyStartControlLock = <span class="hljs-literal">true</span>;
                    <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (label === <span class="hljs-string">'control'</span>) <span class="hljs-keyword">this</span>.dirtyControlLock = <span class="hljs-literal">true</span>;
                    <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (label === <span class="hljs-string">'endControl'</span>) <span class="hljs-keyword">this</span>.dirtyEndControlLock = <span class="hljs-literal">true</span>;
                    <span class="hljs-keyword">else</span> <span class="hljs-keyword">this</span>.dirtyEndLock = <span class="hljs-literal">true</span>;
                }
            }
            <span class="hljs-keyword">else</span> {

                <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>[<span class="hljs-string">`<span class="hljs-subst">${label}</span>LockTo`</span>] === <span class="hljs-string">'path'</span>) {

                    <span class="hljs-keyword">this</span>[<span class="hljs-string">`<span class="hljs-subst">${label}</span>LockTo`</span>] = <span class="hljs-string">'start'</span>;

                    <span class="hljs-keyword">if</span> (label === <span class="hljs-string">'startControl'</span>) <span class="hljs-keyword">this</span>.dirtyStartControlLock = <span class="hljs-literal">true</span>;
                    <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (label === <span class="hljs-string">'control'</span>) <span class="hljs-keyword">this</span>.dirtyControlLock = <span class="hljs-literal">true</span>;
                    <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (label === <span class="hljs-string">'endControl'</span>) <span class="hljs-keyword">this</span>.dirtyEndControlLock = <span class="hljs-literal">true</span>;
                    <span class="hljs-keyword">else</span> <span class="hljs-keyword">this</span>.dirtyEndLock = <span class="hljs-literal">true</span>;
                }
            }
        }
        <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (item) {

            <span class="hljs-keyword">let</span> oldControl = <span class="hljs-keyword">this</span>[attr],
                newControl = (item.substring) ? artefact[item] : item;

            <span class="hljs-keyword">if</span> (newControl &amp;&amp; newControl.isArtefact) {

                <span class="hljs-keyword">if</span> (oldControl &amp;&amp; oldControl.isArtefact) {

                    <span class="hljs-keyword">if</span> (isPivot) removeItem(oldControl.pivoted, <span class="hljs-keyword">this</span>.name);
                    <span class="hljs-keyword">else</span> removeItem(oldControl.pathed, <span class="hljs-keyword">this</span>.name);
                }

                <span class="hljs-keyword">if</span> (isPivot) pushUnique(newControl.pivoted, <span class="hljs-keyword">this</span>.name);
                <span class="hljs-keyword">else</span> pushUnique(newControl.pathed, <span class="hljs-keyword">this</span>.name);

                <span class="hljs-keyword">this</span>[attr] = newControl;
            }
        }
    };</pre></div></div>
            
        </li>
        
        
        <li id="section-18">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-18">&#182;</a>
              </div>
              <p><code>buildPathPositionObject</code> - internal function called by <code>getPathPositionData</code></p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    P.buildPathPositionObject = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">unit, myLen</span>) </span>{

        <span class="hljs-keyword">if</span> (unit) {

            <span class="hljs-keyword">let</span> [unitSpecies, ...vars] = unit;

            <span class="hljs-keyword">let</span> myPoint, angle;

            <span class="hljs-keyword">switch</span> (unitSpecies) {

                <span class="hljs-keyword">case</span> <span class="hljs-string">'linear'</span> :
                    myPoint = <span class="hljs-keyword">this</span>.positionPointOnPath(<span class="hljs-keyword">this</span>.getLinearXY(myLen, ...vars));
                    angle = <span class="hljs-keyword">this</span>.getLinearAngle(myLen, ...vars);
                    <span class="hljs-keyword">break</span>;

                <span class="hljs-keyword">case</span> <span class="hljs-string">'quadratic'</span> :
                    myPoint = <span class="hljs-keyword">this</span>.positionPointOnPath(<span class="hljs-keyword">this</span>.getQuadraticXY(myLen, ...vars));
                    angle = <span class="hljs-keyword">this</span>.getQuadraticAngle(myLen, ...vars);
                    <span class="hljs-keyword">break</span>;
                    
                <span class="hljs-keyword">case</span> <span class="hljs-string">'bezier'</span> :
                    myPoint = <span class="hljs-keyword">this</span>.positionPointOnPath(<span class="hljs-keyword">this</span>.getBezierXY(myLen, ...vars));
                    angle = <span class="hljs-keyword">this</span>.getBezierAngle(myLen, ...vars);
                    <span class="hljs-keyword">break</span>;
            }

            <span class="hljs-keyword">let</span> flipAngle = <span class="hljs-number">0</span>
            <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.flipReverse) flipAngle++;
            <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.flipUpend) flipAngle++;

            <span class="hljs-keyword">if</span> (flipAngle === <span class="hljs-number">1</span>) angle = -angle;

            angle += <span class="hljs-keyword">this</span>.roll;

            <span class="hljs-keyword">let</span> stamp = <span class="hljs-keyword">this</span>.currentStampPosition,
                lineOffset = <span class="hljs-keyword">this</span>.controlledLineOffset,
                localBox = <span class="hljs-keyword">this</span>.localBox;

            myPoint.x += lineOffset[<span class="hljs-number">0</span>];
            myPoint.y += lineOffset[<span class="hljs-number">1</span>];

            myPoint.angle = angle;

            <span class="hljs-keyword">return</span> myPoint;
        }
        <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
    };</pre></div></div>
            
        </li>
        
        
        <li id="section-19">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-19">&#182;</a>
              </div>
              <h4 id="display-cycle-functionality">Display cycle functionality</h4>

            </div>
            
        </li>
        
        
        <li id="section-20">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-20">&#182;</a>
              </div>
              <p><code>prepareStamp</code> - the purpose of most of these actions is described in the <a href="http://localhost:8080/docs/source/mixin/entity.html#section-31">entity mixin function</a> that this function overwrites</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    P.prepareStamp = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{

        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.dirtyHost) <span class="hljs-keyword">this</span>.dirtyHost = <span class="hljs-literal">false</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-21">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-21">&#182;</a>
              </div>
              <p><code>preparePinsForStamp</code> function defined in line, quadratic and bezier modules</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.dirtyPins.length) {

            <span class="hljs-keyword">this</span>.preparePinsForStamp();
        }</pre></div></div>
            
        </li>
        
        
        <li id="section-22">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-22">&#182;</a>
              </div>
              <p><code>dirtyLock</code> flags (one for each control) - trigger <strong>cleanLock</strong> functions - which in turn set appropriate dirty flags on the entity.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.dirtyLock) <span class="hljs-keyword">this</span>.cleanLock();
        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.dirtyStartControlLock) <span class="hljs-keyword">this</span>.cleanControlLock(<span class="hljs-string">'startControl'</span>);
        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.dirtyEndControlLock) <span class="hljs-keyword">this</span>.cleanControlLock(<span class="hljs-string">'endControl'</span>);
        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.dirtyControlLock) <span class="hljs-keyword">this</span>.cleanControlLock(<span class="hljs-string">'control'</span>);
        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.dirtyEndLock) <span class="hljs-keyword">this</span>.cleanControlLock(<span class="hljs-string">'end'</span>);

        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.dirtyScale || <span class="hljs-keyword">this</span>.dirtySpecies || <span class="hljs-keyword">this</span>.dirtyDimensions || <span class="hljs-keyword">this</span>.dirtyStart || <span class="hljs-keyword">this</span>.dirtyStartControl || <span class="hljs-keyword">this</span>.dirtyEndControl || <span class="hljs-keyword">this</span>.dirtyControl || <span class="hljs-keyword">this</span>.dirtyEnd || <span class="hljs-keyword">this</span>.dirtyHandle) {

            <span class="hljs-keyword">this</span>.dirtyPathObject = <span class="hljs-literal">true</span>;
            <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.collides) <span class="hljs-keyword">this</span>.dirtyCollision = <span class="hljs-literal">true</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-23">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-23">&#182;</a>
              </div>
              <p><code>dirtySpecies</code> flag is specific to Shape entitys</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.useStartAsControlPoint &amp;&amp; <span class="hljs-keyword">this</span>.dirtyStart) {

                <span class="hljs-keyword">this</span>.dirtySpecies = <span class="hljs-literal">true</span>;
                <span class="hljs-keyword">this</span>.pathCalculatedOnce = <span class="hljs-literal">false</span>;
            }</pre></div></div>
            
        </li>
        
        
        <li id="section-24">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-24">&#182;</a>
              </div>
              <p><code>pathCalculatedOnce</code> - calculating path data is an expensive operation - use this flag to limit the calculation to run only when needed</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.dirtyScale || <span class="hljs-keyword">this</span>.dirtySpecies || <span class="hljs-keyword">this</span>.dirtyStartControl || <span class="hljs-keyword">this</span>.dirtyEndControl || <span class="hljs-keyword">this</span>.dirtyControl || <span class="hljs-keyword">this</span>.dirtyEnd)  <span class="hljs-keyword">this</span>.pathCalculatedOnce = <span class="hljs-literal">false</span>;
        }

        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.isBeingDragged || <span class="hljs-keyword">this</span>.lockTo.indexOf(<span class="hljs-string">'mouse'</span>) &gt;= <span class="hljs-number">0</span>) {

            <span class="hljs-keyword">this</span>.dirtyStampPositions = <span class="hljs-literal">true</span>;
            <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.collides) <span class="hljs-keyword">this</span>.dirtyCollision = <span class="hljs-literal">true</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-25">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-25">&#182;</a>
              </div>
              <p><code>useStartAsControlPoint</code> </p>
<ul>
<li>When false, this flag indicates that line, quadratic and bezier shapes should treat <code>start</code> Coordinate updates as an instruction to move the entire Shape. </li>
<li>When true, the Coordinate is used to define the shape of the Shape relative to its other control/end Coordinates</li>
</ul>

            </div>
            
            <div class="content"><div class='highlight'><pre>            <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.useStartAsControlPoint) {

                <span class="hljs-keyword">this</span>.dirtySpecies = <span class="hljs-literal">true</span>;
                <span class="hljs-keyword">this</span>.dirtyPathObject = <span class="hljs-literal">true</span>;
                <span class="hljs-keyword">this</span>.pathCalculatedOnce = <span class="hljs-literal">false</span>;
            }
        }

        <span class="hljs-keyword">if</span> ((<span class="hljs-keyword">this</span>.dirtyRotation || <span class="hljs-keyword">this</span>.dirtyOffset) &amp;&amp; <span class="hljs-keyword">this</span>.collides) <span class="hljs-keyword">this</span>.dirtyCollision = <span class="hljs-literal">true</span>;

        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.dirtyCollision &amp;&amp; !<span class="hljs-keyword">this</span>.useAsPath) {

            <span class="hljs-keyword">this</span>.dirtyPathObject = <span class="hljs-literal">true</span>;
            <span class="hljs-keyword">this</span>.pathCalculatedOnce = <span class="hljs-literal">false</span>;
        }

        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.dirtyScale) <span class="hljs-keyword">this</span>.cleanScale();

        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.dirtyStart) <span class="hljs-keyword">this</span>.cleanStart();
        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.dirtyStartControl) <span class="hljs-keyword">this</span>.cleanControl(<span class="hljs-string">'startControl'</span>);
        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.dirtyEndControl) <span class="hljs-keyword">this</span>.cleanControl(<span class="hljs-string">'endControl'</span>);
        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.dirtyControl) <span class="hljs-keyword">this</span>.cleanControl(<span class="hljs-string">'control'</span>);
        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.dirtyEnd) <span class="hljs-keyword">this</span>.cleanControl(<span class="hljs-string">'end'</span>);

        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.dirtyOffset) <span class="hljs-keyword">this</span>.cleanOffset();
        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.dirtyRotation) <span class="hljs-keyword">this</span>.cleanRotation();

        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.dirtyStampPositions) <span class="hljs-keyword">this</span>.cleanStampPositions();</pre></div></div>
            
        </li>
        
        
        <li id="section-26">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-26">&#182;</a>
              </div>
              <p><code>cleanSpecies</code> - creates the SVG path String which will be used by <code>cleanPathObject</code> - each species creates the local path in its own way</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.dirtySpecies) <span class="hljs-keyword">this</span>.cleanSpecies();
        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.dirtyPathObject) <span class="hljs-keyword">this</span>.cleanPathObject();

        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.dirtyPositionSubscribers) {

            <span class="hljs-keyword">this</span>.updatePositionSubscribers();
            <span class="hljs-keyword">this</span>.updateControlPathSubscribers();
        }
    };</pre></div></div>
            
        </li>
        
        
        <li id="section-27">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-27">&#182;</a>
              </div>
              <p><code>cleanControlLock</code> - internal helper function - called by <code>prepareStamp</code></p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    P.cleanControlLock = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">label</span>) </span>{

        <span class="hljs-keyword">let</span> capLabel = capitalize(label);

        <span class="hljs-keyword">this</span>[<span class="hljs-string">`dirty<span class="hljs-subst">${capLabel}</span>Lock`</span>] = <span class="hljs-literal">false</span>;
        <span class="hljs-keyword">this</span>[<span class="hljs-string">`dirty<span class="hljs-subst">${capLabel}</span>`</span>] = <span class="hljs-literal">true</span>;
    };</pre></div></div>
            
        </li>
        
        
        <li id="section-28">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-28">&#182;</a>
              </div>
              <p><code>cleanControl</code> - internal helper function - called by <code>prepareStamp</code></p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    P.cleanControl = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">label</span>) </span>{

        <span class="hljs-keyword">let</span> capLabel = capitalize(label);

        <span class="hljs-keyword">this</span>[<span class="hljs-string">`dirty<span class="hljs-subst">${capLabel}</span>`</span>] = <span class="hljs-literal">false</span>;

        <span class="hljs-keyword">let</span> pivotLabel = <span class="hljs-string">`<span class="hljs-subst">${label}</span>Pivot`</span>,
            pathLabel = <span class="hljs-string">`<span class="hljs-subst">${label}</span>Path`</span>,
            pivot = <span class="hljs-keyword">this</span>[pivotLabel],
            path = <span class="hljs-keyword">this</span>[pathLabel],
            art, pathData;

        <span class="hljs-keyword">if</span> (pivot &amp;&amp; pivot.substring) {

            art = artefact[pivot];

            <span class="hljs-keyword">if</span> (art) pivot = art;
        }

        <span class="hljs-keyword">if</span> (path &amp;&amp; path.substring) {

            art = artefact[path];

            <span class="hljs-keyword">if</span> (art) path = art;
        }

        <span class="hljs-keyword">let</span> lock = <span class="hljs-keyword">this</span>[<span class="hljs-string">`<span class="hljs-subst">${label}</span>LockTo`</span>], 
            x, y, ox, oy, here, flag,
            raw = <span class="hljs-keyword">this</span>[label],
            current = <span class="hljs-keyword">this</span>[<span class="hljs-string">`current<span class="hljs-subst">${capLabel}</span>`</span>];

        <span class="hljs-keyword">if</span> (lock === <span class="hljs-string">'pivot'</span> &amp;&amp; (!pivot || pivot.substring)) lock = <span class="hljs-string">'coord'</span>;
        <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (lock === <span class="hljs-string">'path'</span> &amp;&amp; (!path || path.substring)) lock = <span class="hljs-string">'coord'</span>;

        <span class="hljs-keyword">switch</span>(lock) {

            <span class="hljs-keyword">case</span> <span class="hljs-string">'pivot'</span> :

                <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.pivotCorner &amp;&amp; pivot.getCornerCoordinate) {

                    [x, y] = pivot.getCornerCoordinate(<span class="hljs-keyword">this</span>[<span class="hljs-string">`<span class="hljs-subst">${label}</span>PivotCorner`</span>]);
                }
                <span class="hljs-keyword">else</span> [x, y] = pivot.currentStampPosition;

                <span class="hljs-keyword">if</span> (!<span class="hljs-keyword">this</span>.addPivotOffset) {

                    [ox, oy] = pivot.currentOffset;
                    x -= ox;
                    y -= oy;
                }

                <span class="hljs-keyword">break</span>;

            <span class="hljs-keyword">case</span> <span class="hljs-string">'path'</span> :

                pathData = <span class="hljs-keyword">this</span>.getControlPathData(path, label, capLabel);

                x = pathData.x;
                y = pathData.y;

                <span class="hljs-keyword">if</span> (!<span class="hljs-keyword">this</span>.addPathOffset) {

                    x -= path.currentOffset[<span class="hljs-number">0</span>];
                    y -= path.currentOffset[<span class="hljs-number">1</span>];
                }

                <span class="hljs-keyword">break</span>;

            <span class="hljs-keyword">case</span> <span class="hljs-string">'mouse'</span> :

                here = <span class="hljs-keyword">this</span>.getHere();

                x = here.x || <span class="hljs-number">0</span>;
                y = here.y || <span class="hljs-number">0</span>;

                <span class="hljs-keyword">break</span>;

            <span class="hljs-keyword">default</span> :
                
                x = y = <span class="hljs-number">0</span>;

                here = <span class="hljs-keyword">this</span>.getHere();

                <span class="hljs-keyword">if</span> (xt(here)) {

                    <span class="hljs-keyword">if</span> (xta(here.w, here.h)) {

                        <span class="hljs-keyword">this</span>.cleanPosition(current, raw, [here.w, here.h]);
                        [x, y] = current;
                    }
                }
        }

        current[<span class="hljs-number">0</span>] = x;
        current[<span class="hljs-number">1</span>] = y;

        <span class="hljs-keyword">this</span>.dirtySpecies = <span class="hljs-literal">true</span>;
        <span class="hljs-keyword">this</span>.dirtyPathObject = <span class="hljs-literal">true</span>;
        <span class="hljs-keyword">this</span>.dirtyPositionSubscribers = <span class="hljs-literal">true</span>;
    };</pre></div></div>
            
        </li>
        
        
        <li id="section-29">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-29">&#182;</a>
              </div>
              <p><code>getControlPathData</code> - internal helper function - called by <code>cleanControl</code></p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    P.getControlPathData = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">path, label, capLabel</span>) </span>{

        <span class="hljs-keyword">let</span> checkAttribute = <span class="hljs-keyword">this</span>[<span class="hljs-string">`current<span class="hljs-subst">${capLabel}</span>PathData`</span>];

        <span class="hljs-keyword">if</span> (checkAttribute) <span class="hljs-keyword">return</span> checkAttribute;

        <span class="hljs-keyword">let</span> pathPos = <span class="hljs-keyword">this</span>[<span class="hljs-string">`<span class="hljs-subst">${label}</span>PathPosition`</span>],
            tempPos = pathPos,
            pathData = path.getPathPositionData(pathPos);

        <span class="hljs-keyword">if</span> (pathPos &lt; <span class="hljs-number">0</span>) pathPos += <span class="hljs-number">1</span>;
        <span class="hljs-keyword">if</span> (pathPos &gt; <span class="hljs-number">1</span>) pathPos = pathPos % <span class="hljs-number">1</span>;

        pathPos = <span class="hljs-built_in">parseFloat</span>(pathPos.toFixed(<span class="hljs-number">6</span>));
        <span class="hljs-keyword">if</span> (pathPos !== tempPos) <span class="hljs-keyword">this</span>[<span class="hljs-string">`<span class="hljs-subst">${label}</span>PathPosition`</span>] = pathPos;

        <span class="hljs-keyword">if</span> (pathData) {

            <span class="hljs-keyword">this</span>[<span class="hljs-string">`current<span class="hljs-subst">${capLabel}</span>PathData`</span>] = pathData;
            <span class="hljs-keyword">return</span> pathData;
        }

        <span class="hljs-keyword">else</span> {

            <span class="hljs-keyword">let</span> here = <span class="hljs-keyword">this</span>.getHere();

            <span class="hljs-keyword">if</span> (xt(here)) {

                <span class="hljs-keyword">if</span> (xta(here.w, here.h)) {

                    <span class="hljs-keyword">let</span> current = <span class="hljs-keyword">this</span>[<span class="hljs-string">`current<span class="hljs-subst">${capLabel}</span>`</span>];

                    <span class="hljs-keyword">this</span>.cleanPosition(current, <span class="hljs-keyword">this</span>[label], [here.w, here.h]);

                    <span class="hljs-keyword">return</span> {
                        <span class="hljs-attr">x</span>: current[<span class="hljs-number">0</span>],
                        <span class="hljs-attr">y</span>: current[<span class="hljs-number">1</span>]
                    };
                }
            }
            <span class="hljs-keyword">return</span> {
                <span class="hljs-attr">x</span>: <span class="hljs-number">0</span>,
                <span class="hljs-attr">y</span>: <span class="hljs-number">0</span>
            };
        }
    };</pre></div></div>
            
        </li>
        
        
        <li id="section-30">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-30">&#182;</a>
              </div>
              <p><code>updateControlPathSubscribers</code></p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    P.updateControlPathSubscribers = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{</pre></div></div>
            
        </li>
        
        
        <li id="section-31">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-31">&#182;</a>
              </div>
              <p>THIS WON’T WORK - got rid of these ‘subscriber’ Arrays!</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">let</span> items = [].concat(<span class="hljs-keyword">this</span>.endSubscriber, <span class="hljs-keyword">this</span>.endControlSubscriber, <span class="hljs-keyword">this</span>.controlSubscriber, <span class="hljs-keyword">this</span>.startControlSubscriber);

        items.forEach(<span class="hljs-function"><span class="hljs-params">name</span> =&gt;</span> {

            <span class="hljs-keyword">let</span> instance = artefact[name];

            <span class="hljs-keyword">if</span> (instance) {

                <span class="hljs-keyword">if</span> (instance.type === <span class="hljs-string">'Line'</span> || instance.type === <span class="hljs-string">'Quadratic'</span> || instance.type === <span class="hljs-string">'Bezier'</span>) {

                    <span class="hljs-keyword">if</span> (instance.type === <span class="hljs-string">'Quadratic'</span>) {

                        instance.dirtyControl = <span class="hljs-literal">true</span>;
                        instance.currentControlPathData = <span class="hljs-literal">false</span>;
                    }

                    <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (instance.type === <span class="hljs-string">'Bezier'</span>) {

                        instance.dirtyStartControl = <span class="hljs-literal">true</span>;
                        instance.dirtyEndControl = <span class="hljs-literal">true</span>;
                        instance.currentStartControlPathData = <span class="hljs-literal">false</span>;
                        instance.currentEndControlPathData = <span class="hljs-literal">false</span>;
                    }
                    instance.currentEndPathData = <span class="hljs-literal">false</span>;
                    instance.dirtyEnd = <span class="hljs-literal">true</span>;
                }
                instance.currentPathData = <span class="hljs-literal">false</span>;
                instance.dirtyStart = <span class="hljs-literal">true</span>;
            }
        });
    };</pre></div></div>
            
        </li>
        
        
        <li id="section-32">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-32">&#182;</a>
              </div>
              <p>Return the prototype</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">return</span> P;
};</pre></div></div>
            
        </li>
        
    </ul>
  </div>
</body>
</html>
