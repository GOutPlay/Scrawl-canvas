<!DOCTYPE html>

<html>
<head>
  <title>DOM management</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <meta name="viewport" content="width=device-width, target-densitydpi=160dpi, initial-scale=1.0; maximum-scale=1.0; user-scalable=0;">
  <link rel="stylesheet" media="all" href="../../docco.css" />
</head>
<body>
  <div id="container">
    <div id="background"></div>
    
      <ul id="jump_to">
        <li>
          <a class="large" href="javascript:void(0);">Jump To &hellip;</a>
          <a class="small" href="javascript:void(0);">+</a>
          <div id="jump_wrapper">
          <div id="jump_page_wrapper">
            <div id="jump_page">
              
                
                <a class="source" href="animationloop.html">
                  ./source/core/animationloop.js
                </a>
              
                
                <a class="source" href="component.html">
                  ./source/core/component.js
                </a>
              
                
                <a class="source" href="document.html">
                  ./source/core/document.js
                </a>
              
                
                <a class="source" href="init.html">
                  ./source/core/init.js
                </a>
              
                
                <a class="source" href="library.html">
                  ./source/core/library.js
                </a>
              
                
                <a class="source" href="userInteraction.html">
                  ./source/core/userInteraction.js
                </a>
              
                
                <a class="source" href="utilities.html">
                  ./source/core/utilities.js
                </a>
              
                
                <a class="source" href="../factory/action.html">
                  ./source/factory/action.js
                </a>
              
                
                <a class="source" href="../factory/anchor.html">
                  ./source/factory/anchor.js
                </a>
              
                
                <a class="source" href="../factory/animation.html">
                  ./source/factory/animation.js
                </a>
              
                
                <a class="source" href="../factory/block.html">
                  ./source/factory/block.js
                </a>
              
                
                <a class="source" href="../factory/canvas.html">
                  ./source/factory/canvas.js
                </a>
              
                
                <a class="source" href="../factory/cell.html">
                  ./source/factory/cell.js
                </a>
              
                
                <a class="source" href="../factory/color.html">
                  ./source/factory/color.js
                </a>
              
                
                <a class="source" href="../factory/coordinate.html">
                  ./source/factory/coordinate.js
                </a>
              
                
                <a class="source" href="../factory/element.html">
                  ./source/factory/element.js
                </a>
              
                
                <a class="source" href="../factory/filter.html">
                  ./source/factory/filter.js
                </a>
              
                
                <a class="source" href="../factory/fontAttributes.html">
                  ./source/factory/fontAttributes.js
                </a>
              
                
                <a class="source" href="../factory/gradient.html">
                  ./source/factory/gradient.js
                </a>
              
                
                <a class="source" href="../factory/grid.html">
                  ./source/factory/grid.js
                </a>
              
                
                <a class="source" href="../factory/group.html">
                  ./source/factory/group.js
                </a>
              
                
                <a class="source" href="../factory/imageAsset.html">
                  ./source/factory/imageAsset.js
                </a>
              
                
                <a class="source" href="../factory/loom.html">
                  ./source/factory/loom.js
                </a>
              
                
                <a class="source" href="../factory/palette.html">
                  ./source/factory/palette.js
                </a>
              
                
                <a class="source" href="../factory/pattern.html">
                  ./source/factory/pattern.js
                </a>
              
                
                <a class="source" href="../factory/phrase.html">
                  ./source/factory/phrase.js
                </a>
              
                
                <a class="source" href="../factory/picture.html">
                  ./source/factory/picture.js
                </a>
              
                
                <a class="source" href="../factory/quaternion.html">
                  ./source/factory/quaternion.js
                </a>
              
                
                <a class="source" href="../factory/radialGradient.html">
                  ./source/factory/radialGradient.js
                </a>
              
                
                <a class="source" href="../factory/renderAnimation.html">
                  ./source/factory/renderAnimation.js
                </a>
              
                
                <a class="source" href="../factory/shape.html">
                  ./source/factory/shape.js
                </a>
              
                
                <a class="source" href="../factory/spriteAsset.html">
                  ./source/factory/spriteAsset.js
                </a>
              
                
                <a class="source" href="../factory/stack.html">
                  ./source/factory/stack.js
                </a>
              
                
                <a class="source" href="../factory/state.html">
                  ./source/factory/state.js
                </a>
              
                
                <a class="source" href="../factory/ticker.html">
                  ./source/factory/ticker.js
                </a>
              
                
                <a class="source" href="../factory/tween.html">
                  ./source/factory/tween.js
                </a>
              
                
                <a class="source" href="../factory/unstackedElement.html">
                  ./source/factory/unstackedElement.js
                </a>
              
                
                <a class="source" href="../factory/vector.html">
                  ./source/factory/vector.js
                </a>
              
                
                <a class="source" href="../factory/videoAsset.html">
                  ./source/factory/videoAsset.js
                </a>
              
                
                <a class="source" href="../factory/wheel.html">
                  ./source/factory/wheel.js
                </a>
              
                
                <a class="source" href="../mixin/anchor.html">
                  ./source/mixin/anchor.js
                </a>
              
                
                <a class="source" href="../mixin/asset.html">
                  ./source/mixin/asset.js
                </a>
              
                
                <a class="source" href="../mixin/assetConsumer.html">
                  ./source/mixin/assetConsumer.js
                </a>
              
                
                <a class="source" href="../mixin/base.html">
                  ./source/mixin/base.js
                </a>
              
                
                <a class="source" href="../mixin/cascade.html">
                  ./source/mixin/cascade.js
                </a>
              
                
                <a class="source" href="../mixin/dom.html">
                  ./source/mixin/dom.js
                </a>
              
                
                <a class="source" href="../mixin/entity.html">
                  ./source/mixin/entity.js
                </a>
              
                
                <a class="source" href="../mixin/filter.html">
                  ./source/mixin/filter.js
                </a>
              
                
                <a class="source" href="../mixin/position.html">
                  ./source/mixin/position.js
                </a>
              
                
                <a class="source" href="../mixin/shapePathCalculation.html">
                  ./source/mixin/shapePathCalculation.js
                </a>
              
                
                <a class="source" href="../mixin/styles.html">
                  ./source/mixin/styles.js
                </a>
              
                
                <a class="source" href="../mixin/tween.html">
                  ./source/mixin/tween.js
                </a>
              
                
                <a class="source" href="../worker/filter.html">
                  ./source/worker/filter.js
                </a>
              
            </div>
          </div>
        </li>
      </ul>
    
    <ul class="sections">
        
        
        
        <li id="section-1">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-1">&#182;</a>
              </div>
              <h1 id="dom-management">DOM management</h1>
<p>Core DOM element discovery and management functionality, and the Scrawl-canvas <strong>Display cycle</strong>.</p>
<p>Scrawl-canvas breaks down the display cycle into three parts: <strong>clear</strong>; <strong>compile</strong>; and <strong>show</strong>. These can be triggered either as a single, combined <strong>render</strong> operation, or separately as-and-when needed.</p>
<p>The order in which DOM stack and canvas elements are processed during the display cycle can be changed by setting that element’s controller’s <strong>order</strong> attribute to a higher or lower integer value; elements are processed (in batches) from lowest to highest order value</p>

            </div>
            
        </li>
        
        
        <li id="section-2">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-2">&#182;</a>
              </div>
              <h4 id="imports">Imports</h4>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">import</span> { isa_canvas, generateUuid, isa_fn, isa_dom, pushUnique, removeItem, xt } <span class="hljs-keyword">from</span> <span class="hljs-string">"./utilities.js"</span>;
<span class="hljs-keyword">import</span> { artefact, canvas, group, stack, css, xcss } <span class="hljs-keyword">from</span> <span class="hljs-string">"./library.js"</span>;

<span class="hljs-keyword">import</span> { makeStack } <span class="hljs-keyword">from</span> <span class="hljs-string">"../factory/stack.js"</span>;
<span class="hljs-keyword">import</span> { makeElement } <span class="hljs-keyword">from</span> <span class="hljs-string">"../factory/element.js"</span>;
<span class="hljs-keyword">import</span> { makeCanvas } <span class="hljs-keyword">from</span> <span class="hljs-string">"../factory/canvas.js"</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-3">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-3">&#182;</a>
              </div>
              <h4 id="root-elements">Root elements</h4>
<p><code>Exported array and function</code> (to modules). Root elements are the boxes whose dimensions define the dimensions and positioning of all that they contain. All &lt;canvas&gt; elements are root elements. Scrawl-canvas also allows other DOM elements (typically &lt;div&gt; elements) to be defined as root elements called <strong>stacks</strong>, whose child elements can then be positioned and dimensioned just like entity objects in a canvas.</p>
<p>Stacks can be nested within each other, and canvases can also be nested inside a stack. (Nothing can nest inside a canvas element). Only the top level stack will be included in the rootElements array.</p>
<p>The Scrawl-canvas <strong>Display cycle</strong> - a cascade of Promise-based functionality for updating canvas and stack displays - can start at the rootElements array, with each member of the array processed in turn.</p>
<p>The <strong>rootElements</strong> array keeps track of all ‘root’ stack artefacts, and also includes all canvas artefacts, whether they’re part of a stack or not. <strong>setRootElementSort</strong> forces the root</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">let</span> rootElements = [],
    setRootElementsSort = <span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> {rootElementsSort = <span class="hljs-literal">true</span>};</pre></div></div>
            
        </li>
        
        
        <li id="section-4">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-4">&#182;</a>
              </div>
              <p>Local variables</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">let</span> rootElements_sorted = [],
    rootElementsSort = <span class="hljs-literal">true</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-5">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-5">&#182;</a>
              </div>
              <p>Scrawl-canvas rootElements sorter uses a ‘bucket sort’ algorithm</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">const</span> sortRootElements = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{

    <span class="hljs-keyword">let</span> floor = <span class="hljs-built_in">Math</span>.floor;

    <span class="hljs-keyword">if</span> (rootElementsSort) {

        rootElementsSort = <span class="hljs-literal">false</span>;

        <span class="hljs-keyword">let</span> buckets = [];

        rootElements.forEach(<span class="hljs-function">(<span class="hljs-params">item</span>) =&gt;</span> {

            <span class="hljs-keyword">let</span> art = artefact[item],
                order = (art) ? floor(art.order) : <span class="hljs-number">0</span>;

            <span class="hljs-keyword">if</span> (!buckets[order]) buckets[order] = [];
            
            buckets[order].push(art.name);
        });

        rootElements_sorted = buckets.reduce(<span class="hljs-function">(<span class="hljs-params">a, v</span>) =&gt;</span> a.concat(v), []);
    }
};</pre></div></div>
            
        </li>
        
        
        <li id="section-6">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-6">&#182;</a>
              </div>
              <h4 id="stack-discovery">Stack discovery</h4>
<p><code>Exported function</code> (to modules). Parse the DOM, looking for all elements that have been given a <strong>data-stack</strong> attribute; then create <strong>Stack</strong> artefact wrappers for each of them. </p>
<p>This function will also create wrappers for all <strong>direct child elements</strong> (one level down) within the stack, and create appropriate wrappers (Stack, Canvas, Element) for them.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">const</span> getStacks = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
        
    <span class="hljs-built_in">document</span>.querySelectorAll(<span class="hljs-string">'[data-stack]'</span>).forEach(<span class="hljs-function"><span class="hljs-params">el</span> =&gt;</span> addInitialStackElement(el));
};</pre></div></div>
            
        </li>
        
        
        <li id="section-7">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-7">&#182;</a>
              </div>
              <p>Create a <strong>stack</strong> artefact wrapper for a given stack element.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">const</span> addInitialStackElement = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">el</span>) </span>{

    <span class="hljs-keyword">let</span> mygroup = el.getAttribute(<span class="hljs-string">'data-group'</span>),
        myname = el.id || el.getAttribute(<span class="hljs-string">'name'</span>),
        position = <span class="hljs-string">'absolute'</span>;

    <span class="hljs-keyword">if</span> (!mygroup) {

        el.setAttribute(<span class="hljs-string">'data-group'</span>, <span class="hljs-string">'root'</span>);
        mygroup = <span class="hljs-string">'root'</span>;
        position = <span class="hljs-string">'relative'</span>;
    }

    <span class="hljs-keyword">if</span> (!myname) {

        myname = generateUuid();
        el.id = myname;
    }

    <span class="hljs-keyword">let</span> mystack = makeStack({
        <span class="hljs-attr">name</span>: myname,
        <span class="hljs-attr">domElement</span>: el,
        <span class="hljs-attr">group</span>: mygroup,
        <span class="hljs-attr">host</span>: mygroup,
        <span class="hljs-attr">position</span>: position,
        <span class="hljs-attr">setInitialDimensions</span>: <span class="hljs-literal">true</span>
    });

    processNewStackChildren(el, myname);

    <span class="hljs-keyword">return</span> mystack;
};</pre></div></div>
            
        </li>
        
        
        <li id="section-8">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-8">&#182;</a>
              </div>
              <p>Helper function for addInitialStackElement()</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">const</span> processNewStackChildren = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">el, name</span>) </span>{

    <span class="hljs-keyword">let</span> hostDims = el.getBoundingClientRect(),
        y = <span class="hljs-number">0</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-9">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-9">&#182;</a>
              </div>
              <p>Only go down one level of hierarchy here; stacks don’t do hierarchies, only interested in knowing about immediate child elements</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-built_in">Array</span>.from(el.children).forEach(<span class="hljs-function"><span class="hljs-params">child</span> =&gt;</span> {
    
        <span class="hljs-keyword">if</span> (child.getAttribute(<span class="hljs-string">'data-stack'</span>) == <span class="hljs-literal">null</span> &amp;&amp; !isa_canvas(child) &amp;&amp; child.tagName !== <span class="hljs-string">'SCRIPT'</span>) {

            <span class="hljs-keyword">let</span> dims = child.getBoundingClientRect(),
                computed = <span class="hljs-built_in">window</span>.getComputedStyle(child);

            <span class="hljs-keyword">let</span> yHeight = <span class="hljs-built_in">parseFloat</span>(computed.marginTop) + <span class="hljs-built_in">parseFloat</span>(computed.borderTopWidth) + <span class="hljs-built_in">parseFloat</span>(computed.paddingTop) + <span class="hljs-built_in">parseFloat</span>(computed.paddingBottom) + <span class="hljs-built_in">parseFloat</span>(computed.borderBottomWidth) + <span class="hljs-built_in">parseFloat</span>(computed.marginBottom);

            y = (!y) ? dims.top - hostDims.top : y;

            <span class="hljs-keyword">let</span> args = {
                <span class="hljs-attr">name</span>: child.id || child.getAttribute(<span class="hljs-string">'name'</span>),
                <span class="hljs-attr">domElement</span>: child,
                <span class="hljs-attr">group</span>: name,
                <span class="hljs-attr">host</span>: name,
                <span class="hljs-attr">position</span>: <span class="hljs-string">'absolute'</span>,
                <span class="hljs-attr">width</span>: dims.width,
                <span class="hljs-attr">height</span>: dims.height,
                <span class="hljs-attr">startX</span>: dims.left - hostDims.left,
                <span class="hljs-attr">startY</span>: y,
                <span class="hljs-attr">classes</span>: (child.className) ? child.className : <span class="hljs-string">''</span>,
            };

            y += yHeight + dims.height;

            makeElement(args);
        }</pre></div></div>
            
        </li>
        
        
        <li id="section-10">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-10">&#182;</a>
              </div>
              <p>No need to worry about processing child stacks - they’ll already be in the list of stacks to be processed</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">else</span> child.setAttribute(<span class="hljs-string">'data-group'</span>, name);
    });
};</pre></div></div>
            
        </li>
        
        
        <li id="section-11">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-11">&#182;</a>
              </div>
              <p><code>Exported function</code> (to modules and scrawl object). Use <strong>addStack</strong> to add a Scrawl-canvas stack element to a web page, or transform an existing element into a stack element. The items argument can include </p>
<ul>
<li><strong>element</strong> - the DOM element to be the stack - if not present, will autogenerate a div element</li>
<li><strong>host</strong> - the host element, either as the DOM element itself, or some sort of CSS search string; if not present, will create the stack at the stack element’s current place or, failing all else, add the stack to the end of the document body</li>
<li><strong>name</strong> - String identifier for the stack; if not included the function will attempt to use the element’s existing id or name attribute or, failing that, generate a random name for the stack.</li>
<li>any other regular stack attribute</li>
</ul>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">const</span> addStack = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">items = {}</span>) </span>{</pre></div></div>
            
        </li>
        
        
        <li id="section-12">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-12">&#182;</a>
              </div>
              <p>define variables</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">let</span> el, host, hostinscrawl, mystack, mygroup, name,
        position = <span class="hljs-string">'absolute'</span>,
        newElement = <span class="hljs-literal">false</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-13">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-13">&#182;</a>
              </div>
              <p>get, or generate a new, stack-to-be element</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">if</span> (items.element &amp;&amp; items.element.substring) el = <span class="hljs-built_in">document</span>.querySelector(items.element);
    <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (isa_dom(items.element)) el = items.element;
    <span class="hljs-keyword">else</span> {

        newElement = <span class="hljs-literal">true</span>;
        el = <span class="hljs-built_in">document</span>.createElement(<span class="hljs-string">'div'</span>);
    }</pre></div></div>
            
        </li>
        
        
        <li id="section-14">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-14">&#182;</a>
              </div>
              <p>get element’s host (parent-to-be) element</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">if</span> (items.host &amp;&amp; items.host.substring) {

        host = <span class="hljs-built_in">document</span>.querySelector(items.host);
        <span class="hljs-keyword">if</span> (!host) host = <span class="hljs-built_in">document</span>.body;
    }
    <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (isa_dom(items.host)) host = items.host;
    <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (xt(el.parentElement)) host = el.parentElement;
    <span class="hljs-keyword">else</span> host = <span class="hljs-built_in">document</span>.body;</pre></div></div>
            
        </li>
        
        
        <li id="section-15">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-15">&#182;</a>
              </div>
              <p>if dimensions have been set in the argument, apply them to the stack-to-be element</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">if</span> (xt(items.width)) el.style.width = (items.width.toFixed) ? <span class="hljs-string">`<span class="hljs-subst">${items.width}</span>px`</span> : items.width;
    <span class="hljs-keyword">if</span> (xt(items.height)) el.style.height = (items.height.toFixed) ? <span class="hljs-string">`<span class="hljs-subst">${items.height}</span>px`</span> : items.height;</pre></div></div>
            
        </li>
        
        
        <li id="section-16">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-16">&#182;</a>
              </div>
              <p>make sure the stack-to-be element has an id attribute</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    name = items.name || el.id || el.getAttribute(<span class="hljs-string">'name'</span>) || <span class="hljs-string">''</span>;
    <span class="hljs-keyword">if</span> (!name) name = generateUuid();
    el.id = name;</pre></div></div>
            
        </li>
        
        
        <li id="section-17">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-17">&#182;</a>
              </div>
              <p>set the ‘data-stack’ attribute on the stack-to-be element</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    el.setAttribute(<span class="hljs-string">'data-stack'</span>, <span class="hljs-string">'data-stack'</span>);</pre></div></div>
            
        </li>
        
        
        <li id="section-18">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-18">&#182;</a>
              </div>
              <p>determine whether the parent element is already known to Scrawl-canvas - affects the stack-to-be element’s group </p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">if</span> (host &amp;&amp; host.getAttribute(<span class="hljs-string">'data-stack'</span>) != <span class="hljs-literal">null</span>) {

        hostinscrawl = artefact[host.id];

        mygroup = (hostinscrawl) ? hostinscrawl.name : <span class="hljs-string">'root'</span>;
    }
    <span class="hljs-keyword">else</span> mygroup = <span class="hljs-string">'root'</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-19">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-19">&#182;</a>
              </div>
              <p>set the ‘data-group’ attribute on the stack-to-be element</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    el.setAttribute(<span class="hljs-string">'data-group'</span>, mygroup);</pre></div></div>
            
        </li>
        
        
        <li id="section-20">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-20">&#182;</a>
              </div>
              <p>determine what the stack-to-be element’s position style attribute will be</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">if</span> (mygroup === <span class="hljs-string">'root'</span>) position = <span class="hljs-string">'relative'</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-21">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-21">&#182;</a>
              </div>
              <p>add (or move) the stack-to-be element to/in the DOM</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">if</span> (!el.parentElement || host.id !== el.parentElement.id) host.appendChild(el);</pre></div></div>
            
        </li>
        
        
        <li id="section-22">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-22">&#182;</a>
              </div>
              <p>create the Scrawl-canvas Stack artefact</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    mystack = makeStack({
        <span class="hljs-attr">name</span>: name,
        <span class="hljs-attr">domElement</span>: el,
        <span class="hljs-attr">group</span>: mygroup,
        <span class="hljs-attr">host</span>: mygroup,
        <span class="hljs-attr">position</span>: position,
        <span class="hljs-attr">setInitialDimensions</span>: <span class="hljs-literal">true</span>
    });

    processNewStackChildren(el, name);</pre></div></div>
            
        </li>
        
        
        <li id="section-23">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-23">&#182;</a>
              </div>
              <p>in case any of the child elements were already a Scrawl-canvas stack, un-root them (if required)</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-built_in">Array</span>.from(el.childNodes).forEach(<span class="hljs-function"><span class="hljs-params">child</span> =&gt;</span> {

        <span class="hljs-keyword">if</span> (child.id &amp;&amp; rootElements.indexOf(child.id) &gt;= <span class="hljs-number">0</span>) removeItem(rootElements, child.id);
    });</pre></div></div>
            
        </li>
        
        
        <li id="section-24">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-24">&#182;</a>
              </div>
              <p>set the new Stack’s remaining attributes, clearing out any attributes already handled</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">delete</span> items.name;
    <span class="hljs-keyword">delete</span> items.element;
    <span class="hljs-keyword">delete</span> items.host;
    <span class="hljs-keyword">delete</span> items.width;
    <span class="hljs-keyword">delete</span> items.height;
    mystack.set(items);</pre></div></div>
            
        </li>
        
        
        <li id="section-25">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-25">&#182;</a>
              </div>
              <p>tidy up and complete</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    rootElementsSort = <span class="hljs-literal">true</span>;
    <span class="hljs-keyword">return</span> mystack;
};</pre></div></div>
            
        </li>
        
        
        <li id="section-26">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-26">&#182;</a>
              </div>
              <h4 id="canvas-discovery">Canvas discovery</h4>
<p><code>Exported function</code> (to modules). Parse the DOM, looking for &lt;canvas&gt; elements; then create <strong>Canvas</strong> artefact and <strong>Cell</strong> asset wrappers for each canvas found. Canvas elements do not need to be part of a stack and can appear anywhere in the HTML body.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">const</span> getCanvases = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{

    <span class="hljs-built_in">document</span>.querySelectorAll(<span class="hljs-string">'canvas'</span>).forEach(<span class="hljs-function">(<span class="hljs-params">el, index</span>) =&gt;</span> {

        <span class="hljs-keyword">let</span> item = addInitialCanvasElement(el);

        <span class="hljs-keyword">if</span> (!index) setCurrentCanvas(item);
    });
};</pre></div></div>
            
        </li>
        
        
        <li id="section-27">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-27">&#182;</a>
              </div>
              <p>Create a <strong>canvas</strong> artefact wrapper for a given canvas element.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">const</span> addInitialCanvasElement = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">el</span>) </span>{

    <span class="hljs-keyword">let</span> mygroup = el.getAttribute(<span class="hljs-string">'data-group'</span>),
        myname = el.id || el.getAttribute(<span class="hljs-string">'name'</span>),
        position = <span class="hljs-string">'absolute'</span>;

    <span class="hljs-keyword">if</span> (!mygroup) {

        el.setAttribute(<span class="hljs-string">'data-group'</span>, <span class="hljs-string">'root'</span>);
        mygroup = <span class="hljs-string">'root'</span>;
        position = el.style.position;
    }

    <span class="hljs-keyword">if</span> (!myname) {

        myname = generateUuid();
        el.id = myname;
    }

    <span class="hljs-keyword">return</span> makeCanvas({
        <span class="hljs-attr">name</span>: myname,
        <span class="hljs-attr">domElement</span>: el,
        <span class="hljs-attr">group</span>: mygroup,
        <span class="hljs-attr">host</span>: mygroup,
        <span class="hljs-attr">position</span>: position,
        <span class="hljs-attr">setInitialDimensions</span>: <span class="hljs-literal">true</span>
    });
};</pre></div></div>
            
        </li>
        
        
        <li id="section-28">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-28">&#182;</a>
              </div>
              <p><code>Exported function</code> (to modules and scrawl object). Parse the DOM, looking for a specific &lt;canvas&gt; element; then create a <strong>Canvas</strong> artefact and <strong>Cell</strong> asset wrapper for it.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">const</span> getCanvas = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">search</span>) </span>{

    <span class="hljs-keyword">let</span> el = <span class="hljs-built_in">document</span>.querySelector(search),
        canvas = <span class="hljs-literal">false</span>;

    <span class="hljs-keyword">if</span> (el) canvas = addInitialCanvasElement(el);

    setCurrentCanvas(canvas);
    <span class="hljs-keyword">return</span> canvas;
};</pre></div></div>
            
        </li>
        
        
        <li id="section-29">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-29">&#182;</a>
              </div>
              <p>Scrawl-canvas expects one canvas element (if any canvases are present) to act as the ‘current’ canvas on which other factory functions - such as adding new entitys - can act. The current canvas can be changed at any time using <strong>scrawl.setCurrentCanvas</strong></p>

            </div>
            
        </li>
        
        
        <li id="section-30">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-30">&#182;</a>
              </div>
              <p><code>Exported variables</code> (to modules). </p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">let</span> currentCanvas = <span class="hljs-literal">null</span>,
    currentGroup = <span class="hljs-literal">null</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-31">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-31">&#182;</a>
              </div>
              <p><code>Exported function</code> (to modules and scrawl object). </p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">const</span> setCurrentCanvas = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">item</span>) </span>{

    <span class="hljs-keyword">let</span> changeFlag = <span class="hljs-literal">false</span>;

    <span class="hljs-keyword">if</span> (item) {

        <span class="hljs-keyword">if</span> (item.substring) {

            <span class="hljs-keyword">let</span> mycanvas = canvas[item];

            <span class="hljs-keyword">if</span> (mycanvas) {
                currentCanvas = mycanvas;
                changeFlag = <span class="hljs-literal">true</span>;    
            }
        }
        <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (item.type === <span class="hljs-string">'Canvas'</span>) {

            currentCanvas = item;    
            changeFlag = <span class="hljs-literal">true</span>;    
        } 
    }

    <span class="hljs-keyword">if</span> (changeFlag &amp;&amp; currentCanvas.base) {

        <span class="hljs-keyword">let</span> mygroup = group[currentCanvas.base.name];

        <span class="hljs-keyword">if</span> (mygroup) currentGroup = mygroup;
    }
};</pre></div></div>
            
        </li>
        
        
        <li id="section-32">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-32">&#182;</a>
              </div>
              <p><code>Exported function</code> (to modules and scrawl object). Use <strong>addCanvas</strong> to add a Scrawl-canvas canvas element to a web page. The items argument should include </p>
<ul>
<li><strong>host</strong> - the host element, either as the DOM element itself, or some sort of CSS search string, or a Scrawl-canvas Stack entity. If no host is supplied, Scrawl-canvas will add the new canvas element to the DOM document body; in all cases, the new canvas element is appended at the end of the host element (or DOM document)</li>
<li><strong>name</strong> - String identifier for the element; will generate a random name for the canvas if no name is supplied.</li>
<li>any other regular Scrawl-canvas Canvas artefact attribute</li>
</ul>
<p>By default, Scrawl-canvas will setup the new Canvas as the ‘current canvas’, and will add mouse/pointer tracking functionality to it. If no dimensions are supplied then the Canvas will default to 300px wide and 150px high.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">const</span> addCanvas = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">items = {}</span>) </span>{

    <span class="hljs-keyword">let</span> el = <span class="hljs-built_in">document</span>.createElement(<span class="hljs-string">'canvas'</span>),
        myname = (items.name) ? items.name : generateUuid(),
        host = items.host,
        mygroup = <span class="hljs-string">'root'</span>,
        width = items.width || <span class="hljs-number">300</span>,
        height = items.height || <span class="hljs-number">150</span>,
        position = <span class="hljs-string">'relative'</span>;

    <span class="hljs-keyword">if</span> (host.substring) {

        <span class="hljs-keyword">let</span> temphost = artefact[host];

        <span class="hljs-keyword">if</span> (!temphost &amp;&amp; host) host = <span class="hljs-built_in">document</span>.querySelector(host);
        <span class="hljs-keyword">else</span> host = temphost;
    }

    <span class="hljs-keyword">if</span> (host) {

        <span class="hljs-keyword">if</span> (host.type === <span class="hljs-string">'Stack'</span>) {

            mygroup = host.name;
            position = <span class="hljs-string">'absolute'</span>;
            host = host.domElement;
        }
        <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (!isa_dom(host)) host = <span class="hljs-built_in">document</span>.body;
    }
    <span class="hljs-keyword">else</span> host = <span class="hljs-built_in">document</span>.body;

    el.id = myname;
    el.setAttribute(<span class="hljs-string">'data-group'</span>, mygroup);
    el.width = width;
    el.height = height;
    el.style.position = position;

    host.appendChild(el);

    <span class="hljs-keyword">let</span> mycanvas = makeCanvas({
        <span class="hljs-attr">name</span>: myname,
        <span class="hljs-attr">domElement</span>: el,
        <span class="hljs-attr">group</span>: mygroup,
        <span class="hljs-attr">host</span>: mygroup,
        <span class="hljs-attr">position</span>: position,
        <span class="hljs-attr">setInitialDimensions</span>: <span class="hljs-literal">false</span>,
        <span class="hljs-attr">setAsCurrentCanvas</span>: (xt(items.setAsCurrentCanvas)) ? items.setAsCurrentCanvas : <span class="hljs-literal">true</span>,
        <span class="hljs-attr">trackHere</span>: (xt(items.trackHere)) ? items.trackHere : <span class="hljs-literal">true</span>,
    });

    <span class="hljs-keyword">delete</span> items.group;
    <span class="hljs-keyword">delete</span> items.host;
    <span class="hljs-keyword">delete</span> items.name;
    <span class="hljs-keyword">delete</span> items.element;
    <span class="hljs-keyword">delete</span> items.position;
    <span class="hljs-keyword">delete</span> items.setInitialDimensions;
    <span class="hljs-keyword">delete</span> items.setAsCurrentCanvas;
    <span class="hljs-keyword">delete</span> items.trackHere;

    mycanvas.set(items);

    <span class="hljs-keyword">return</span> mycanvas;
};</pre></div></div>
            
        </li>
        
        
        <li id="section-33">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-33">&#182;</a>
              </div>
              <p>TODO - documentation</p>
<p><code>Exported function</code> (to modules and scrawl object). </p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">const</span> makeAnimationObserver = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">anim, wrapper</span>) </span>{

    <span class="hljs-keyword">if</span> (anim &amp;&amp; anim.run &amp;&amp; wrapper &amp;&amp; wrapper.domElement) {

        <span class="hljs-keyword">let</span> observer = <span class="hljs-keyword">new</span> IntersectionObserver(<span class="hljs-function">(<span class="hljs-params">entries, observer</span>) =&gt;</span> {

            entries.forEach(<span class="hljs-function"><span class="hljs-params">entry</span> =&gt;</span> {

                <span class="hljs-keyword">if</span> (entry.isIntersecting) !anim.isRunning() &amp;&amp; anim.run();
                <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (!entry.isIntersecting) anim.isRunning() &amp;&amp; anim.halt();
            });
        }, {});
        observer.observe(wrapper.domElement);

        <span class="hljs-keyword">return</span> observer.disconnect;
    }
    <span class="hljs-keyword">else</span> <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
}</pre></div></div>
            
        </li>
        
        
        <li id="section-34">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-34">&#182;</a>
              </div>
              <h4 id="event-listeners">Event listeners</h4>
<p>Each scrawl-canvas stack and canvas can have <strong>bespoke Scrawl-canvas listeners</strong> attached to them, to track user mouse and touch interactions with that element. Scrawl-canvas defines five bespoke listeners:</p>
<ul>
<li><strong>move</strong> - track mouse cursor and touch movements across the DOM element</li>
<li><strong>down</strong> - register a new touch interaction, or user pressing the left mouse button</li>
<li><strong>up</strong> - register the end of a touch interaction, or user releasing the left mouse button</li>
<li><strong>enter</strong> - trigger an event when the mouse cursor or touch event enters into the DOM element</li>
<li><strong>leave</strong> - trigger an event when the mouse cursor or touch event exits from the DOM element</li>
</ul>
<p>The functions all takes the following arguments:</p>
<ul>
<li><strong>evt</strong> - String name of the event (‘move’, ‘down’, ‘up’, ‘enter’, ‘leave’), or an array of such strings</li>
<li><strong>fn</strong> - the function to be called when the event listener(s) trigger</li>
<li><strong>targ</strong> - either the DOM element object, or an array of DOM element objects, or a query selector String; these elements need to be registered in the Scrawl-canvas library beforehend (done automatically for stack and canvas elements)</li>
</ul>

            </div>
            
        </li>
        
        
        <li id="section-35">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-35">&#182;</a>
              </div>
              <p><code>Exported function</code> (to modules and scrawl object). Returns a kill function which, when invoked (no arguments required), will remove the event listener(s) from all DOM elements to which they have been attached.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">const</span> addListener = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">evt, fn, targ</span>) </span>{

    <span class="hljs-keyword">if</span> (!isa_fn(fn)) <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(<span class="hljs-string">`core/document addListener() error - no function supplied: <span class="hljs-subst">${evt}</span>, <span class="hljs-subst">${targ}</span>`</span>);

    actionListener(evt, fn, targ, <span class="hljs-string">'removeEventListener'</span>);
    actionListener(evt, fn, targ, <span class="hljs-string">'addEventListener'</span>);

    <span class="hljs-keyword">return</span> <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{

        removeListener(evt, fn, targ);
    };
};</pre></div></div>
            
        </li>
        
        
        <li id="section-36">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-36">&#182;</a>
              </div>
              <p><code>Exported function</code> (to modules and scrawl object). The counterpart to ‘addListener’ is <strong>removeListener</strong> which removes Scrawl-canvas event listeners from DOM elements in a similar way</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">const</span> removeListener = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">evt, fn, targ</span>) </span>{

    <span class="hljs-keyword">if</span> (!isa_fn(fn)) <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(<span class="hljs-string">`core/document removeListener() error - no function supplied: <span class="hljs-subst">${evt}</span>, <span class="hljs-subst">${targ}</span>`</span>);

    actionListener(evt, fn, targ, <span class="hljs-string">'removeEventListener'</span>);
};</pre></div></div>
            
        </li>
        
        
        <li id="section-37">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-37">&#182;</a>
              </div>
              <p>Because devices and browsers differ in their approach to user interaction (mouse vs pointer vs touch), the actual functionality for adding and removing the event listeners associated with each approach is handled by dedicated actionXXXListener functions</p>

            </div>
            
        </li>
        
        
        <li id="section-38">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-38">&#182;</a>
              </div>
              <p>TODO: code up the functionality to manage touch events</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">const</span> actionListener = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">evt, fn, targ, action</span>) </span>{

    <span class="hljs-keyword">let</span> events = [].concat(evt),
        targets;
    
    <span class="hljs-keyword">if</span> (targ.substring) targets = <span class="hljs-built_in">document</span>.body.querySelectorAll(targ);
    <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (<span class="hljs-built_in">Array</span>.isArray(targ)) targets = targ;
    <span class="hljs-keyword">else</span> targets = [targ];

    <span class="hljs-keyword">if</span> (navigator.pointerEnabled || navigator.msPointerEnabled) actionPointerListener(events, fn, targets, action);
    <span class="hljs-keyword">else</span> actionMouseListener(events, fn, targets, action);
};

<span class="hljs-keyword">const</span> actionMouseListener = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">events, fn, targets, action</span>) </span>{

    events.forEach(<span class="hljs-function"><span class="hljs-params">myevent</span> =&gt;</span> {

        targets.forEach(<span class="hljs-function"><span class="hljs-params">target</span> =&gt;</span> {

            <span class="hljs-keyword">if</span> (!isa_dom(target)) <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(<span class="hljs-string">`core/document actionMouseListener() error - bad target: <span class="hljs-subst">${myevent}</span>, <span class="hljs-subst">${target}</span>`</span>);

            <span class="hljs-keyword">switch</span> (myevent) {
            
                <span class="hljs-keyword">case</span> <span class="hljs-string">'move'</span>:
                    target[action](<span class="hljs-string">'mousemove'</span>, fn, <span class="hljs-literal">false</span>);
                    target[action](<span class="hljs-string">'touchmove'</span>, fn, <span class="hljs-literal">false</span>);
                    target[action](<span class="hljs-string">'touchfollow'</span>, fn, <span class="hljs-literal">false</span>);
                    <span class="hljs-keyword">break</span>;

                <span class="hljs-keyword">case</span> <span class="hljs-string">'up'</span>:
                    target[action](<span class="hljs-string">'mouseup'</span>, fn, <span class="hljs-literal">false</span>);
                    target[action](<span class="hljs-string">'touchend'</span>, fn, <span class="hljs-literal">false</span>);
                    <span class="hljs-keyword">break</span>;

                <span class="hljs-keyword">case</span> <span class="hljs-string">'down'</span>:
                    target[action](<span class="hljs-string">'mousedown'</span>, fn, <span class="hljs-literal">false</span>);
                    target[action](<span class="hljs-string">'touchstart'</span>, fn, <span class="hljs-literal">false</span>);
                    <span class="hljs-keyword">break</span>;

                <span class="hljs-keyword">case</span> <span class="hljs-string">'leave'</span>:
                    target[action](<span class="hljs-string">'mouseleave'</span>, fn, <span class="hljs-literal">false</span>);
                    target[action](<span class="hljs-string">'touchleave'</span>, fn, <span class="hljs-literal">false</span>);
                    <span class="hljs-keyword">break</span>;

                <span class="hljs-keyword">case</span> <span class="hljs-string">'enter'</span>:
                    target[action](<span class="hljs-string">'mouseenter'</span>, fn, <span class="hljs-literal">false</span>);
                    target[action](<span class="hljs-string">'touchenter'</span>, fn, <span class="hljs-literal">false</span>);
                    <span class="hljs-keyword">break</span>;
            }
        });
    });
};

<span class="hljs-keyword">const</span> actionPointerListener = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">events, fn, targets, action</span>) </span>{

    events.forEach(<span class="hljs-function"><span class="hljs-params">myevent</span> =&gt;</span> {

        targets.forEach(<span class="hljs-function"><span class="hljs-params">target</span> =&gt;</span> {

            <span class="hljs-keyword">if</span> (!isa_dom(target)) <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(<span class="hljs-string">`core/document actionPointerListener() error - bad target: <span class="hljs-subst">${myevent}</span>, <span class="hljs-subst">${target}</span>`</span>);

            <span class="hljs-keyword">switch</span> (myevent) {
            
                <span class="hljs-keyword">case</span> <span class="hljs-string">'move'</span>:
                    target[action](<span class="hljs-string">'pointermove'</span>, fn, <span class="hljs-literal">false</span>);
                    <span class="hljs-keyword">break</span>;

                <span class="hljs-keyword">case</span> <span class="hljs-string">'up'</span>:
                    target[action](<span class="hljs-string">'pointerup'</span>, fn, <span class="hljs-literal">false</span>);
                    <span class="hljs-keyword">break</span>;

                <span class="hljs-keyword">case</span> <span class="hljs-string">'down'</span>:
                    target[action](<span class="hljs-string">'pointerdown'</span>, fn, <span class="hljs-literal">false</span>);
                    <span class="hljs-keyword">break</span>;

                <span class="hljs-keyword">case</span> <span class="hljs-string">'leave'</span>:
                    target[action](<span class="hljs-string">'pointerleave'</span>, fn, <span class="hljs-literal">false</span>);
                    <span class="hljs-keyword">break</span>;

                <span class="hljs-keyword">case</span> <span class="hljs-string">'enter'</span>:
                    target[action](<span class="hljs-string">'pointerenter'</span>, fn, <span class="hljs-literal">false</span>);
                    <span class="hljs-keyword">break</span>;
            }
        });
    });
};</pre></div></div>
            
        </li>
        
        
        <li id="section-39">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-39">&#182;</a>
              </div>
              <p><strong>Any event listener</strong> can be added to a Scrawl-canvas stack or canvas DOM element. </p>
<p>The <strong>addNativeListener</strong> function makes adding and removing these ‘native’ listeners a little easier: multiple event listeners (which all trigger the same function) can be added to multiple DOM elements (that have been registered in the Scrawl-canvas library) in a single function call.</p>
<p>The function requires three arguments:</p>
<ul>
<li><strong>evt</strong> - String name of the event (‘click’, ‘input’, ‘change’, etc), or an array of such strings</li>
<li><strong>fn</strong> - the function to be called when the event listener(s) trigger</li>
<li><strong>targ</strong> - either the DOM element object, or an array of DOM element objects, or a query selector String</li>
</ul>

            </div>
            
        </li>
        
        
        <li id="section-40">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-40">&#182;</a>
              </div>
              <p><code>Exported function</code> (to modules and scrawl object). Returns a kill function which, when invoked (no arguments required), will remove the event listener(s) from all DOM elements to which they have been attached.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">const</span> addNativeListener = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">evt, fn, targ</span>) </span>{

    <span class="hljs-keyword">if</span> (!isa_fn(fn)) <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(<span class="hljs-string">`core/document addNativeListener() error - no function supplied: <span class="hljs-subst">${evt}</span>, <span class="hljs-subst">${targ}</span>`</span>);

    actionNativeListener(evt, fn, targ, <span class="hljs-string">'removeEventListener'</span>);
    actionNativeListener(evt, fn, targ, <span class="hljs-string">'addEventListener'</span>);

    <span class="hljs-keyword">return</span> <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{

        removeNativeListener(evt, fn, targ);
    };
};</pre></div></div>
            
        </li>
        
        
        <li id="section-41">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-41">&#182;</a>
              </div>
              <p><code>Exported function</code> (to modules and scrawl object). The counterpart to ‘addNativeListener’ is <strong>removeNativeListener</strong> which removes event listeners from DOM elements in a similar way</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">const</span> removeNativeListener = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">evt, fn, targ</span>) </span>{

    <span class="hljs-keyword">if</span> (!isa_fn(fn)) <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(<span class="hljs-string">`core/document removeNativeListener() error - no function supplied: <span class="hljs-subst">${evt}</span>, <span class="hljs-subst">${targ}</span>`</span>);

    actionNativeListener(evt, fn, targ, <span class="hljs-string">'removeEventListener'</span>);
};

<span class="hljs-keyword">const</span> actionNativeListener = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">evt, fn, targ, action</span>) </span>{

    <span class="hljs-keyword">let</span> events = [].concat(evt),
        targets;

    <span class="hljs-keyword">if</span> (targ.substring) targets = <span class="hljs-built_in">document</span>.body.querySelectorAll(targ);
    <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (<span class="hljs-built_in">Array</span>.isArray(targ)) targets = targ;
    <span class="hljs-keyword">else</span> targets = [targ];

    events.forEach(<span class="hljs-function"><span class="hljs-params">myevent</span> =&gt;</span> {

        targets.forEach(<span class="hljs-function"><span class="hljs-params">target</span> =&gt;</span> {

            <span class="hljs-keyword">if</span> (!isa_dom(target)) <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(<span class="hljs-string">`core/document actionNativeListener() error - bad target: <span class="hljs-subst">${myevent}</span>, <span class="hljs-subst">${target}</span>`</span>);

            target[action](myevent, fn, <span class="hljs-literal">false</span>);
        });
    });
};</pre></div></div>
            
        </li>
        
        
        <li id="section-42">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-42">&#182;</a>
              </div>
              <h2 id="the-display-cycle">The Display cycle</h2>
<p>Scrawl-canvas breaks down the Display cycle into three parts: <strong>clear</strong>; <strong>compile</strong>; and <strong>show</strong>. These can be triggered either as a single, combined <strong>render</strong> operation, or separately as-and-when needed.</p>
<p>The order in which DOM stack and canvas elements are processed during the display cycle can be changed by setting that element’s controller’s <strong>order</strong> attribute to a higher or lower integer value; elements are processed (in batches) from lowest to highest order value</p>
<p>Each display cycle function returns a Promise object which will resolve as true if the function completes successfully; false otherwise. These promises will never reject</p>
<p>Note that Scrawl-canvas supplies a convenience function - <strong>makeRender()</strong> - for automating the process of creating an animation object to handle the Display cycle</p>

            </div>
            
        </li>
        
        
        <li id="section-43">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-43">&#182;</a>
              </div>
              <h4 id="clear">Clear</h4>
<ul>
<li>For canvas artefacts, clear its Cell assets’ display (reset all pixels to 0, or the designated background color) ready for them to be redrawn</li>
<li>For stack artefacts - no action required</li>
</ul>

            </div>
            
        </li>
        
        
        <li id="section-44">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-44">&#182;</a>
              </div>
              <p><code>Exported function</code> (to modules and scrawl object). </p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">const</span> clear = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">...items</span>) </span>{

    displayCycleHelper(items);
    <span class="hljs-keyword">return</span> displayCycleBatchProcess(<span class="hljs-string">'clear'</span>);
};</pre></div></div>
            
        </li>
        
        
        <li id="section-45">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-45">&#182;</a>
              </div>
              <h4 id="compile">Compile</h4>
<ul>
<li>For both canvas and stack artefacts, perform necessary entity/element positional calculations</li>
<li>Additionally for canvas artefacts, stamp associated entitys onto the canvas’s constituent cell assets</li>
</ul>

            </div>
            
        </li>
        
        
        <li id="section-46">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-46">&#182;</a>
              </div>
              <p><code>Exported function</code> (to modules and scrawl object). </p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">const</span> compile = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">...items</span>) </span>{

    displayCycleHelper(items);
    <span class="hljs-keyword">return</span> displayCycleBatchProcess(<span class="hljs-string">'compile'</span>);
};</pre></div></div>
            
        </li>
        
        
        <li id="section-47">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-47">&#182;</a>
              </div>
              <h4 id="show">Show</h4>
<ul>
<li>For canvas artefacts, stamp additional ‘layer’ canvases onto the base canvas, then copy the base canvas onto the display canvas</li>
<li>For stack artefacts - invoke the <strong>domShow</strong> function, if any of its constituent elements require DOM-related updating</li>
</ul>

            </div>
            
        </li>
        
        
        <li id="section-48">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-48">&#182;</a>
              </div>
              <p><code>Exported function</code> (to modules and scrawl object). </p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">const</span> show = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">...items</span>) </span>{

    displayCycleHelper(items);
    <span class="hljs-keyword">return</span> displayCycleBatchProcess(<span class="hljs-string">'show'</span>);
};</pre></div></div>
            
        </li>
        
        
        <li id="section-49">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-49">&#182;</a>
              </div>
              <h4 id="render">Render</h4>
<ul>
<li>Orchestrate the clear, compile and show actions on each stack and canvas DOM element</li>
</ul>

            </div>
            
        </li>
        
        
        <li id="section-50">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-50">&#182;</a>
              </div>
              <p><code>Exported function</code> (to modules and scrawl object). </p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">const</span> render = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">...items</span>) </span>{

    displayCycleHelper(items);
    <span class="hljs-keyword">return</span> displayCycleBatchProcess(<span class="hljs-string">'render'</span>);
};</pre></div></div>
            
        </li>
        
        
        <li id="section-51">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-51">&#182;</a>
              </div>
              <p>Helper functions coordinate the actions required to complete a display cycle</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">const</span> displayCycleHelper = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">items</span>) </span>{

    <span class="hljs-keyword">if</span> (items.length) rootElements_sorted = items;
    <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (rootElementsSort) sortRootElements();
};

<span class="hljs-keyword">const</span> displayCycleBatchProcess = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">method</span>) </span>{

    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Promise</span>(<span class="hljs-function">(<span class="hljs-params">resolve, reject</span>) =&gt;</span> {

        <span class="hljs-keyword">let</span> promises = [];

        rootElements_sorted.forEach(<span class="hljs-function">(<span class="hljs-params">name</span>) =&gt;</span> {

            <span class="hljs-keyword">let</span> item = artefact[name];

            <span class="hljs-keyword">if</span> (item &amp;&amp; item[method]) promises.push(item[method]());
        })

        <span class="hljs-built_in">Promise</span>.all(promises)
        .then(<span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> resolve(<span class="hljs-literal">true</span>))
        .catch(<span class="hljs-function">(<span class="hljs-params">err</span>) =&gt;</span> reject(<span class="hljs-literal">false</span>));
    })
};</pre></div></div>
            
        </li>
        
        
        <li id="section-52">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-52">&#182;</a>
              </div>
              <h2 id="dom-element-updates">DOM element updates</h2>
<p>Scrawl-canvas will batch process all DOM element updates, to minimize disruptive impacts on web page performance. We don’t maintain a full/comprehensive ‘shadow’ or ‘virtual’ DOM, but Scrawl-canvas does maintain a record of element (absolute) position and dimension data, alongside details of scaling, perspective and any other CSS related data (including CSS classes) which we tell it about, on a per-element basis.</p>
<p>The decision on whether to update a DOM element is mediated through a suite of ‘dirty’ flags assigned on the Scrawl-canvas artefact object which wraps each DOM element. As part of the compile component of the Scrawl-canvas Display cycle, the code will take a decision on whether the DOM element needs to be updated and insert the artefact’s name in the <strong>domShowElements</strong> array, and set the <strong>domShowRequired</strong> flag to true, which will then trigger the <strong>domShow()</strong> function to run at the end of each Display cycle.</p>
<p>The domShow() function is exported, and can be triggered for any DOM-related artefact at any time by invoking it with the artefact’s name as the function’s argument.</p>
<p>The order in which DOM elements get updated is determined by the <strong>order</strong> attributes set on the Stack artefact, on Group objects, and (least important) on the element artefact.</p>

            </div>
            
        </li>
        
        
        <li id="section-53">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-53">&#182;</a>
              </div>
              <p>Local variable</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">const</span> domShowElements = [];</pre></div></div>
            
        </li>
        
        
        <li id="section-54">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-54">&#182;</a>
              </div>
              <p><code>Exported function</code> (to modules). </p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">const</span> addDomShowElement = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">item = <span class="hljs-string">''</span></span>) </span>{

    <span class="hljs-keyword">if</span> (!item) <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(<span class="hljs-string">`core/document addDomShowElement() error - false argument supplied: <span class="hljs-subst">${item}</span>`</span>);
    <span class="hljs-keyword">if</span> (!item.substring) <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(<span class="hljs-string">`core/document addDomShowElement() error - argument not a string: <span class="hljs-subst">${item}</span>`</span>);

    pushUnique(domShowElements, item);
};

<span class="hljs-keyword">let</span> domShowRequired = <span class="hljs-literal">false</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-55">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-55">&#182;</a>
              </div>
              <p><code>Exported function</code> (to modules). </p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">const</span> setDomShowRequired = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">val = true</span>) </span>{

    domShowRequired = val;
};</pre></div></div>
            
        </li>
        
        
        <li id="section-56">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-56">&#182;</a>
              </div>
              <p><code>Exported function</code> (to modules). This is the <strong>main DOM manipulation function</strong> which will be triggered once during each Display cycle.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">const</span> domShow = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">singleArtefact = <span class="hljs-string">''</span></span>) </span>{

    <span class="hljs-keyword">if</span> (domShowRequired || singleArtefact) {

        <span class="hljs-keyword">let</span> myartefacts;

        <span class="hljs-keyword">if</span> (singleArtefact) myartefacts = [singleArtefact];
        <span class="hljs-keyword">else</span> {

            domShowRequired = <span class="hljs-literal">false</span>;
            myartefacts = [].concat(domShowElements);
            domShowElements.length = <span class="hljs-number">0</span>;
        }</pre></div></div>
            
        </li>
        
        
        <li id="section-57">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-57">&#182;</a>
              </div>
              <p>given the critical nature of these loops, using ‘for’ instead of ‘forEach’</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">let</span> i, iz, name, art, el, style,
            p, dims, w, h,
            j, jz, items, keys, key, keyName, value;

        <span class="hljs-keyword">for</span> (i = <span class="hljs-number">0</span>, iz = myartefacts.length; i &lt; iz; i++) {

            name = myartefacts[i];

            art = artefact[name];
            <span class="hljs-keyword">if</span> (!art) <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(<span class="hljs-string">`core/document domShow() error - artefact missing: <span class="hljs-subst">${name}</span>`</span>);

            el = art.domElement;
            <span class="hljs-keyword">if</span> (!el) <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(<span class="hljs-string">`core/document domShow() error - DOM element missing: <span class="hljs-subst">${name}</span>`</span>);

            style = el.style;</pre></div></div>
            
        </li>
        
        
        <li id="section-58">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-58">&#182;</a>
              </div>
              <p>update perspective</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            <span class="hljs-keyword">if</span> (art.dirtyPerspective) {

                art.dirtyPerspective = <span class="hljs-literal">false</span>;

                p = art.perspective;

                style.perspectiveOrigin = <span class="hljs-string">`<span class="hljs-subst">${p.x}</span> <span class="hljs-subst">${p.y}</span>`</span>;
                style.perspective = <span class="hljs-string">`<span class="hljs-subst">${p.z}</span>px`</span>;
            }</pre></div></div>
            
        </li>
        
        
        <li id="section-59">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-59">&#182;</a>
              </div>
              <p>update position</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            <span class="hljs-keyword">if</span> (art.dirtyPosition) {

                art.dirtyPosition = <span class="hljs-literal">false</span>;
                style.position = art.position;
            }</pre></div></div>
            
        </li>
        
        
        <li id="section-60">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-60">&#182;</a>
              </div>
              <p>update dimensions</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            <span class="hljs-keyword">if</span> (art.dirtyDomDimensions) {

                art.dirtyDomDimensions = <span class="hljs-literal">false</span>;

                dims = art.currentDimensions;
                w = dims[<span class="hljs-number">0</span>];
                h = dims[<span class="hljs-number">1</span>];

                <span class="hljs-keyword">if</span> (art.type === <span class="hljs-string">'Canvas'</span>) {

                    el.width = w;
                    el.height = h;
                }
                <span class="hljs-keyword">else</span> {

                    style.width = <span class="hljs-string">`<span class="hljs-subst">${w}</span>px`</span>;
                    style.height = (h) ? <span class="hljs-string">`<span class="hljs-subst">${h}</span>px`</span> : <span class="hljs-string">'auto'</span>;
                }
            }</pre></div></div>
            
        </li>
        
        
        <li id="section-61">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-61">&#182;</a>
              </div>
              <p>update handle/transformOrigin</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            <span class="hljs-keyword">if</span> (art.dirtyTransformOrigin) {

                art.dirtyTransformOrigin = <span class="hljs-literal">false</span>;
                style.transformOrigin = art.currentTransformOriginString;
            }</pre></div></div>
            
        </li>
        
        
        <li id="section-62">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-62">&#182;</a>
              </div>
              <p>update transform</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            <span class="hljs-keyword">if</span> (art.dirtyTransform) {

                art.dirtyTransform = <span class="hljs-literal">false</span>;
                style.transform = art.currentTransformString;
            }</pre></div></div>
            
        </li>
        
        
        <li id="section-63">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-63">&#182;</a>
              </div>
              <p>update visibility</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            <span class="hljs-keyword">if</span> (art.dirtyVisibility) {

                art.dirtyVisibility = <span class="hljs-literal">false</span>;
                style.display = (art.visibility) ? <span class="hljs-string">'block'</span> : <span class="hljs-string">'none'</span>;
            }</pre></div></div>
            
        </li>
        
        
        <li id="section-64">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-64">&#182;</a>
              </div>
              <p>update other CSS changes</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            <span class="hljs-keyword">if</span> (art.dirtyCss) {

                art.dirtyCss = <span class="hljs-literal">false</span>;

                items = art.css || {};
                keys = <span class="hljs-built_in">Object</span>.keys(items);

                <span class="hljs-keyword">for</span> (j = <span class="hljs-number">0</span>, jz = keys.length; j &lt; jz; j++) {

                    key = keys[j];
                    value = items[key];

                    <span class="hljs-keyword">if</span> (xcss.has(key)) {

                        keyName = <span class="hljs-string">`<span class="hljs-subst">${key[<span class="hljs-number">0</span>].toUpperCase}</span><span class="hljs-subst">${key.substr(<span class="hljs-number">1</span>)}</span>`</span>;

                        style[<span class="hljs-string">`webkit<span class="hljs-subst">${keyName}</span>`</span>] = value;
                        style[<span class="hljs-string">`moz<span class="hljs-subst">${keyName}</span>`</span>] = value;
                        style[<span class="hljs-string">`ms<span class="hljs-subst">${keyName}</span>`</span>] = value;
                        style[<span class="hljs-string">`o<span class="hljs-subst">${keyName}</span>`</span>] = value;
                        style[key] = value;
                    }
                    <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (css.has(key)) style[key] = value;
                }
            }</pre></div></div>
            
        </li>
        
        
        <li id="section-65">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-65">&#182;</a>
              </div>
              <p>update element classes</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            <span class="hljs-keyword">if</span> (art.dirtyClasses) {

                art.dirtyClasses = <span class="hljs-literal">false</span>;
                el.className = art.classes;
            }
        }
    }
};</pre></div></div>
            
        </li>
        
        
        <li id="section-66">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-66">&#182;</a>
              </div>
              <h4 id="dom-holding-areas">DOM Holding areas</h4>
<p><code>Exported handles</code> (to modules). During its initialization phase, Scrawl-canvas will add two hidden ‘hold’ elements at the top and bottom of the document body where it can add additional elements as-and-when required. </p>

            </div>
            
        </li>
        
        
        <li id="section-67">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-67">&#182;</a>
              </div>
              <p>Mainly for ARIA content. ARIA labels and descriptions are used by Scrawl-canvas &lt;canvas&gt; elements to inform non-visual website visitors about content in the canvas.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">let</span> scrawlCanvasHold = <span class="hljs-built_in">document</span>.createElement(<span class="hljs-string">'div'</span>);
scrawlCanvasHold.style.padding = <span class="hljs-number">0</span>;
scrawlCanvasHold.style.border = <span class="hljs-number">0</span>;
scrawlCanvasHold.style.margin = <span class="hljs-number">0</span>;
scrawlCanvasHold.style.width = <span class="hljs-string">'4500px'</span>;
scrawlCanvasHold.style.boxSizing = <span class="hljs-string">'border-box'</span>;
scrawlCanvasHold.style.position = <span class="hljs-string">'absolute'</span>;
scrawlCanvasHold.style.top = <span class="hljs-string">'-5000px'</span>;
scrawlCanvasHold.style.left = <span class="hljs-string">'-5000px'</span>;
scrawlCanvasHold.id = <span class="hljs-string">'Scrawl-ARIA-default-hold'</span>;
<span class="hljs-built_in">document</span>.body.appendChild(scrawlCanvasHold);</pre></div></div>
            
        </li>
        
        
        <li id="section-68">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-68">&#182;</a>
              </div>
              <p>Navigation area - canvas anchor links. Canvases create their own (hidden) &lt;nav&gt; elements that directly follow them in the DOM. These are used to store &lt;a&gt; links for clickable entitys in the canvas display, making them accessible to non-visual users (for example: screen readers)</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">let</span> scrawlNavigationHold = <span class="hljs-built_in">document</span>.createElement(<span class="hljs-string">'nav'</span>);
scrawlNavigationHold.style.position = <span class="hljs-string">'absolute'</span>;
scrawlNavigationHold.style.top = <span class="hljs-string">'-5000px'</span>;
scrawlNavigationHold.style.left = <span class="hljs-string">'-5000px'</span>;
scrawlNavigationHold.id = <span class="hljs-string">'Scrawl-navigation-default-hold'</span>;
<span class="hljs-built_in">document</span>.body.prepend(scrawlNavigationHold);</pre></div></div>
            
        </li>
        
        
        <li id="section-69">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-69">&#182;</a>
              </div>
              <h4 id="exports">Exports</h4>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">export</span> {
    getCanvases,
    getCanvas,
    getStacks,

    addCanvas,
    addStack,
    setCurrentCanvas,

    currentCanvas,
    currentGroup,

    rootElements,
    setRootElementsSort,

    addListener,
    removeListener,
    addNativeListener,
    removeNativeListener,

    clear,
    compile,
    show,
    render,

    makeAnimationObserver,

    addDomShowElement,
    setDomShowRequired,
    domShow,

    scrawlCanvasHold,
    scrawlNavigationHold,
};</pre></div></div>
            
        </li>
        
    </ul>
  </div>
</body>
</html>
