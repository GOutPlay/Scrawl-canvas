<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Experiment Canvas 010</title>

  <style>
    div {
      width: 400px;
      height: 200px;

      min-width: 200px;
      min-height: 200px;
      max-width: 800px;
      max-height: 800px;

      overflow: hidden;
      resize: both;

      margin: 0 auto;
    }

    canvas {
      width: 100%;
      height: 100%;
      background-color: white;
    }

    h2, p {
      width: 100%;
      text-align: center;
    }
  </style>
</head>

<body>

  <h2>CodePen Challenge - August 2020: Week 1 'Take on Me'</h2>

  <p>The demo requests access to the device camera, then converts what it sees into the required lines and colors.</p>

  <div>
    <canvas id="mycanvas"></canvas>
  </div>

  <p>Resize canvas by dragging bottom-right corner</p>

  <script type="module">
    
    import scrawl from '../source/scrawl.js'

    let canvas = scrawl.library.artefact.mycanvas;

    let vid;

    canvas.set({

      backgroundColor: 'yellow',
      fit: 'cover',
      checkForResize: true,

    }).setBase({

      width: 900,
      height: 600,
    });

    scrawl.makeFilter({

      name: 'stepper',
      method: 'channelstep',

      red: 16,
      green: 16,
      blue: 16,

    }).clone({

      name: 'gray',
      method: 'grayscale',

    }).clone({

      name: 'lines',
      method: 'matrix',

      weights: [-1, 0, 1, -2, 0, 2, -1, 0, 1],

    }).clone({

      name: 'invert',
      method: 'invert',

    }).clone({

      name: 'colorize',
      method: 'threshold',

      level: 220,
      lowRed: 85,
      lowGreen: 77,
      lowBlue: 115,
      highRed: 165,
      highGreen: 167,
      highBlue: 187,
    });

    scrawl.importMediaStream({ audio: false })
    .then(myface => {

      vid = scrawl.makePicture({

        name: 'camera-picture-1',
        asset: myface.name,

        width: '100%',
        height: '100%',

        copyWidth: '100%',
        copyHeight: '100%',

        method: 'fill',

        filters: ['gray', 'stepper', 'lines', 'invert', 'colorize'],
      });
    })
    .catch(err => console.log(err.message));

    scrawl.makeRender({

      name: 'codepen-challenge',
      target: canvas,
    });

    console.log(scrawl.library);
  </script>

</body>

</html>
